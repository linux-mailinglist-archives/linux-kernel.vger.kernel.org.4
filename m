Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id E1AD6637AA0
	for <lists+linux-kernel@lfdr.de>; Thu, 24 Nov 2022 14:56:47 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S229821AbiKXN4q (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Thu, 24 Nov 2022 08:56:46 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:49442 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S230071AbiKXN4d (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 24 Nov 2022 08:56:33 -0500
Received: from mout.gmx.net (mout.gmx.net [212.227.15.15])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 424A1ECCD3;
        Thu, 24 Nov 2022 05:56:31 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=gmx.de; s=s31663417;
        t=1669298173; bh=fv8SjyD4xDuS845+FrgNrBwr4CQVNrdzJ9YRUMiA+TY=;
        h=X-UI-Sender-Class:From:To:Cc:Subject:Date:In-Reply-To:References;
        b=lcI1cZuAQ5wvaNyZE2ryqYmERayGugVT8v30Rz2tx8ePi7YqKY4DUqScBesUGVBVZ
         42EhV05+qTtJK/OfukMidyvXmQf4gt35gtG8y4gJ2maVY25i5sSj+hD6JhZPxZ3e1w
         ZW2lThEle+prgpPVoBWy4Kt7WB33rTUgDJ5dSuG3gzXDCKHcPHX6PlXHqEUqhDuvXQ
         PltNzr4PvdPbMOen+7/sv44xrYBjwxs3WB/LH4lQQpt7zo5EKNVOCroVvuYq1KxoBj
         lJTfCK74SpfqlQo7i/ZyrQrzTw1q5LWN3l86E+BWZ/s/Xwld699aU/W6omESjQSk8W
         /SIFDqwpd4OAA==
X-UI-Sender-Class: 724b4f7f-cbec-4199-ad4e-598c01a50d3a
Received: from Venus.speedport.ip ([84.162.7.17]) by mail.gmx.net (mrgmx005
 [212.227.17.190]) with ESMTPSA (Nemesis) id 1MuUnA-1pFJp10EAU-00rbly; Thu, 24
 Nov 2022 14:56:13 +0100
From:   Lino Sanfilippo <LinoSanfilippo@gmx.de>
To:     peterhuewe@gmx.de, jarkko@kernel.org, jgg@ziepe.ca
Cc:     stefanb@linux.vnet.ibm.com, linux@mniewoehner.de,
        linux-integrity@vger.kernel.org, linux-kernel@vger.kernel.org,
        jandryuk@gmail.com, pmenzel@molgen.mpg.de, l.sanfilippo@kunbus.com,
        LinoSanfilippo@gmx.de, lukas@wunner.de, p.rosenberger@kunbus.com
Subject: [PATCH v11 09/14] tpm, tpm: Implement usage counter for locality
Date:   Thu, 24 Nov 2022 14:55:33 +0100
Message-Id: <20221124135538.31020-10-LinoSanfilippo@gmx.de>
X-Mailer: git-send-email 2.36.1
In-Reply-To: <20221124135538.31020-1-LinoSanfilippo@gmx.de>
References: <20221124135538.31020-1-LinoSanfilippo@gmx.de>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: base64
X-Provags-ID: V03:K1:EARtN2yQKkakweGe45TiFY3vqXI2qDGZjL4gyp78j5cHVteVZv5
 HF3CDFi80lqOezCuQexU50FPdC7jHz82F492j3aBJmwLcdKMVEaafWdF1Ed7FaGDz3TUXCw
 i8ObbYI5qXlaOcqPEausj+fmQ+PSB05XO4NMzQo6qgg3LlMM86D7DdLoO3To04pMISoL2Oe
 p34/cDpN+TJrzJb7zWHQg==
UI-OutboundReport: notjunk:1;M01:P0:+jLTMtAND+4=;hqIEXAWKxiuPKFVUiViFreV/Ml6
 Tz4XPEUrjoJC3sNeBfK48XhgbgwTtd74/le+W/XQnSd+j+Tm4iV5EO3C+v8+w2yQ5vrEhjcBx
 bDAJYuWbq9YJbLHcPgZ+YbX4pwsk0GtMYLfq6HoQjx7xwBNLr4CxVjO8dsZLjTgkgZQFoKDzO
 8Mw2vmUzZ4E6D6LuuJm2vVs963Ph5WLQbzw7iv3nI7JxG6FLSogbSXGJIidIm57QNHZW+fsdC
 aLPlByevOrgjAkcTjRx2EHsczzKytJhbCGI4IlKe67rV1ysEletFo+T6eAAb8DW1JKDDSN+pE
 Yure738l2W5OpqNewln7/fXluSXjHQQgAKZwfuCSxKBTKbenz0zDa7QgGAXGouA3vo/pqo+yW
 qp8haKRjUCCpvjv8Iu51erz6xViPcxzkYPAdARgqiQ4fgX/uccXoAQK2NzqwcvwnWTK9YhIkx
 632phS2rNVt19qPoKD0hKpJR5QnTbsBAYn6Nbl/WT2qtS5KGjtcZOhnGpbOdyt3pF+D7L2lc6
 Arf7qJe606693CrRO1gumFTHr8PKf1Qv0zRmOSQg0lWUBuLYXug2ytMw1HrjZTZoEAFS0ato9
 /318EyZfm8gSRg5JXmM1zH2aM1I/+zLX4/AUxL1IktDm7CxtWH+UyBXbNtgtDPT8iA1HmoOzy
 qWYnrljVRkIPhayxuWYfuXOr6vnZWGeu+u1ofwj1BTKBVugKfvLdaRUjIcc9XSmNVnNoj0SOD
 hSaWvR9fTe2n7WYlDziiAqh5oAeWtwGKN6ZmuaueOP2GVy0jXwjIRNTsAsuVJFxC6pIiBEVRI
 i8UaKU465yYWTwFjdvtpWIFQzWsL/+XBnOr5WdaypUMfyWsPYlnJCuRchOCMjTnkk0P66PEmc
 XfAS8vwvwRkSHyOhpVSunvj/r6VUb9egniD3tJxEi7YaWg89vBkRshT+vXo8wmNc29Uylxf4v
 5Tn7e4RsIF6OykJPDegG7QV6Zak=
X-Spam-Status: No, score=-2.8 required=5.0 tests=BAYES_00,DKIM_SIGNED,
        DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,FREEMAIL_FROM,RCVD_IN_DNSWL_LOW,
        RCVD_IN_MSPIKE_H2,SPF_HELO_NONE,SPF_PASS autolearn=ham
        autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

RnJvbTogTGlubyBTYW5maWxpcHBvIDxsLnNhbmZpbGlwcG9Aa3VuYnVzLmNvbT4KCkltcGxlbWVu
dCBhIHVzYWdlIGNvdW50ZXIgZm9yIHRoZSAoZGVmYXVsdCkgbG9jYWxpdHkgdXNlZCBieSB0aGUg
VFBNIFRJUwpkcml2ZXI6ClJlcXVlc3QgdGhlIGxvY2FsaXR5IGZyb20gdGhlIFRQTSBpZiBpdCBo
YXMgbm90IGJlZW4gY2xhaW1lZCB5ZXQsIG90aGVyd2lzZQpvbmx5IGluY3JlbWVudCB0aGUgY291
bnRlci4gQWxzbyByZWxlYXNlIHRoZSBsb2NhbGl0eSBpZiB0aGUgY291bnRlciBpcyAwCm90aGVy
d2lzZSBvbmx5IGRlY3JlbWVudCB0aGUgY291bnRlci4gU2luY2UgaW4gY2FzZSBvZiBTUEkgdGhl
IHJlZ2lzdGVyCmFjY2Vzc2VzIGFyZSBsb2NrZWQgYnkgbWVhbnMgb2YgdGhlIFNQSSBidXMgbXV0
ZXggdXNlIGEgc2xlZXBhYmxlIGxvY2sKKGkuZS4gYWxzbyBhIG11dGV4KSB0byBlbnN1cmUgdGhy
ZWFkLXNhZmV0eSBvZiB0aGUgY291bnRlciB3aGljaCBtYXkgYmUKYWNjZXNzZWQgYnkgYm90aCBh
IHVzZXJzcGFjZSB0aHJlYWQgYW5kIHRoZSBpbnRlcnJ1cHQgaGFuZGxlci4KCkJ5IGRvaW5nIHRo
aXMgcmVmYWN0b3IgdGhlIG5hbWVzIG9mIHRoZSBhbWVuZGVkIGZ1bmN0aW9ucyB0byB1c2UgYSBt
b3JlCmFwcHJvcHJpYXRlIHByZWZpeC4KClNpZ25lZC1vZmYtYnk6IExpbm8gU2FuZmlsaXBwbyA8
bC5zYW5maWxpcHBvQGt1bmJ1cy5jb20+ClRlc3RlZC1ieTogTWljaGFlbCBOaWV3w7ZobmVyIDxs
aW51eEBtbmlld29laG5lci5kZT4KLS0tCiBkcml2ZXJzL2NoYXIvdHBtL3RwbV90aXNfY29yZS5j
IHwgNjMgKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tCiBkcml2ZXJzL2NoYXIvdHBt
L3RwbV90aXNfY29yZS5oIHwgIDIgKysKIDIgZmlsZXMgY2hhbmdlZCwgNDcgaW5zZXJ0aW9ucygr
KSwgMTggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9jaGFyL3RwbS90cG1fdGlz
X2NvcmUuYyBiL2RyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmMKaW5kZXggZDcwNWRmYjY0
Y2Y5Li5mMDBmMTA1N2ZkMjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19j
b3JlLmMKKysrIGIvZHJpdmVycy9jaGFyL3RwbS90cG1fdGlzX2NvcmUuYwpAQCAtMTY1LDE2ICsx
NjUsMjcgQEAgc3RhdGljIGJvb2wgY2hlY2tfbG9jYWxpdHkoc3RydWN0IHRwbV9jaGlwICpjaGlw
LCBpbnQgbCkKIAlyZXR1cm4gZmFsc2U7CiB9CiAKLXN0YXRpYyBpbnQgcmVsZWFzZV9sb2NhbGl0
eShzdHJ1Y3QgdHBtX2NoaXAgKmNoaXAsIGludCBsKQorc3RhdGljIGludCBfX3RwbV90aXNfcmVs
aW5xdWlzaF9sb2NhbGl0eShzdHJ1Y3QgdHBtX3Rpc19kYXRhICpwcml2LCBpbnQgbCkKK3sKKwl0
cG1fdGlzX3dyaXRlOChwcml2LCBUUE1fQUNDRVNTKGwpLCBUUE1fQUNDRVNTX0FDVElWRV9MT0NB
TElUWSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCB0cG1fdGlzX3JlbGlucXVpc2hf
bG9jYWxpdHkoc3RydWN0IHRwbV9jaGlwICpjaGlwLCBpbnQgbCkKIHsKIAlzdHJ1Y3QgdHBtX3Rp
c19kYXRhICpwcml2ID0gZGV2X2dldF9kcnZkYXRhKCZjaGlwLT5kZXYpOwogCi0JdHBtX3Rpc193
cml0ZTgocHJpdiwgVFBNX0FDQ0VTUyhsKSwgVFBNX0FDQ0VTU19BQ1RJVkVfTE9DQUxJVFkpOwor
CW11dGV4X2xvY2soJnByaXYtPmxvY2FsaXR5X2NvdW50X211dGV4KTsKKwlwcml2LT5sb2NhbGl0
eV9jb3VudC0tOworCWlmIChwcml2LT5sb2NhbGl0eV9jb3VudCA9PSAwKQorCQlfX3RwbV90aXNf
cmVsaW5xdWlzaF9sb2NhbGl0eShwcml2LCBsKTsKKwltdXRleF91bmxvY2soJnByaXYtPmxvY2Fs
aXR5X2NvdW50X211dGV4KTsKIAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IHJlcXVlc3Rf
bG9jYWxpdHkoc3RydWN0IHRwbV9jaGlwICpjaGlwLCBpbnQgbCkKK3N0YXRpYyBpbnQgX190cG1f
dGlzX3JlcXVlc3RfbG9jYWxpdHkoc3RydWN0IHRwbV9jaGlwICpjaGlwLCBpbnQgbCkKIHsKIAlz
dHJ1Y3QgdHBtX3Rpc19kYXRhICpwcml2ID0gZGV2X2dldF9kcnZkYXRhKCZjaGlwLT5kZXYpOwog
CXVuc2lnbmVkIGxvbmcgc3RvcCwgdGltZW91dDsKQEAgLTIxNSw2ICsyMjYsMjAgQEAgc3RhdGlj
IGludCByZXF1ZXN0X2xvY2FsaXR5KHN0cnVjdCB0cG1fY2hpcCAqY2hpcCwgaW50IGwpCiAJcmV0
dXJuIC0xOwogfQogCitzdGF0aWMgaW50IHRwbV90aXNfcmVxdWVzdF9sb2NhbGl0eShzdHJ1Y3Qg
dHBtX2NoaXAgKmNoaXAsIGludCBsKQoreworCXN0cnVjdCB0cG1fdGlzX2RhdGEgKnByaXYgPSBk
ZXZfZ2V0X2RydmRhdGEoJmNoaXAtPmRldik7CisJaW50IHJldCA9IDA7CisKKwltdXRleF9sb2Nr
KCZwcml2LT5sb2NhbGl0eV9jb3VudF9tdXRleCk7CisJaWYgKHByaXYtPmxvY2FsaXR5X2NvdW50
ID09IDApCisJCXJldCA9IF9fdHBtX3Rpc19yZXF1ZXN0X2xvY2FsaXR5KGNoaXAsIGwpOworCWlm
ICghcmV0KQorCQlwcml2LT5sb2NhbGl0eV9jb3VudCsrOworCW11dGV4X3VubG9jaygmcHJpdi0+
bG9jYWxpdHlfY291bnRfbXV0ZXgpOworCXJldHVybiByZXQ7Cit9CisKIHN0YXRpYyB1OCB0cG1f
dGlzX3N0YXR1cyhzdHJ1Y3QgdHBtX2NoaXAgKmNoaXApCiB7CiAJc3RydWN0IHRwbV90aXNfZGF0
YSAqcHJpdiA9IGRldl9nZXRfZHJ2ZGF0YSgmY2hpcC0+ZGV2KTsKQEAgLTY4Miw3ICs3MDcsNyBA
QCBzdGF0aWMgaW50IHByb2JlX2l0cG0oc3RydWN0IHRwbV9jaGlwICpjaGlwKQogCWlmICh2ZW5k
b3IgIT0gVFBNX1ZJRF9JTlRFTCkKIAkJcmV0dXJuIDA7CiAKLQlpZiAocmVxdWVzdF9sb2NhbGl0
eShjaGlwLCAwKSAhPSAwKQorCWlmICh0cG1fdGlzX3JlcXVlc3RfbG9jYWxpdHkoY2hpcCwgMCkg
IT0gMCkKIAkJcmV0dXJuIC1FQlVTWTsKIAogCXJjID0gdHBtX3Rpc19zZW5kX2RhdGEoY2hpcCwg
Y21kX2dldHRpY2tzLCBsZW4pOwpAQCAtNzAzLDcgKzcyOCw3IEBAIHN0YXRpYyBpbnQgcHJvYmVf
aXRwbShzdHJ1Y3QgdHBtX2NoaXAgKmNoaXApCiAKIG91dDoKIAl0cG1fdGlzX3JlYWR5KGNoaXAp
OwotCXJlbGVhc2VfbG9jYWxpdHkoY2hpcCwgcHJpdi0+bG9jYWxpdHkpOworCXRwbV90aXNfcmVs
aW5xdWlzaF9sb2NhbGl0eShjaGlwLCBwcml2LT5sb2NhbGl0eSk7CiAKIAlyZXR1cm4gcmM7CiB9
CkBAIC03ODgsMTQgKzgxMywxNCBAQCBzdGF0aWMgaW50IHRwbV90aXNfcHJvYmVfaXJxX3Npbmds
ZShzdHJ1Y3QgdHBtX2NoaXAgKmNoaXAsIHUzMiBpbnRtYXNrLAogCX0KIAlwcml2LT5pcnEgPSBp
cnE7CiAKLQlyYyA9IHJlcXVlc3RfbG9jYWxpdHkoY2hpcCwgMCk7CisJcmMgPSB0cG1fdGlzX3Jl
cXVlc3RfbG9jYWxpdHkoY2hpcCwgMCk7CiAJaWYgKHJjIDwgMCkKIAkJcmV0dXJuIHJjOwogCiAJ
cmMgPSB0cG1fdGlzX3JlYWQ4KHByaXYsIFRQTV9JTlRfVkVDVE9SKHByaXYtPmxvY2FsaXR5KSwK
IAkJCSAgICZvcmlnaW5hbF9pbnRfdmVjKTsKIAlpZiAocmMgPCAwKSB7Ci0JCXJlbGVhc2VfbG9j
YWxpdHkoY2hpcCwgcHJpdi0+bG9jYWxpdHkpOworCQl0cG1fdGlzX3JlbGlucXVpc2hfbG9jYWxp
dHkoY2hpcCwgcHJpdi0+bG9jYWxpdHkpOwogCQlyZXR1cm4gcmM7CiAJfQogCkBAIC04MzQsNyAr
ODU5LDcgQEAgc3RhdGljIGludCB0cG1fdGlzX3Byb2JlX2lycV9zaW5nbGUoc3RydWN0IHRwbV9j
aGlwICpjaGlwLCB1MzIgaW50bWFzaywKIAkJcmMgPSAtMTsKIAl9CiAKLQlyZWxlYXNlX2xvY2Fs
aXR5KGNoaXAsIHByaXYtPmxvY2FsaXR5KTsKKwl0cG1fdGlzX3JlbGlucXVpc2hfbG9jYWxpdHko
Y2hpcCwgcHJpdi0+bG9jYWxpdHkpOwogCiAJcmV0dXJuIHJjOwogfQpAQCAtOTUwLDggKzk3NSw4
IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgdHBtX2NsYXNzX29wcyB0cG1fdGlzID0gewogCS5yZXFf
Y29tcGxldGVfbWFzayA9IFRQTV9TVFNfREFUQV9BVkFJTCB8IFRQTV9TVFNfVkFMSUQsCiAJLnJl
cV9jb21wbGV0ZV92YWwgPSBUUE1fU1RTX0RBVEFfQVZBSUwgfCBUUE1fU1RTX1ZBTElELAogCS5y
ZXFfY2FuY2VsZWQgPSB0cG1fdGlzX3JlcV9jYW5jZWxlZCwKLQkucmVxdWVzdF9sb2NhbGl0eSA9
IHJlcXVlc3RfbG9jYWxpdHksCi0JLnJlbGlucXVpc2hfbG9jYWxpdHkgPSByZWxlYXNlX2xvY2Fs
aXR5LAorCS5yZXF1ZXN0X2xvY2FsaXR5ID0gdHBtX3Rpc19yZXF1ZXN0X2xvY2FsaXR5LAorCS5y
ZWxpbnF1aXNoX2xvY2FsaXR5ID0gdHBtX3Rpc19yZWxpbnF1aXNoX2xvY2FsaXR5LAogCS5jbGtf
ZW5hYmxlID0gdHBtX3Rpc19jbGtydW5fZW5hYmxlLAogfTsKIApAQCAtOTg1LDYgKzEwMTAsOCBA
QCBpbnQgdHBtX3Rpc19jb3JlX2luaXQoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgdHBtX3Rp
c19kYXRhICpwcml2LCBpbnQgaXJxLAogCXByaXYtPnRpbWVvdXRfbWluID0gVFBNX1RJTUVPVVRf
VVNFQ1NfTUlOOwogCXByaXYtPnRpbWVvdXRfbWF4ID0gVFBNX1RJTUVPVVRfVVNFQ1NfTUFYOwog
CXByaXYtPnBoeV9vcHMgPSBwaHlfb3BzOworCXByaXYtPmxvY2FsaXR5X2NvdW50ID0gMDsKKwlt
dXRleF9pbml0KCZwcml2LT5sb2NhbGl0eV9jb3VudF9tdXRleCk7CiAKIAlkZXZfc2V0X2RydmRh
dGEoJmNoaXAtPmRldiwgcHJpdik7CiAKQEAgLTEwNjMsMTQgKzEwOTAsMTQgQEAgaW50IHRwbV90
aXNfY29yZV9pbml0KHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IHRwbV90aXNfZGF0YSAqcHJp
diwgaW50IGlycSwKIAogCWludG1hc2sgJj0gflRQTV9HTE9CQUxfSU5UX0VOQUJMRTsKIAotCXJj
ID0gcmVxdWVzdF9sb2NhbGl0eShjaGlwLCAwKTsKKwlyYyA9IHRwbV90aXNfcmVxdWVzdF9sb2Nh
bGl0eShjaGlwLCAwKTsKIAlpZiAocmMgPCAwKSB7CiAJCXJjID0gLUVOT0RFVjsKIAkJZ290byBv
dXRfZXJyOwogCX0KIAogCXRwbV90aXNfd3JpdGUzMihwcml2LCBUUE1fSU5UX0VOQUJMRShwcml2
LT5sb2NhbGl0eSksIGludG1hc2spOwotCXJlbGVhc2VfbG9jYWxpdHkoY2hpcCwgMCk7CisJdHBt
X3Rpc19yZWxpbnF1aXNoX2xvY2FsaXR5KGNoaXAsIDApOwogCiAJcmMgPSB0cG1fY2hpcF9zdGFy
dChjaGlwKTsKIAlpZiAocmMpCkBAIC0xMTA0LDEzICsxMTMxLDEzIEBAIGludCB0cG1fdGlzX2Nv
cmVfaW5pdChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCB0cG1fdGlzX2RhdGEgKnByaXYsIGlu
dCBpcnEsCiAJCSAqIHByb3BlciB0aW1lb3V0cyBmb3IgdGhlIGRyaXZlci4KIAkJICovCiAKLQkJ
cmMgPSByZXF1ZXN0X2xvY2FsaXR5KGNoaXAsIDApOworCQlyYyA9IHRwbV90aXNfcmVxdWVzdF9s
b2NhbGl0eShjaGlwLCAwKTsKIAkJaWYgKHJjIDwgMCkKIAkJCWdvdG8gb3V0X2VycjsKIAogCQly
YyA9IHRwbV9nZXRfdGltZW91dHMoY2hpcCk7CiAKLQkJcmVsZWFzZV9sb2NhbGl0eShjaGlwLCAw
KTsKKwkJdHBtX3Rpc19yZWxpbnF1aXNoX2xvY2FsaXR5KGNoaXAsIDApOwogCiAJCWlmIChyYykg
ewogCQkJZGV2X2VycihkZXYsICJDb3VsZCBub3QgZ2V0IFRQTSB0aW1lb3V0cyBhbmQgZHVyYXRp
b25zXG4iKTsKQEAgLTExMzAsMTEgKzExNTcsMTEgQEAgaW50IHRwbV90aXNfY29yZV9pbml0KHN0
cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IHRwbV90aXNfZGF0YSAqcHJpdiwgaW50IGlycSwKIAkJ
CWRldl9lcnIoJmNoaXAtPmRldiwgRldfQlVHCiAJCQkJCSJUUE0gaW50ZXJydXB0IG5vdCB3b3Jr
aW5nLCBwb2xsaW5nIGluc3RlYWRcbiIpOwogCi0JCQlyYyA9IHJlcXVlc3RfbG9jYWxpdHkoY2hp
cCwgMCk7CisJCQlyYyA9IHRwbV90aXNfcmVxdWVzdF9sb2NhbGl0eShjaGlwLCAwKTsKIAkJCWlm
IChyYyA8IDApCiAJCQkJZ290byBvdXRfZXJyOwogCQkJZGlzYWJsZV9pbnRlcnJ1cHRzKGNoaXAp
OwotCQkJcmVsZWFzZV9sb2NhbGl0eShjaGlwLCAwKTsKKwkJCXRwbV90aXNfcmVsaW5xdWlzaF9s
b2NhbGl0eShjaGlwLCAwKTsKIAkJfQogCX0KIApAQCAtMTIwMSwxMyArMTIyOCwxMyBAQCBpbnQg
dHBtX3Rpc19yZXN1bWUoc3RydWN0IGRldmljZSAqZGV2KQogCSAqIGFuIGVycm9yIGNvZGUgYnV0
IGZvciB1bmtub3duIHJlYXNvbiBpdCBpc24ndCBoYW5kbGVkLgogCSAqLwogCWlmICghKGNoaXAt
PmZsYWdzICYgVFBNX0NISVBfRkxBR19UUE0yKSkgewotCQlyZXQgPSByZXF1ZXN0X2xvY2FsaXR5
KGNoaXAsIDApOworCQlyZXQgPSB0cG1fdGlzX3JlcXVlc3RfbG9jYWxpdHkoY2hpcCwgMCk7CiAJ
CWlmIChyZXQgPCAwKQogCQkJcmV0dXJuIHJldDsKIAogCQl0cG0xX2RvX3NlbGZ0ZXN0KGNoaXAp
OwogCi0JCXJlbGVhc2VfbG9jYWxpdHkoY2hpcCwgMCk7CisJCXRwbV90aXNfcmVsaW5xdWlzaF9s
b2NhbGl0eShjaGlwLCAwKTsKIAl9CiAKIAlyZXR1cm4gMDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Y2hhci90cG0vdHBtX3Rpc19jb3JlLmggYi9kcml2ZXJzL2NoYXIvdHBtL3RwbV90aXNfY29yZS5o
CmluZGV4IDJkZWVmMTFjODhkYi4uMTNiZGNmMzhlNTZmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2No
YXIvdHBtL3RwbV90aXNfY29yZS5oCisrKyBiL2RyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3Jl
LmgKQEAgLTkxLDYgKzkxLDggQEAgZW51bSB0cG1fdGlzX2ZsYWdzIHsKIAogc3RydWN0IHRwbV90
aXNfZGF0YSB7CiAJdTE2IG1hbnVmYWN0dXJlcl9pZDsKKwlzdHJ1Y3QgbXV0ZXggbG9jYWxpdHlf
Y291bnRfbXV0ZXg7CisJdW5zaWduZWQgaW50IGxvY2FsaXR5X2NvdW50OwogCWludCBsb2NhbGl0
eTsKIAlpbnQgaXJxOwogCXVuc2lnbmVkIGludCBpbnRfbWFzazsKLS0gCjIuMzYuMQoK
