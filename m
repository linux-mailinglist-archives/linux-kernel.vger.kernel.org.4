Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id F061174B1CB
	for <lists+linux-kernel@lfdr.de>; Fri,  7 Jul 2023 15:31:00 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S232036AbjGGNa5 (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Fri, 7 Jul 2023 09:30:57 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:49550 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S232196AbjGGNaz (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 7 Jul 2023 09:30:55 -0400
Received: from smtp-out1.suse.de (smtp-out1.suse.de [195.135.220.28])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 847451FEC
        for <linux-kernel@vger.kernel.org>; Fri,  7 Jul 2023 06:30:50 -0700 (PDT)
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de [192.168.254.74])
        (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
         key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
        (No client certificate requested)
        by smtp-out1.suse.de (Postfix) with ESMTPS id E7C1F22695;
        Fri,  7 Jul 2023 13:30:48 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=suse.de; s=susede2_rsa;
        t=1688736648; h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
         mime-version:mime-version:content-type:content-type:
         in-reply-to:in-reply-to:references:references;
        bh=dML+Bci7dvwejb6fUN7elzw5DqVmGNwoDlI56jXp5jo=;
        b=OfKupCDLFLkgEOE1Gv6MCWiNkK7+GW6YUeLeaUAOcWOc9SFKx4HPAJ4fBbSuQPNMe9J7rl
        Glj83gAjHi7uHvlsmhLpkqgkXY2HMBMSMkUYZzYDnCPDa7cP5wK14AxxNkbhdRf73RslgL
        j8kKcs6TP8gXFbxN8MydDSZNJM9TPBI=
DKIM-Signature: v=1; a=ed25519-sha256; c=relaxed/relaxed; d=suse.de;
        s=susede2_ed25519; t=1688736648;
        h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
         mime-version:mime-version:content-type:content-type:
         in-reply-to:in-reply-to:references:references;
        bh=dML+Bci7dvwejb6fUN7elzw5DqVmGNwoDlI56jXp5jo=;
        b=VPllrIwjpS28/Oy40IrMqdng/0BqwT/L23bu9CyaTHtRoWcVsnu6tNlmyJsv1E2uX8oZdw
        nfLc5Tzn6sMsbfDg==
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de [192.168.254.74])
        (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
         key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
        (No client certificate requested)
        by imap2.suse-dmz.suse.de (Postfix) with ESMTPS id 9FB6F1346D;
        Fri,  7 Jul 2023 13:30:48 +0000 (UTC)
Received: from dovecot-director2.suse.de ([192.168.254.65])
        by imap2.suse-dmz.suse.de with ESMTPSA
        id Vd3gJYgTqGQIWgAAMHmgww
        (envelope-from <tiwai@suse.de>); Fri, 07 Jul 2023 13:30:48 +0000
Date:   Fri, 07 Jul 2023 15:30:48 +0200
Message-ID: <87wmzbkfw7.wl-tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     Mark Brown <broonie@kernel.org>
Cc:     Srinivas Kandagatla <srinivas.kandagatla@linaro.org>,
        Johan Hovold <johan@kernel.org>, perex@perex.cz,
        tiwai@suse.com, lgirdwood@gmail.com, ckeepax@opensource.cirrus.com,
        kuninori.morimoto.gx@renesas.com, linux-kernel@vger.kernel.org,
        pierre-louis.bossart@linux.intel.com, alsa-devel@alsa-project.org
Subject: Re: [PATCH] ASoC: codecs: wcd938x: fix dB range for HPHL and HPHR
In-Reply-To: <3450ef1e-cb20-4242-b482-41d3d34c4564@sirena.org.uk>
References: <20230705125723.40464-1-srinivas.kandagatla@linaro.org>
        <ZKfAUOOcGoBanHHu@hovoldconsulting.com>
        <efaf5960-bcc5-6d52-5552-e1505a13b635@linaro.org>
        <87y1jrkgdx.wl-tiwai@suse.de>
        <3450ef1e-cb20-4242-b482-41d3d34c4564@sirena.org.uk>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) Emacs/27.2 Mule/6.0
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-Spam-Status: No, score=-4.4 required=5.0 tests=BAYES_00,DKIM_SIGNED,
        DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_MED,SPF_HELO_NONE,
        SPF_PASS,T_SCC_BODY_TEXT_LINE,URIBL_BLOCKED autolearn=ham
        autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Fri, 07 Jul 2023 15:22:45 +0200,
Mark Brown wrote:
> 
> On Fri, Jul 07, 2023 at 03:20:10PM +0200, Takashi Iwai wrote:
> > Srinivas Kandagatla wrote:
> 
> > > yes, the highest value corresponds to lowest dB which is why its inverted.
> 
> > Ouch, that's a bad design choice...
> 
> It's moderately common - typically in these cases the control is
> described in the datasheet as an attenuation control rather than a gain,
> and this usually corresponds to the physical implementation being only
> able to make signals smaller relative to the reference.

Yeah, I see the use case.  The problem is, however, that we're using
the very same dB info for both gain and attenuation.  That means,
application has no idea how to interpret those dB values -- to be
added or to be subtracted.

We should have defined a new TLV type for attenuation to
differentiate, and define the TLV macro to give proper min/max.


Takashi
