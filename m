Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id C1D44691748
	for <lists+linux-kernel@lfdr.de>; Fri, 10 Feb 2023 04:44:49 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S231137AbjBJDor (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Thu, 9 Feb 2023 22:44:47 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:40898 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S229869AbjBJDop (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 9 Feb 2023 22:44:45 -0500
Received: from NAM12-MW2-obe.outbound.protection.outlook.com (mail-mw2nam12olkn2080.outbound.protection.outlook.com [40.92.23.80])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 8368074311;
        Thu,  9 Feb 2023 19:44:31 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=i9FpmwJ1xQQcP+waZPZT9DVYFqtru+MGDSAvk1XlvaoR4Y0Bd+yDHPTNt1AZkcAXYxMJyP1AynNSZhP3U5jXhT+5wuGQAxMEiNeKUeWdjPqOiLVOoumYxBNsyANxOBKSHHQj4SiEki0lEBk4L5Lype3I6pJHf7suv2BEnmeW/SrTJ8BDAEzRfI+SzlhbF6Sdtlaz6aRe8fLADJZedmfTr+iGb0cwCqkjGF9eNJydq4+dORNl2AfVYpahaR/c0WZBF4Ch80osvin16poA3yKvOCYAtaqTxSKnTjHzH9l1wL+8ptv0Tq0X3us8T7zmV9LrvU81z1ypCpp6jwSGc013qw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=HpVyLms6/HzgQmXROEJbE/HvIMbEFWoSNJ1DDcly0oE=;
 b=do0nunavctCP4Mk7Ivgpp9yzeAE0lXkuWL0uZM7UDIf+j6FP8q2gKNWeLuonzDj0SwhO4sC6/8+XmsVP8/zHEZcSouegTEbDCNIfiJJ7U0wnoKL8Dr2JjWy8DjzU3K80fxSPMcA2oq7V/RB97jBK23eLZllcSCj6JGtTqeQ6PS3eT3u/Ux3xwKcV1gRa5uVV3KiIsKzJ71wYQmCcbNqicvfD/DKc5CIMi01NJB9N64TF0soJmVfH24mpDn4bizfV+YNOP/90n36VHZAIKsGZW4wRuXIubpPlOGUSUQA6slQxjb+rrJK06CNDeIm5rBB6TTvBwzoHYDvF2O/pzLii+g==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=none; dmarc=none;
 dkim=none; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=live.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=HpVyLms6/HzgQmXROEJbE/HvIMbEFWoSNJ1DDcly0oE=;
 b=PoxazQSe5Ra+yzh0M54LpupLhvAvf7UaG4pBor6svSMCXE4tn80PigyHgZ3vlh34pRRl4LFfUFsDw63C0S+62hmJeWZcPeFas9lm6MTEPgShbCcnZ7cYcczLCHrS8xoqMcDrXZ+6Yn1E7JiSdWKn81PyXyZ1mUJB4DAyH4b1t5chANyGkU+XjtRY/3LEB/sprLGnGKKbGFKT6X7pbhsABJy4Zr4syBbMtuskeqYR2gfBq4CfO/MkDKJme/iMdnYKD6pYnjCi0QXUWSsZLgFlavrclT08qPjxLhXJfl2Y20gRQKTdrdEzpqycbG+u+Jbbzty5PQTRkDAupXpuBgCrzw==
Received: from BM1PR01MB0931.INDPRD01.PROD.OUTLOOK.COM (2603:1096:b00:2::9) by
 MAZPR01MB5554.INDPRD01.PROD.OUTLOOK.COM (2603:1096:a01:61::6) with Microsoft
 SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.6086.19; Fri, 10 Feb 2023 03:44:26 +0000
Received: from BM1PR01MB0931.INDPRD01.PROD.OUTLOOK.COM
 ([fe80::9dc7:9298:c988:474d]) by BM1PR01MB0931.INDPRD01.PROD.OUTLOOK.COM
 ([fe80::9dc7:9298:c988:474d%11]) with mapi id 15.20.6111.005; Fri, 10 Feb
 2023 03:44:26 +0000
From:   Aditya Garg <gargaditya08@live.com>
To:     Jiri Kosina <jikos@kernel.org>,
        "jkosina@suse.cz" <jkosina@suse.cz>,
        "benjamin.tissoires@redhat.com" <benjamin.tissoires@redhat.com>,
        Andy Shevchenko <andy@infradead.org>,
        "andy.shevchenko@gmail.com" <andy.shevchenko@gmail.com>
CC:     LKML <linux-kernel@vger.kernel.org>,
        "linux-input@vger.kernel.org" <linux-input@vger.kernel.org>,
        "ronald@innovation.ch" <ronald@innovation.ch>,
        "kekrby@gmail.com" <kekrby@gmail.com>,
        Orlando Chamberlain <orlandoch.dev@gmail.com>
Subject: [PATCH 2/3] HID: apple-touchbar: Add driver for the Touch Bar on
 MacBook Pros
Thread-Topic: [PATCH 2/3] HID: apple-touchbar: Add driver for the Touch Bar on
 MacBook Pros
Thread-Index: AQHZPQH444pcUE9Pn0ybBKOwkJjnOQ==
Date:   Fri, 10 Feb 2023 03:44:26 +0000
Message-ID: <868AA58D-2399-4E4A-A6C6-73F88DB13992@live.com>
References: <E5D8BEBA-3C5B-460F-BD2C-39470A793CC3@live.com>
 <40274C3D-4F4F-479C-944C-EEBDC78F959C@live.com>
In-Reply-To: <40274C3D-4F4F-479C-944C-EEBDC78F959C@live.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-ms-exchange-messagesentrepresentingtype: 1
x-tmn:  [H1dRgnGmS0FAf3TqD/55ScCs8Ckto2D4]
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: BM1PR01MB0931:EE_|MAZPR01MB5554:EE_
x-ms-office365-filtering-correlation-id: 5bea2c93-d060-4217-aece-08db0b191b5a
x-microsoft-antispam: BCL:0;
x-microsoft-antispam-message-info: iYHLjxKb9zcvbyJH2yVGuN9IpSblVP7yYPvaPg2QjJ4YfROmMzCcNeIFTHjSHt/I9W/40sZ/ey9N0+tRYcCV5ItPweiYEbLcy4t2kSQ85ix3V02fO44bbj+LTq3kRZvOd65m7dkDHWUwuk0pRRoJ/+1JTqxCE0QhHxDrW5ZBxtw9N6PCLabdR88hdGTiFZGd6an4K9530o5KFrtbCyWoMj0mjZIIPLWuX/l2hPSe7wY85IfnIWofeAhOa2HGxF+9b5JpC1N2osxQfvzT5I+0xzLA00rSKFI0oqLGApwTo5B/vAM/of+EHQAbzHJx0HE4Kdpttp9oZ4LPAXLT0Ta1Zepc6esQ2MuijMoI91M5lFsAtulf24+mJ995GnimqVgX9N5aJpDiSgoaHnwyrnSq4id9xX9tV5ezgn3WCp2T3zlA0TydjKN60q3N0iroblbJIrSiKxAhcERCfEAKd3p+H4vyGcqzoqYa66RUfpfdpWm6rUdGtL5pH1b5MtOTKyIZnIi0BSuRASbZjqctixooTVlE4qjaVmrI4BU0cRb0CAy+gExrO/KxoLv0z6soaumMLaUBjFx5gtsULq81GF5sUBiMt41jlcuBkA3Gm1846EM=
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?utf-8?B?Vm1FcGNCczIvaTdVZ3lVek5MUTlYS0hEMk10QWJyd25KakpkVnFaUWQ2YUU2?=
 =?utf-8?B?L1FHclhramJKazhuaURQYnhOd2tpL1gwYnZ1RTl5a1VDTjVzYXduejFkL3ZD?=
 =?utf-8?B?RkNOdTZnSWJsYTQ0VXVEeGNycTZFbXphRWM3ZGZ0ZHpRR3lIRnovb1p3ZE5U?=
 =?utf-8?B?YnFRTkc4Mk5La3NXeGtDQkdLT0d1K2I3TFI3clRnc0o2SUpUK1NKWG9TRko5?=
 =?utf-8?B?dXhrV1RBczZlVmhGRUZhK1J5UFNIMVhndmxKRithZlZsaWRQZERja2ZZa0hn?=
 =?utf-8?B?RGIrK28wOGZBVzhOZWxBa1NXU1NuYlRhVXV2aEdrb2pDNE0zMHphSWZGbnp5?=
 =?utf-8?B?bUZ0ZEtNUWt5M0FuS1FnUXB1UTBnWlhIelc5aDUyempVUFFYME1KVmxNMm9O?=
 =?utf-8?B?cXptQ2Z5NE5HanYzSXE3cjg3OGNqZDhGV1ZTWVlWOUliVHViRVNDNFY1Vm5B?=
 =?utf-8?B?M3NRdkVWUHYxZ01CYklvYmhZR01EWldpRGV2amFpQWhDdDQ3M1g3b2orNTJl?=
 =?utf-8?B?RkFwREVPMklVYmNHQk9DVlRUV3FxZ2lQVklZUytYa1UyLzlyWk0yZXhUUnlC?=
 =?utf-8?B?SGVrYkRQRUU2UjAwSUt1bXJQL2J4VElobG5rdlh4eUVGd0Q5MmRzbk93U0g5?=
 =?utf-8?B?L0o3dEd5Q0hTZUEwU3FTMWV3U2RnUk1oWE43MTBnU0htb1R0YmFic29FWW1z?=
 =?utf-8?B?Mk5kWjlQRk9DL1AzNHFuT1IzMWcvWHduaEM5dEQ4Q1ZtalYrbEh1cDh3QUZK?=
 =?utf-8?B?M2JuMnB1QzlmcHpzQ1h6clNTb3BOYlJ4dDV6OGdqTWgvZXJGcm5VdzNlUGRu?=
 =?utf-8?B?ekhPN0FEbjBUWkhwWXA4Zm81OFMyWTBNN2Z3UWh6OWJxWDNQVWZKQS8zN1cr?=
 =?utf-8?B?bmhVVmxZTU9LVnJXOFE4aTFub1NLNFNFTkxFRGxwbE9BdkJPYithMGRoaHRU?=
 =?utf-8?B?U2JoWEF0MEt0MlMrRHhLOEdWRE5oT2gvT01LQ29nNnpzMTcxM2RxeVArVytV?=
 =?utf-8?B?cG4va2pvTUxodkM5aGZoeDBPVWt5VEJMa3VLY2dpSG9Zbk5nM09iNDFwOXVE?=
 =?utf-8?B?dTA4ZjdzeFlyT0FRMjUray9SSldnYXhWUkE2SHlWK3NDYXh1cHFZTXFqaG5q?=
 =?utf-8?B?aFFkdWIzM2FhYXJ5MmlxQURuV1dQNDBsdHJsajhnUjFOenN2NzRDTEV0UHY0?=
 =?utf-8?B?NGY3c2hsY0xIVnpmWGJJNEpFcGc1aEZNSWNPN3VQaVd3UnA2ODNXbFBVYzRZ?=
 =?utf-8?B?TFQrMXVzbzJtQzF6Z1RKU0JpRjFGMU5ONEtyR1ZQdVBic3BCWVFSWEFmMERZ?=
 =?utf-8?B?S3oveWRKUW9DUzlDbndFVnIraDRzektDdHpYdy8zZVI5UXdxQk9sMDVJNXZQ?=
 =?utf-8?B?WUREaFp2VFdPelhCYlB5ZHFPekNBcmlQcHJHeHVJS2RJdnhmKzNFMEFSZ3E3?=
 =?utf-8?B?ak9zNWFsdlJiN2pFWnllcEo2aUJFM0hraDBPVDdtUHpQTzlaNFI5Ly9kODR0?=
 =?utf-8?B?ajgvSVhjTkpzWWFJYi84cTlmbllMN2pLd3lUZEhlY3ZvVk9aNjBaMkphN0hS?=
 =?utf-8?B?azhVYWRuY1M1dWZiQUsySG8rZXRGbWM1NzNKTW5MR2hiSkZ1VVU1eDU0d2NE?=
 =?utf-8?B?elJOaDJQc2dzakY4cXgrM2FBZXkwa2Voc2JYSmd5Q3IxTHpyZUJXV1VJNDRW?=
 =?utf-8?B?dWdCN1hBVWpxVThUenowb05TWEE5bUJwa1ZhbWdWeW43Y214ekdtaW5nPT0=?=
Content-Type: text/plain; charset="utf-8"
Content-ID: <30A691B92BE79F4F91459B2DFBF374FC@INDPRD01.PROD.OUTLOOK.COM>
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-OriginatorOrg: sct-15-20-4755-11-msonline-outlook-42ed3.templateTenant
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: BM1PR01MB0931.INDPRD01.PROD.OUTLOOK.COM
X-MS-Exchange-CrossTenant-RMS-PersistedConsumerOrg: 00000000-0000-0000-0000-000000000000
X-MS-Exchange-CrossTenant-Network-Message-Id: 5bea2c93-d060-4217-aece-08db0b191b5a
X-MS-Exchange-CrossTenant-originalarrivaltime: 10 Feb 2023 03:44:26.3760
 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 84df9e7f-e9f6-40af-b435-aaaaaaaaaaaa
X-MS-Exchange-CrossTenant-rms-persistedconsumerorg: 00000000-0000-0000-0000-000000000000
X-MS-Exchange-Transport-CrossTenantHeadersStamped: MAZPR01MB5554
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00,DKIM_SIGNED,
        DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,FREEMAIL_ENVFROM_END_DIGIT,
        FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,RCVD_IN_MSPIKE_H2,SPF_HELO_PASS,
        SPF_PASS autolearn=ham autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

RnJvbTogUm9uYWxkIFRzY2hhbMOkciA8cm9uYWxkQGlubm92YXRpb24uY2g+DQoNClRoaXMgZHJp
dmVyIGVuYWJsZXMgYmFzaWMgdG91Y2ggYmFyIGZ1bmN0aW9uYWxpdHk6IGVuYWJsaW5nIGl0LCBz
d2l0Y2hpbmcNCmJldHdlZW4gbW9kZXMgb24gRk4ga2V5IHByZXNzLCBhbmQgZGltbWluZyBhbmQg
dHVybmluZyB0aGUgZGlzcGxheQ0Kb2ZmL29uIHdoZW4gaWRsZS9hY3RpdmUuDQoNClNpZ25lZC1v
ZmYtYnk6IFJvbmFsZCBUc2NoYWzDpHIgPHJvbmFsZEBpbm5vdmF0aW9uLmNoPg0KW0tlcmVtIEth
cmFiYXk6IHVzZSBVU0IgcHJvZHVjdCBJRHMgZnJvbSBoaWQtaWRzLmhdDQpbS2VyZW0gS2FyYWJh
eTogdXNlIGhpZF9od19yYXdfcmVxdWVzdCBleGNlcHQgd2hlbiBzZXR0aW5nIHRoZSB0b3VjaGJh
ciBtb2RlIG9uIFQxIE1hY3NdDQpbS2VyZW0gS2FyYWJheTogdXBkYXRlIEtjb25maWcgZGVzY3Jp
cHRpb25dDQpTaWduZWQtb2ZmLWJ5OiBLZXJlbSBLYXJhYmF5IDxrZWtyYnlAZ21haWwuY29tPg0K
W09ybGFuZG8gQ2hhbWJlcmxhaW46IGFkZCB1c2FnZSBjaGVjayB0byBub3QgYmluZCB0byBrZXli
b2FyZCBiYWNrbGlnaHQgaW50ZXJmYWNlXQ0KU2lnbmVkLW9mZi1ieTogT3JsYW5kbyBDaGFtYmVy
bGFpbiA8b3JsYW5kb2NoLmRldkBnbWFpbC5jb20+DQpbQWRpdHlhIEdhcmc6IGNoZWNrIGlmIGFw
cGxlLXRvdWNoYmFyIGlzIGVuYWJsZWQgaW4gdGhlIHNwZWNpYWwgZHJpdmVyIGxpc3RdDQpbQWRp
dHlhIEdhcmc6IGZpeCBzdXNwZW5kIG9uIFQyIE1hY3NdDQpTaWduZWQtb2ZmLWJ5OiBBZGl0eWEg
R2FyZyA8Z2FyZ2FkaXR5YTA4QGxpdmUuY29tPg0KLS0tDQogZHJpdmVycy9oaWQvS2NvbmZpZyAg
ICAgICAgICB8ICAgMTEgKw0KIGRyaXZlcnMvaGlkL01ha2VmaWxlICAgICAgICAgfCAgICAxICsN
CiBkcml2ZXJzL2hpZC9hcHBsZS10b3VjaGJhci5jIHwgMTUwMCArKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrDQogZHJpdmVycy9oaWQvaGlkLXF1aXJrcy5jICAgICB8ICAgIDYgKy0N
CiA0IGZpbGVzIGNoYW5nZWQsIDE1MTYgaW5zZXJ0aW9ucygrKSwgMiBkZWxldGlvbnMoLSkNCiBj
cmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9oaWQvYXBwbGUtdG91Y2hiYXIuYw0KDQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9oaWQvS2NvbmZpZyBiL2RyaXZlcnMvaGlkL0tjb25maWcNCmluZGV4IGU2
OWFmYTVmNC4uNGVjNjY5MjY3IDEwMDY0NA0KLS0tIGEvZHJpdmVycy9oaWQvS2NvbmZpZw0KKysr
IGIvZHJpdmVycy9oaWQvS2NvbmZpZw0KQEAgLTEzNCw2ICsxMzQsNyBAQCBjb25maWcgSElEX0FQ
UExFX0lCUklER0UNCiAJdHJpc3RhdGUgIkFwcGxlIGlCcmlkZ2UiDQogCWRlcGVuZHMgb24gVVNC
X0hJRA0KIAlkZXBlbmRzIG9uIChYODYgJiYgQUNQSSkgfHwgQ09NUElMRV9URVNUDQorCWltcGx5
IEhJRF9BUFBMRV9UT1VDSEJBUg0KIAlpbXBseSBISURfU0VOU09SX0hVQg0KIAlpbXBseSBISURf
U0VOU09SX0FMUw0KIAloZWxwDQpAQCAtMTQ1LDYgKzE0NiwxNiBAQCBjb25maWcgSElEX0FQUExF
X0lCUklER0UNCiAJVG8gY29tcGlsZSB0aGlzIGRyaXZlciBhcyBhIG1vZHVsZSwgY2hvb3NlIE0g
aGVyZTogdGhlDQogCW1vZHVsZSB3aWxsIGJlIGNhbGxlZCBhcHBsZS1pYnJpZGdlLg0KIA0KK2Nv
bmZpZyBISURfQVBQTEVfVE9VQ0hCQVINCisJdHJpc3RhdGUgIkFwcGxlIFRvdWNoIEJhciINCisJ
ZGVwZW5kcyBvbiBVU0JfSElEDQorCWhlbHANCisJU2F5IFkgaGVyZSBpZiB5b3Ugd2FudCBzdXBw
b3J0IGZvciB0aGUgVG91Y2ggQmFyIG9uIHg4Ng0KKwlNYWNCb29rIFByb3MuDQorDQorCVRvIGNv
bXBpbGUgdGhpcyBkcml2ZXIgYXMgYSBtb2R1bGUsIGNob29zZSBNIGhlcmU6IHRoZQ0KKwltb2R1
bGUgd2lsbCBiZSBjYWxsZWQgYXBwbGUtdG91Y2hiYXIuDQorDQogY29uZmlnIEhJRF9BUFBMRUlS
DQogCXRyaXN0YXRlICJBcHBsZSBpbmZyYXJlZCByZWNlaXZlciINCiAJZGVwZW5kcyBvbiAoVVNC
X0hJRCkNCmRpZmYgLS1naXQgYS9kcml2ZXJzL2hpZC9NYWtlZmlsZSBiL2RyaXZlcnMvaGlkL01h
a2VmaWxlDQppbmRleCBiNjEzNzNjZDguLmM3OTJlNDJmZSAxMDA2NDQNCi0tLSBhL2RyaXZlcnMv
aGlkL01ha2VmaWxlDQorKysgYi9kcml2ZXJzL2hpZC9NYWtlZmlsZQ0KQEAgLTI3LDYgKzI3LDcg
QEAgb2JqLSQoQ09ORklHX0hJRF9BTFBTKQkJKz0gaGlkLWFscHMubw0KIG9iai0kKENPTkZJR19I
SURfQUNSVVgpCQkrPSBoaWQtYXhmZi5vDQogb2JqLSQoQ09ORklHX0hJRF9BUFBMRSkJCSs9IGhp
ZC1hcHBsZS5vDQogb2JqLSQoQ09ORklHX0hJRF9BUFBMRV9JQlJJREdFKQkrPSBhcHBsZS1pYnJp
ZGdlLm8NCitvYmotJChDT05GSUdfSElEX0FQUExFX1RPVUNIQkFSKQkrPSBhcHBsZS10b3VjaGJh
ci5vDQogb2JqLSQoQ09ORklHX0hJRF9BUFBMRUlSKQkrPSBoaWQtYXBwbGVpci5vDQogb2JqLSQo
Q09ORklHX0hJRF9DUkVBVElWRV9TQjA1NDApCSs9IGhpZC1jcmVhdGl2ZS1zYjA1NDAubw0KIG9i
ai0kKENPTkZJR19ISURfQVNVUykJCSs9IGhpZC1hc3VzLm8NCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2hpZC9hcHBsZS10b3VjaGJhci5jIGIvZHJpdmVycy9oaWQvYXBwbGUtdG91Y2hiYXIuYw0KbmV3
IGZpbGUgbW9kZSAxMDA2NDQNCmluZGV4IDAwMDAwMDAwMC4uZmY2YTg0OTNiDQotLS0gL2Rldi9u
dWxsDQorKysgYi9kcml2ZXJzL2hpZC9hcHBsZS10b3VjaGJhci5jDQpAQCAtMCwwICsxLDE1MDAg
QEANCisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMA0KKy8qDQorICogQXBwbGUg
VG91Y2ggQmFyIERyaXZlcg0KKyAqDQorICogQ29weXJpZ2h0IChjKSAyMDE3LTIwMTggUm9uYWxk
IFRzY2hhbMOkcg0KKyAqLw0KKw0KKy8qDQorICogUmVjZW50IE1hY0Jvb2tQcm8gbW9kZWxzIChN
YWNCb29rUHJvIDEzLFsyM10gYW5kIGxhdGVyKSBoYXZlIGEgdG91Y2ggYmFyLA0KKyAqIHdoaWNo
IGlzIGV4cG9zZWQgdmlhIHNldmVyYWwgVVNCIGludGVyZmFjZXMuIE1hY09TIHN1cHBvcnRzIGEg
ZmFuY3kgbW9kZQ0KKyAqIHdoZXJlIGFyYml0cmFyeSBidXR0b25zIGNhbiBiZSBkZWZpbmVkOyB0
aGlzIGRyaXZlciBjdXJyZW50bHkgb25seQ0KKyAqIHN1cHBvcnRzIHRoZSBzaW1wbGUgbW9kZSB0
aGF0IGNvbnNpc3RzIG9mIDMgcHJlZGVmaW5lZCBsYXlvdXRzDQorICogKGVzY2FwZS1vbmx5LCBl
c2MgKyBzcGVjaWFsIGtleXMsIGFuZCBlc2MgKyBmdW5jdGlvbiBrZXlzKS4NCisgKg0KKyAqIFRo
ZSBmaXJzdCBVU0IgSElEIGludGVyZmFjZSBzdXBwb3J0cyB0d28gcmVwb3J0cywgYW4gaW5wdXQg
cmVwb3J0IHRoYXQNCisgKiBpcyB1c2VkIHRvIHJlcG9ydCB0aGUga2V5IHByZXNzZXMsIGFuZCBh
biBvdXRwdXQgcmVwb3J0IHdoaWNoIGNhbiBiZQ0KKyAqIHVzZWQgdG8gc2V0IHRoZSB0b3VjaCBi
YXIgIm1vZGUiOiB0b3VjaCBiYXIgb2ZmIChpbiB3aGljaCBjYXNlIG5vIHRvdWNoZXMNCisgKiBh
cmUgcmVwb3J0ZWQgYXQgYWxsKSwgZXNjYXBlIGtleSBvbmx5LCBlc2NhcGUgKyAxMiBmdW5jdGlv
biBrZXlzLCBhbmQNCisgKiBlc2NhcGUgKyBzZXZlcmFsIHNwZWNpYWwga2V5cyAoaW5jbHVkaW5n
IGJyaWdodG5lc3MsIGF1ZGlvIHZvbHVtZSwNCisgKiBldGMpLiBUaGUgc2Vjb25kIGludGVyZmFj
ZSBzdXBwb3J0cyBzZXZlcmFsLCBjb21wbGV4IHJlcG9ydHMsIG1vc3Qgb2YNCisgKiB3aGljaCBh
cmUgdW5rbm93biBhdCB0aGlzIHRpbWUsIGJ1dCBvbmUgb2Ygd2hpY2ggaGFzIGJlZW4gZGV0ZXJt
aW5lZCB0bw0KKyAqIGFsbG93IGZvciBjb250cm9sbGluZyBvZiB0aGUgdG91Y2ggYmFyJ3MgYnJp
Z2h0bmVzczogb2ZmICh0aG91Z2ggdG91Y2hlcw0KKyAqIGFyZSBzdGlsbCByZXBvcnRlZCksIGRp
bW1lZCwgYW5kIGZ1bGwgYnJpZ2h0bmVzcy4gVGhpcyBkcml2ZXIgbWFrZXMNCisgKiB1c2Ugb2Yg
dGhlc2UgdHdvIHJlcG9ydHMuDQorICovDQorDQorI2RlZmluZSBkZXZfZm10KGZtdCkgInRiOiAi
IGZtdA0KKw0KKyNpbmNsdWRlIDxsaW51eC9kZXZpY2UuaD4NCisjaW5jbHVkZSA8bGludXgvaGlk
Lmg+DQorI2luY2x1ZGUgPGxpbnV4L2lucHV0Lmg+DQorI2luY2x1ZGUgPGxpbnV4L2ppZmZpZXMu
aD4NCisjaW5jbHVkZSA8bGludXgva3RpbWUuaD4NCisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+
DQorI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4NCisjaW5jbHVkZSA8bGludXgvc3BpbmxvY2suaD4N
CisjaW5jbHVkZSA8bGludXgvc3RyaW5nLmg+DQorI2luY2x1ZGUgPGxpbnV4L3N5c2ZzLmg+DQor
I2luY2x1ZGUgPGxpbnV4L3VzYi9jaDkuaD4NCisjaW5jbHVkZSA8bGludXgvdXNiLmg+DQorI2lu
Y2x1ZGUgPGxpbnV4L3dvcmtxdWV1ZS5oPg0KKw0KKyNpbmNsdWRlICJoaWQtaWRzLmgiDQorI2lu
Y2x1ZGUgImFwcGxlLWlicmlkZ2UuaCINCisNCisjZGVmaW5lIEhJRF9VUF9BUFBMRQkJMHhmZjEy
MDAwMA0KKyNkZWZpbmUgSElEX1VTQUdFX01PREUJCShISURfVVBfQ1VTVE9NIHwgMHgwMDA0KQ0K
KyNkZWZpbmUgSElEX1VTQUdFX0FQUExFX0FQUAkoSElEX1VQX0FQUExFICB8IDB4MDAwMSkNCisj
ZGVmaW5lIEhJRF9VU0FHRV9ESVNQCQkoSElEX1VQX0FQUExFICB8IDB4MDAyMSkNCisjZGVmaW5l
IEhJRF9VU0FHRV9ESVNQX0FVWDEJKEhJRF9VUF9BUFBMRSAgfCAweDAwMjApDQorDQorI2RlZmlu
ZSBBUFBMRVRCX01BWF9UQl9LRVlTCTEzCS8qIEVTQywgRjEtRjEyICovDQorDQorI2RlZmluZSBB
UFBMRVRCX0NNRF9NT0RFX0VTQwkwDQorI2RlZmluZSBBUFBMRVRCX0NNRF9NT0RFX0ZOCTENCisj
ZGVmaW5lIEFQUExFVEJfQ01EX01PREVfU1BDTAkyDQorI2RlZmluZSBBUFBMRVRCX0NNRF9NT0RF
X09GRgkzDQorI2RlZmluZSBBUFBMRVRCX0NNRF9NT0RFX1VQRAkyNTQNCisjZGVmaW5lIEFQUExF
VEJfQ01EX01PREVfTk9ORQkyNTUNCisNCisjZGVmaW5lIEFQUExFVEJfQ01EX0RJU1BfT04JMQ0K
KyNkZWZpbmUgQVBQTEVUQl9DTURfRElTUF9ESU0JMg0KKyNkZWZpbmUgQVBQTEVUQl9DTURfRElT
UF9PRkYJNA0KKyNkZWZpbmUgQVBQTEVUQl9DTURfRElTUF9VUEQJMjU0DQorI2RlZmluZSBBUFBM
RVRCX0NNRF9ESVNQX05PTkUJMjU1DQorDQorI2RlZmluZSBBUFBMRVRCX0ZOX01PREVfRktFWVMJ
MA0KKyNkZWZpbmUgQVBQTEVUQl9GTl9NT0RFX05PUk0JMQ0KKyNkZWZpbmUgQVBQTEVUQl9GTl9N
T0RFX0lOVgkyDQorI2RlZmluZSBBUFBMRVRCX0ZOX01PREVfU1BDTAkzDQorI2RlZmluZSBBUFBM
RVRCX0ZOX01PREVfRVNDCTQNCisjZGVmaW5lIEFQUExFVEJfRk5fTU9ERV9NQVgJQVBQTEVUQl9G
Tl9NT0RFX0VTQw0KKw0KKyNkZWZpbmUgQVBQTEVUQl9ERVZJRF9LRVlCT0FSRAkxDQorI2RlZmlu
ZSBBUFBMRVRCX0RFVklEX1RPVUNIUEFECTINCisNCisjZGVmaW5lIEFQUExFVEJfTUFYX0RJTV9U
SU1FCTMwDQorDQorI2RlZmluZSBBUFBMRVRCX0ZFQVRVUkVfSVNfVDEJQklUKDApDQorDQorc3Rh
dGljIGludCBhcHBsZXRiX3RiX2RlZl9pZGxlX3RpbWVvdXQgPSA1ICogNjA7DQorbW9kdWxlX3Bh
cmFtX25hbWVkKGlkbGVfdGltZW91dCwgYXBwbGV0Yl90Yl9kZWZfaWRsZV90aW1lb3V0LCBpbnQs
IDA0NDQpOw0KK01PRFVMRV9QQVJNX0RFU0MoaWRsZV90aW1lb3V0LCAiRGVmYXVsdCB0b3VjaCBi
YXIgaWRsZSB0aW1lb3V0OlxuIg0KKwkJCSAgICAgICAiICAgIFs+MF0gLSB0dXJuIHRvdWNoIGJh
ciBkaXNwbGF5IG9mZiBhZnRlciBubyBrZXlib2FyZCwgdHJhY2twYWQsIG9yIHRvdWNoIGJhciBp
bnB1dCBoYXMgYmVlbiByZWNlaXZlZCBmb3IgdGhpcyBtYW55IHNlY29uZHM7XG4iDQorCQkJICAg
ICAgICIgICAgICAgICB0aGUgZGlzcGxheSB3aWxsIGJlIHR1cm5lZCBiYWNrIG9uIGFzIHNvb24g
YXMgbmV3IGlucHV0IGlzIHJlY2VpdmVkXG4iDQorCQkJICAgICAgICIgICAgIDAgLSB0dXJuIHRv
dWNoIGJhciBkaXNwbGF5IG9mZiAoaW5wdXQgZG9lcyBub3QgdHVybiBpdCBvbiBhZ2FpbilcbiIN
CisJCQkgICAgICAgIiAgICAtMSAtIHR1cm4gdG91Y2ggYmFyIGRpc3BsYXkgb24gKGRvZXMgbm90
IHR1cm4gb2ZmIGF1dG9tYXRpY2FsbHkpXG4iDQorCQkJICAgICAgICIgICAgLTIgLSBkaXNhYmxl
IHRvdWNoIGJhciBjb21wbGV0ZWx5Iik7DQorDQorc3RhdGljIGludCBhcHBsZXRiX3RiX2RlZl9k
aW1fdGltZW91dCA9IC0yOw0KK21vZHVsZV9wYXJhbV9uYW1lZChkaW1fdGltZW91dCwgYXBwbGV0
Yl90Yl9kZWZfZGltX3RpbWVvdXQsIGludCwgMDQ0NCk7DQorTU9EVUxFX1BBUk1fREVTQyhkaW1f
dGltZW91dCwgIkRlZmF1bHQgdG91Y2ggYmFyIGRpbSB0aW1lb3V0OlxuIg0KKwkJCSAgICAgICIg
ICAgPjAgLSBkaW0gdG91Y2ggYmFyIGRpc3BsYXkgYWZ0ZXIgbm8ga2V5Ym9hcmQsIHRyYWNrcGFk
LCBvciB0b3VjaCBiYXIgaW5wdXQgaGFzIGJlZW4gcmVjZWl2ZWQgZm9yIHRoaXMgbWFueSBzZWNv
bmRzXG4iDQorCQkJICAgICAgIiAgICAgICAgIHRoZSBkaXNwbGF5IHdpbGwgYmUgcmV0dXJuZWQg
dG8gZnVsbCBicmlnaHRuZXNzIGFzIHNvb24gYXMgbmV3IGlucHV0IGlzIHJlY2VpdmVkXG4iDQor
CQkJICAgICAgIiAgICAgMCAtIGRpbSB0b3VjaCBiYXIgZGlzcGxheSAoaW5wdXQgZG9lcyBub3Qg
cmV0dXJuIGl0IHRvIGZ1bGwgYnJpZ2h0bmVzcylcbiINCisJCQkgICAgICAiICAgIC0xIC0gZGlz
YWJsZSB0aW1lb3V0ICh0b3VjaCBiYXIgbmV2ZXIgZGltbWVkKVxuIg0KKwkJCSAgICAgICIgICAg
Wy0yXSAtIGNhbGN1bGF0ZSB0aW1lb3V0IGJhc2VkIG9uIGlkbGUtdGltZW91dCIpOw0KKw0KK3N0
YXRpYyBpbnQgYXBwbGV0Yl90Yl9kZWZfZm5fbW9kZSA9IEFQUExFVEJfRk5fTU9ERV9OT1JNOw0K
K21vZHVsZV9wYXJhbV9uYW1lZChmbm1vZGUsIGFwcGxldGJfdGJfZGVmX2ZuX21vZGUsIGludCwg
MDQ0NCk7DQorTU9EVUxFX1BBUk1fREVTQyhmbm1vZGUsICJEZWZhdWx0IEZuIGtleSBtb2RlOlxu
Ig0KKwkJCSAiICAgIDAgLSBmdW5jdGlvbi1rZXlzIG9ubHlcbiINCisJCQkgIiAgICBbMV0gLSBm
biBrZXkgc3dpdGNoZXMgZnJvbSBzcGVjaWFsIHRvIGZ1bmN0aW9uLWtleXNcbiINCisJCQkgIiAg
ICAyIC0gaW52ZXJzZSBvZiAxXG4iDQorCQkJICIgICAgMyAtIHNwZWNpYWwga2V5cyBvbmx5XG4i
DQorCQkJICIgICAgNCAtIGVzY2FwZSBrZXkgb25seSIpOw0KKw0KK3N0YXRpYyBzc2l6ZV90IGlk
bGVfdGltZW91dF9zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwNCisJCQkJIHN0cnVjdCBkZXZpY2Vf
YXR0cmlidXRlICphdHRyLCBjaGFyICpidWYpOw0KK3N0YXRpYyBzc2l6ZV90IGlkbGVfdGltZW91
dF9zdG9yZShzdHJ1Y3QgZGV2aWNlICpkZXYsDQorCQkJCSAgc3RydWN0IGRldmljZV9hdHRyaWJ1
dGUgKmF0dHIsDQorCQkJCSAgY29uc3QgY2hhciAqYnVmLCBzaXplX3Qgc2l6ZSk7DQorc3RhdGlj
IERFVklDRV9BVFRSX1JXKGlkbGVfdGltZW91dCk7DQorDQorc3RhdGljIHNzaXplX3QgZGltX3Rp
bWVvdXRfc2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsDQorCQkJCXN0cnVjdCBkZXZpY2VfYXR0cmli
dXRlICphdHRyLCBjaGFyICpidWYpOw0KK3N0YXRpYyBzc2l6ZV90IGRpbV90aW1lb3V0X3N0b3Jl
KHN0cnVjdCBkZXZpY2UgKmRldiwNCisJCQkJIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRy
LA0KKwkJCQkgY29uc3QgY2hhciAqYnVmLCBzaXplX3Qgc2l6ZSk7DQorc3RhdGljIERFVklDRV9B
VFRSX1JXKGRpbV90aW1lb3V0KTsNCisNCitzdGF0aWMgc3NpemVfdCBmbm1vZGVfc2hvdyhzdHJ1
Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLA0KKwkJCSAgIGNo
YXIgKmJ1Zik7DQorc3RhdGljIHNzaXplX3QgZm5tb2RlX3N0b3JlKHN0cnVjdCBkZXZpY2UgKmRl
diwgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsDQorCQkJICAgIGNvbnN0IGNoYXIgKmJ1
Ziwgc2l6ZV90IHNpemUpOw0KK3N0YXRpYyBERVZJQ0VfQVRUUl9SVyhmbm1vZGUpOw0KKw0KK3N0
YXRpYyBzdHJ1Y3QgYXR0cmlidXRlICphcHBsZXRiX2F0dHJzW10gPSB7DQorCSZkZXZfYXR0cl9p
ZGxlX3RpbWVvdXQuYXR0ciwNCisJJmRldl9hdHRyX2RpbV90aW1lb3V0LmF0dHIsDQorCSZkZXZf
YXR0cl9mbm1vZGUuYXR0ciwNCisJTlVMTCwNCit9Ow0KKw0KK3N0YXRpYyBjb25zdCBzdHJ1Y3Qg
YXR0cmlidXRlX2dyb3VwIGFwcGxldGJfYXR0cl9ncm91cCA9IHsNCisJLmF0dHJzID0gYXBwbGV0
Yl9hdHRycywNCit9Ow0KKw0KK3N0cnVjdCBhcHBsZXRiX2RldmljZSB7DQorCWJvb2wJCQlhY3Rp
dmU7DQorCXN0cnVjdCBkZXZpY2UJCSpsb2dfZGV2Ow0KKw0KKwlzdHJ1Y3QgaGlkX2ZpZWxkCSpt
b2RlX2ZpZWxkOw0KKwlzdHJ1Y3QgaGlkX2ZpZWxkCSpkaXNwX2ZpZWxkOw0KKwlzdHJ1Y3QgaGlk
X2ZpZWxkCSpkaXNwX2ZpZWxkX2F1eDE7DQorCXN0cnVjdCBhcHBsZXRiX2lmYWNlX2luZm8gew0K
KwkJc3RydWN0IGhpZF9kZXZpY2UJKmhkZXY7DQorCQlzdHJ1Y3QgdXNiX2ludGVyZmFjZQkqdXNi
X2lmYWNlOw0KKwkJYm9vbAkJCXN1c3BlbmRlZDsNCisJfQkJCW1vZGVfaWZhY2UsIGRpc3BfaWZh
Y2U7DQorDQorCXN0cnVjdCBpbnB1dF9oYW5kbGVyCWlucF9oYW5kbGVyOw0KKwlzdHJ1Y3QgaW5w
dXRfaGFuZGxlCWtiZF9oYW5kbGU7DQorCXN0cnVjdCBpbnB1dF9oYW5kbGUJdHBkX2hhbmRsZTsN
CisNCisJYm9vbAkJCWxhc3RfdGJfa2V5c19wcmVzc2VkW0FQUExFVEJfTUFYX1RCX0tFWVNdOw0K
Kwlib29sCQkJbGFzdF90Yl9rZXlzX3RyYW5zbGF0ZWRbQVBQTEVUQl9NQVhfVEJfS0VZU107DQor
CWJvb2wJCQlsYXN0X2ZuX3ByZXNzZWQ7DQorDQorCWt0aW1lX3QJCQlsYXN0X2V2ZW50X3RpbWU7
DQorDQorCXVuc2lnbmVkIGNoYXIJCWN1cl90Yl9tb2RlOw0KKwl1bnNpZ25lZCBjaGFyCQlwbmRf
dGJfbW9kZTsNCisJdW5zaWduZWQgY2hhcgkJY3VyX3RiX2Rpc3A7DQorCXVuc2lnbmVkIGNoYXIJ
CXBuZF90Yl9kaXNwOw0KKwlib29sCQkJdGJfYXV0b3BtX29mZjsNCisJYm9vbAkJCXJlc3RvcmVf
YXV0b3BtOw0KKwlzdHJ1Y3QgZGVsYXllZF93b3JrCXRiX3dvcms7DQorCS8qIHByb3RlY3RzIG1v
c3Qgb2YgdGhlIGFib3ZlICovDQorCXNwaW5sb2NrX3QJCXRiX2xvY2s7DQorDQorCWludAkJCWRp
bV90aW1lb3V0Ow0KKwlpbnQJCQlpZGxlX3RpbWVvdXQ7DQorCWJvb2wJCQlkaW1fdG9faXNfY2Fs
YzsNCisJaW50CQkJZm5fbW9kZTsNCisNCisJYm9vbAkJCWlzX3QxOw0KK307DQorDQorc3RydWN0
IGFwcGxldGJfa2V5X3RyYW5zbGF0aW9uIHsNCisJdTE2IGZyb207DQorCXUxNiB0bzsNCit9Ow0K
Kw0KK3N0YXRpYyBjb25zdCBzdHJ1Y3QgYXBwbGV0Yl9rZXlfdHJhbnNsYXRpb24gYXBwbGV0Yl9m
bl9jb2Rlc1tdID0gew0KKwl7IEtFWV9GMSwgIEtFWV9CUklHSFRORVNTRE9XTiB9LA0KKwl7IEtF
WV9GMiwgIEtFWV9CUklHSFRORVNTVVAgfSwNCisJeyBLRVlfRjMsICBLRVlfU0NBTEUgfSwJCS8q
IG5vdCB1c2VkICovDQorCXsgS0VZX0Y0LCAgS0VZX0RBU0hCT0FSRCB9LAkvKiBub3QgdXNlZCAq
Lw0KKwl7IEtFWV9GNSwgIEtFWV9LQkRJTExVTURPV04gfSwNCisJeyBLRVlfRjYsICBLRVlfS0JE
SUxMVU1VUCB9LA0KKwl7IEtFWV9GNywgIEtFWV9QUkVWSU9VU1NPTkcgfSwNCisJeyBLRVlfRjgs
ICBLRVlfUExBWVBBVVNFIH0sDQorCXsgS0VZX0Y5LCAgS0VZX05FWFRTT05HIH0sDQorCXsgS0VZ
X0YxMCwgS0VZX01VVEUgfSwNCisJeyBLRVlfRjExLCBLRVlfVk9MVU1FRE9XTiB9LA0KKwl7IEtF
WV9GMTIsIEtFWV9WT0xVTUVVUCB9LA0KK307DQorDQorc3RhdGljIHN0cnVjdCBhcHBsZXRiX2Rl
dmljZSAqYXBwbGV0Yl9kZXY7DQorDQorc3RhdGljIGJvb2wgYXBwbGV0Yl9kaXNhYmxlX2F1dG9w
bShzdHJ1Y3QgaGlkX2RldmljZSAqaGRldikNCit7DQorCWludCByYzsNCisNCisJcmMgPSBoaWRf
aHdfcG93ZXIoaGRldiwgUE1fSElOVF9GVUxMT04pOw0KKw0KKwlpZiAocmMgPT0gMCkNCisJCXJl
dHVybiB0cnVlOw0KKw0KKwloaWRfZXJyKGhkZXYsDQorCQkiRmFpbGVkIHRvIGRpc2FibGUgYXV0
by1wbSBvbiB0b3VjaCBiYXIgZGV2aWNlICglZClcbiIsIHJjKTsNCisJcmV0dXJuIGZhbHNlOw0K
K30NCisNCisvKg0KKyAqIFdoaWxlIHRoZSBtb2RlIGZ1bmN0aW9uYWxpdHkgaXMgbGlzdGVkIGFz
IGEgdmFsaWQgaGlkIHJlcG9ydCBpbiB0aGUgdXNiDQorICogaW50ZXJmYWNlIGRlc2NyaXB0b3Is
IG9uIGEgVDEgaXQncyBub3Qgc2VudCB0aGF0IHdheS4gSW5zdGVhZCBpdCdzIHNlbnQgd2l0aA0K
KyAqIGRpZmZlcmVudCByZXF1ZXN0LXR5cGUgYW5kIHdpdGhvdXQgYSBsZWFkaW5nIHJlcG9ydC1p
ZCBpbiB0aGUgZGF0YS4gSGVuY2UNCisgKiB3ZSBuZWVkIHRvIHNlbmQgaXQgYXMgYSBjdXN0b20g
dXNiIGNvbnRyb2wgbWVzc2FnZSByYXRoZXIgdmlhIGFueSBvZiB0aGUNCisgKiBzdGFuZGFyZCBo
aWRfaHdfKnJlcXVlc3QoKSBmdW5jdGlvbnMuIFRoZSBkZXZpY2UgbWlnaHQgcmV0dXJuIEVQSVBF
IGZvciBhDQorICogd2hpbGUgYWZ0ZXIgc2V0dGluZyB0aGUgZGlzcGxheSBtb2RlIG9uIFQxIG1v
ZGVscywgc28gcmV0cnlpbmcgc2hvdWxkIGJlDQorICogZG9uZSBvbiB0aG9zZSBtb2RlbHMuDQor
ICovDQorc3RhdGljIGludCBhcHBsZXRiX3NldF90Yl9tb2RlKHN0cnVjdCBhcHBsZXRiX2Rldmlj
ZSAqdGJfZGV2LA0KKwkJCSAgICAgICB1bnNpZ25lZCBjaGFyIG1vZGUpDQorew0KKwlzdHJ1Y3Qg
aGlkX3JlcG9ydCAqcmVwb3J0Ow0KKwl2b2lkICpidWY7DQorCWJvb2wgYXV0b3BtX29mZiA9IGZh
bHNlOw0KKwlpbnQgcmM7DQorDQorCWlmICghdGJfZGV2LT5tb2RlX2lmYWNlLmhkZXYpDQorCQly
ZXR1cm4gLUVOT1RDT05OOw0KKw0KKwlyZXBvcnQgPSB0Yl9kZXYtPm1vZGVfZmllbGQtPnJlcG9y
dDsNCisNCisJaWYgKHRiX2Rldi0+aXNfdDEpIHsNCisJCWJ1ZiA9IGttZW1kdXAoJm1vZGUsIDEs
IEdGUF9LRVJORUwpOw0KKwl9IGVsc2Ugew0KKwkJY2hhciBkYXRhW10gPSB7IHJlcG9ydC0+aWQs
IG1vZGUgfTsNCisNCisJCWJ1ZiA9IGttZW1kdXAoZGF0YSwgc2l6ZW9mKGRhdGEpLCBHRlBfS0VS
TkVMKTsNCisJfQ0KKwlpZiAoIWJ1ZikNCisJCXJldHVybiAtRU5PTUVNOw0KKw0KKwlhdXRvcG1f
b2ZmID0gYXBwbGV0Yl9kaXNhYmxlX2F1dG9wbSh0Yl9kZXYtPm1vZGVfaWZhY2UuaGRldik7DQor
DQorCWlmICh0Yl9kZXYtPmlzX3QxKSB7DQorCQlpbnQgdHJpZXMgPSAwOw0KKwkJc3RydWN0IHVz
Yl9kZXZpY2UgKmRldiA9IGludGVyZmFjZV90b191c2JkZXYodGJfZGV2LT5tb2RlX2lmYWNlLnVz
Yl9pZmFjZSk7DQorCQlfX3U4IGlmbnVtID0gdGJfZGV2LT5tb2RlX2lmYWNlLnVzYl9pZmFjZS0+
Y3VyX2FsdHNldHRpbmctPmRlc2MuYkludGVyZmFjZU51bWJlcjsNCisNCisJCWRvIHsNCisJCQly
YyA9IHVzYl9jb250cm9sX21zZyhkZXYsIHVzYl9zbmRjdHJscGlwZShkZXYsIDApLCBISURfUkVR
X1NFVF9SRVBPUlQsDQorCQkJCQkgICAgIFVTQl9ESVJfT1VUIHwgVVNCX1JFQ0lQX0lOVEVSRkFD
RSB8IFVTQl9UWVBFX1ZFTkRPUiwNCisJCQkJCSAgICAgKHJlcG9ydC0+dHlwZSArIDEpIDw8IDgg
fCByZXBvcnQtPmlkLA0KKwkJCQkJICAgICBpZm51bSwgYnVmLCAxLCAyMDAwKTsNCisNCisJCQlp
ZiAocmMgIT0gLUVQSVBFKQ0KKwkJCQlicmVhazsNCisNCisJCQl1c2xlZXBfcmFuZ2UoMTAwMCA8
PCB0cmllcywgMzAwMCA8PCB0cmllcyk7DQorCQl9IHdoaWxlICgrK3RyaWVzIDwgNSk7DQorCX0g
ZWxzZSB7DQorCQlyYyA9IGhpZF9od19yYXdfcmVxdWVzdCh0Yl9kZXYtPm1vZGVfaWZhY2UuaGRl
diwgcmVwb3J0LT5pZCwNCisJCQkJCShfX3U4ICopIGJ1ZiwgMiwgcmVwb3J0LT50eXBlLA0KKwkJ
CQkJSElEX1JFUV9TRVRfUkVQT1JUKTsNCisJfQ0KKw0KKwlpZiAocmMgPCAwKQ0KKwkJZGV2X2Vy
cih0Yl9kZXYtPmxvZ19kZXYsDQorCQkJIkZhaWxlZCB0byBzZXQgdG91Y2ggYmFyIG1vZGUgdG8g
JXUgKCVkKVxuIiwgbW9kZSwgcmMpOw0KKw0KKwlpZiAoYXV0b3BtX29mZikNCisJCWhpZF9od19w
b3dlcih0Yl9kZXYtPm1vZGVfaWZhY2UuaGRldiwgUE1fSElOVF9OT1JNQUwpOw0KKw0KKwlrZnJl
ZShidWYpOw0KKw0KKwlyZXR1cm4gcmM7DQorfQ0KKw0KK3N0YXRpYyBpbnQgYXBwbGV0Yl9zZXRf
dGJfZGlzcChzdHJ1Y3QgYXBwbGV0Yl9kZXZpY2UgKnRiX2RldiwNCisJCQkgICAgICAgdW5zaWdu
ZWQgY2hhciBkaXNwKQ0KK3sNCisJc3RydWN0IGhpZF9yZXBvcnQgKnJlcG9ydDsNCisJaW50IHJj
Ow0KKw0KKwlpZiAoIXRiX2Rldi0+ZGlzcF9pZmFjZS5oZGV2KQ0KKwkJcmV0dXJuIC1FTk9UQ09O
TjsNCisNCisJcmVwb3J0ID0gdGJfZGV2LT5kaXNwX2ZpZWxkLT5yZXBvcnQ7DQorDQorCXJjID0g
aGlkX3NldF9maWVsZCh0Yl9kZXYtPmRpc3BfZmllbGRfYXV4MSwgMCwgMSk7DQorCWlmIChyYykg
ew0KKwkJZGV2X2Vycih0Yl9kZXYtPmxvZ19kZXYsDQorCQkJIkZhaWxlZCB0byBzZXQgZGlzcGxh
eSByZXBvcnQgZmllbGQgKCVkKVxuIiwgcmMpOw0KKwkJcmV0dXJuIHJjOw0KKwl9DQorDQorCXJj
ID0gaGlkX3NldF9maWVsZCh0Yl9kZXYtPmRpc3BfZmllbGQsIDAsIGRpc3ApOw0KKwlpZiAocmMp
IHsNCisJCWRldl9lcnIodGJfZGV2LT5sb2dfZGV2LA0KKwkJCSJGYWlsZWQgdG8gc2V0IGRpc3Bs
YXkgcmVwb3J0IGZpZWxkICglZClcbiIsIHJjKTsNCisJCXJldHVybiByYzsNCisJfQ0KKw0KKwkv
Kg0KKwkgKiBLZWVwIHRoZSBVU0IgaW50ZXJmYWNlIHBvd2VyZWQgb24gd2hpbGUgdGhlIHRvdWNo
IGJhciBkaXNwbGF5IGlzIG9uDQorCSAqIGZvciBiZXR0ZXIgcmVzcG9uc2l2ZW5lc3MuDQorCSAq
Lw0KKwlpZiAoZGlzcCAhPSBBUFBMRVRCX0NNRF9ESVNQX09GRiAmJiAhdGJfZGV2LT50Yl9hdXRv
cG1fb2ZmKQ0KKwkJdGJfZGV2LT50Yl9hdXRvcG1fb2ZmID0NCisJCQlhcHBsZXRiX2Rpc2FibGVf
YXV0b3BtKHJlcG9ydC0+ZGV2aWNlKTsNCisNCisJaGlkX2h3X3JlcXVlc3QodGJfZGV2LT5kaXNw
X2lmYWNlLmhkZXYsIHJlcG9ydCwgSElEX1JFUV9TRVRfUkVQT1JUKTsNCisNCisJaWYgKGRpc3Ag
PT0gQVBQTEVUQl9DTURfRElTUF9PRkYgJiYgdGJfZGV2LT50Yl9hdXRvcG1fb2ZmKSB7DQorCQlo
aWRfaHdfcG93ZXIodGJfZGV2LT5kaXNwX2lmYWNlLmhkZXYsIFBNX0hJTlRfTk9STUFMKTsNCisJ
CXRiX2Rldi0+dGJfYXV0b3BtX29mZiA9IGZhbHNlOw0KKwl9DQorDQorCXJldHVybiByYzsNCit9
DQorDQorc3RhdGljIGJvb2wgYXBwbGV0Yl9hbnlfdGJfa2V5X3ByZXNzZWQoc3RydWN0IGFwcGxl
dGJfZGV2aWNlICp0Yl9kZXYpDQorew0KKwlyZXR1cm4gISFtZW1jaHJfaW52KHRiX2Rldi0+bGFz
dF90Yl9rZXlzX3ByZXNzZWQsIDAsDQorCQkJICAgIHNpemVvZih0Yl9kZXYtPmxhc3RfdGJfa2V5
c19wcmVzc2VkKSk7DQorfQ0KKw0KK3N0YXRpYyB2b2lkIGFwcGxldGJfc2NoZWR1bGVfdGJfdXBk
YXRlKHN0cnVjdCBhcHBsZXRiX2RldmljZSAqdGJfZGV2LCBzNjQgc2VjcykNCit7DQorCXNjaGVk
dWxlX2RlbGF5ZWRfd29yaygmdGJfZGV2LT50Yl93b3JrLCBtc2Vjc190b19qaWZmaWVzKHNlY3Mg
KiAxMDAwKSk7DQorfQ0KKw0KK3N0YXRpYyB2b2lkIGFwcGxldGJfc2V0X3RiX3dvcmtlcihzdHJ1
Y3Qgd29ya19zdHJ1Y3QgKndvcmspDQorew0KKwlzdHJ1Y3QgYXBwbGV0Yl9kZXZpY2UgKnRiX2Rl
diA9DQorCQljb250YWluZXJfb2Yod29yaywgc3RydWN0IGFwcGxldGJfZGV2aWNlLCB0Yl93b3Jr
LndvcmspOw0KKwlzNjQgdGltZV9sZWZ0ID0gMCwgbWluX3RpbWVvdXQsIHRpbWVfdG9fb2ZmOw0K
Kwl1bnNpZ25lZCBjaGFyIHBlbmRpbmdfbW9kZTsNCisJdW5zaWduZWQgY2hhciBwZW5kaW5nX2Rp
c3A7DQorCXVuc2lnbmVkIGNoYXIgY3VycmVudF9kaXNwOw0KKwlib29sIHJlc3RvcmVfYXV0b3Bt
Ow0KKwlib29sIGFueV90Yl9rZXlfcHJlc3NlZCwgbmVlZF9yZXNjaGVkdWxlOw0KKwlpbnQgcmMx
ID0gMSwgcmMyID0gMTsNCisJdW5zaWduZWQgbG9uZyBmbGFnczsNCisNCisJc3Bpbl9sb2NrX2ly
cXNhdmUoJnRiX2Rldi0+dGJfbG9jaywgZmxhZ3MpOw0KKw0KKwkvKiBoYW5kbGUgZXhwbGljaXQg
bW9kZS1jaGFuZ2UgcmVxdWVzdCAqLw0KKwlwZW5kaW5nX21vZGUgPSB0Yl9kZXYtPnBuZF90Yl9t
b2RlOw0KKwlwZW5kaW5nX2Rpc3AgPSB0Yl9kZXYtPnBuZF90Yl9kaXNwOw0KKwlyZXN0b3JlX2F1
dG9wbSA9IHRiX2Rldi0+cmVzdG9yZV9hdXRvcG07DQorDQorCXNwaW5fdW5sb2NrX2lycXJlc3Rv
cmUoJnRiX2Rldi0+dGJfbG9jaywgZmxhZ3MpOw0KKw0KKwlpZiAocGVuZGluZ19tb2RlICE9IEFQ
UExFVEJfQ01EX01PREVfTk9ORSkNCisJCXJjMSA9IGFwcGxldGJfc2V0X3RiX21vZGUodGJfZGV2
LCBwZW5kaW5nX21vZGUpOw0KKwlpZiAocGVuZGluZ19tb2RlICE9IEFQUExFVEJfQ01EX01PREVf
Tk9ORSAmJg0KKwkgICAgcGVuZGluZ19kaXNwICE9IEFQUExFVEJfQ01EX0RJU1BfTk9ORSkNCisJ
CW1zbGVlcCgyNSk7DQorCWlmIChwZW5kaW5nX2Rpc3AgIT0gQVBQTEVUQl9DTURfRElTUF9OT05F
KQ0KKwkJcmMyID0gYXBwbGV0Yl9zZXRfdGJfZGlzcCh0Yl9kZXYsIHBlbmRpbmdfZGlzcCk7DQor
DQorCWlmIChyZXN0b3JlX2F1dG9wbSAmJiB0Yl9kZXYtPnRiX2F1dG9wbV9vZmYpDQorCQlhcHBs
ZXRiX2Rpc2FibGVfYXV0b3BtKHRiX2Rldi0+ZGlzcF9maWVsZC0+cmVwb3J0LT5kZXZpY2UpOw0K
Kw0KKwlzcGluX2xvY2tfaXJxc2F2ZSgmdGJfZGV2LT50Yl9sb2NrLCBmbGFncyk7DQorDQorCW5l
ZWRfcmVzY2hlZHVsZSA9IGZhbHNlOw0KKw0KKwlpZiAocmMxID09IDApIHsNCisJCXRiX2Rldi0+
Y3VyX3RiX21vZGUgPSBwZW5kaW5nX21vZGU7DQorDQorCQlpZiAodGJfZGV2LT5wbmRfdGJfbW9k
ZSA9PSBwZW5kaW5nX21vZGUpDQorCQkJdGJfZGV2LT5wbmRfdGJfbW9kZSA9IEFQUExFVEJfQ01E
X01PREVfTk9ORTsNCisJCWVsc2UNCisJCQluZWVkX3Jlc2NoZWR1bGUgPSB0cnVlOw0KKwl9DQor
DQorCWlmIChyYzIgPT0gMCkgew0KKwkJdGJfZGV2LT5jdXJfdGJfZGlzcCA9IHBlbmRpbmdfZGlz
cDsNCisNCisJCWlmICh0Yl9kZXYtPnBuZF90Yl9kaXNwID09IHBlbmRpbmdfZGlzcCkNCisJCQl0
Yl9kZXYtPnBuZF90Yl9kaXNwID0gQVBQTEVUQl9DTURfRElTUF9OT05FOw0KKwkJZWxzZQ0KKwkJ
CW5lZWRfcmVzY2hlZHVsZSA9IHRydWU7DQorCX0NCisJY3VycmVudF9kaXNwID0gdGJfZGV2LT5j
dXJfdGJfZGlzcDsNCisNCisJdGJfZGV2LT5yZXN0b3JlX2F1dG9wbSA9IGZhbHNlOw0KKw0KKwkv
KiBjYWxjdWxhdGUgdGltZSBsZWZ0IHRvIG5leHQgdGltZW91dCAqLw0KKwlpZiAodGJfZGV2LT5p
ZGxlX3RpbWVvdXQgPT0gLTIgfHwgdGJfZGV2LT5pZGxlX3RpbWVvdXQgPT0gMCkNCisJCW1pbl90
aW1lb3V0ID0gLTE7DQorCWVsc2UgaWYgKHRiX2Rldi0+aWRsZV90aW1lb3V0ID09IC0xKQ0KKwkJ
bWluX3RpbWVvdXQgPSB0Yl9kZXYtPmRpbV90aW1lb3V0Ow0KKwllbHNlIGlmICh0Yl9kZXYtPmRp
bV90aW1lb3V0IDw9IDApDQorCQltaW5fdGltZW91dCA9IHRiX2Rldi0+aWRsZV90aW1lb3V0Ow0K
KwllbHNlDQorCQltaW5fdGltZW91dCA9IG1pbih0Yl9kZXYtPmRpbV90aW1lb3V0LCB0Yl9kZXYt
PmlkbGVfdGltZW91dCk7DQorDQorCWlmIChtaW5fdGltZW91dCA+IDApIHsNCisJCXM2NCBpZGxl
X3RpbWUgPQ0KKwkJCShrdGltZV9tc19kZWx0YShrdGltZV9nZXQoKSwgdGJfZGV2LT5sYXN0X2V2
ZW50X3RpbWUpICsNCisJCQkgNTAwKSAvIDEwMDA7DQorDQorCQl0aW1lX2xlZnQgPSBtYXgobWlu
X3RpbWVvdXQgLSBpZGxlX3RpbWUsIDBMTCk7DQorCQlpZiAodGJfZGV2LT5pZGxlX3RpbWVvdXQg
PD0gMCkNCisJCQl0aW1lX3RvX29mZiA9IC0xOw0KKwkJZWxzZSBpZiAoaWRsZV90aW1lID49IHRi
X2Rldi0+aWRsZV90aW1lb3V0KQ0KKwkJCXRpbWVfdG9fb2ZmID0gMDsNCisJCWVsc2UNCisJCQl0
aW1lX3RvX29mZiA9IHRiX2Rldi0+aWRsZV90aW1lb3V0IC0gaWRsZV90aW1lOw0KKwl9IGVsc2Ug
ew0KKwkJLyogbm90IHVzZWQgLSBqdXN0IHRvIGFwcGVhc2UgdGhlIGNvbXBpbGVyICovDQorCQl0
aW1lX3RvX29mZiA9IDA7DQorCX0NCisNCisJYW55X3RiX2tleV9wcmVzc2VkID0gYXBwbGV0Yl9h
bnlfdGJfa2V5X3ByZXNzZWQodGJfZGV2KTsNCisNCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgm
dGJfZGV2LT50Yl9sb2NrLCBmbGFncyk7DQorDQorCWRldl9kYmcodGJfZGV2LT5sb2dfZGV2LCAi
dGltZW91dCBjYWxjOiBpZGxlX3RpbWVvdXQ9JWQgZGltX3RpbWVvdXQ9JWQgbWluX3RpbWVvdXQ9
JWxsZCB0aW1lX2xlZnQ9JWxsZCBuZWVkX3Jlc2NoZWR1bGU9JWQgYW55X3RiX2tleV9wcmVzc2Vk
PSVkXG4iLA0KKwkJdGJfZGV2LT5pZGxlX3RpbWVvdXQsIHRiX2Rldi0+ZGltX3RpbWVvdXQsIG1p
bl90aW1lb3V0LA0KKwkJdGltZV9sZWZ0LCBuZWVkX3Jlc2NoZWR1bGUsIGFueV90Yl9rZXlfcHJl
c3NlZCk7DQorDQorCS8qIGEgbmV3IGNvbW1hbmQgYXJyaXZlZCB3aGlsZSB3ZSB3ZXJlIGJ1c3kg
LSBoYW5kbGUgaXQgKi8NCisJaWYgKG5lZWRfcmVzY2hlZHVsZSkgew0KKwkJYXBwbGV0Yl9zY2hl
ZHVsZV90Yl91cGRhdGUodGJfZGV2LCAwKTsNCisJCXJldHVybjsNCisJfQ0KKw0KKwkvKiBpZiBu
byBpZGxlL2RpbSB0aW1lb3V0LCB3ZSdyZSBkb25lICovDQorCWlmIChtaW5fdGltZW91dCA8PSAw
KQ0KKwkJcmV0dXJuOw0KKw0KKwkvKiBtYW5hZ2UgaWRsZS9kaW0gdGltZW91dCAqLw0KKwlpZiAo
dGltZV9sZWZ0ID4gMCkgew0KKwkJLyogd2UgZmlyZWQgdG9vIHNvb24gb3IgaGFkIGEgbW9kZS1j
aGFuZ2UgLSByZS1zY2hlZHVsZSAqLw0KKwkJYXBwbGV0Yl9zY2hlZHVsZV90Yl91cGRhdGUodGJf
ZGV2LCB0aW1lX2xlZnQpOw0KKwl9IGVsc2UgaWYgKGFueV90Yl9rZXlfcHJlc3NlZCkgew0KKwkJ
Lyoga2V5cyBhcmUgc3RpbGwgcHJlc3NlZCAtIHJlLXNjaGVkdWxlICovDQorCQlhcHBsZXRiX3Nj
aGVkdWxlX3RiX3VwZGF0ZSh0Yl9kZXYsIG1pbl90aW1lb3V0KTsNCisJfSBlbHNlIHsNCisJCS8q
IGRpbSBvciBpZGxlIHRpbWVvdXQgcmVhY2hlZCAqLw0KKwkJaW50IG5leHRfZGlzcCA9ICh0aW1l
X3RvX29mZiA9PSAwKSA/IEFQUExFVEJfQ01EX0RJU1BfT0ZGIDoNCisJCQkJCQkgICAgIEFQUExF
VEJfQ01EX0RJU1BfRElNOw0KKwkJaWYgKG5leHRfZGlzcCAhPSBjdXJyZW50X2Rpc3AgJiYNCisJ
CSAgICBhcHBsZXRiX3NldF90Yl9kaXNwKHRiX2RldiwgbmV4dF9kaXNwKSA9PSAwKSB7DQorCQkJ
c3Bpbl9sb2NrX2lycXNhdmUoJnRiX2Rldi0+dGJfbG9jaywgZmxhZ3MpOw0KKwkJCXRiX2Rldi0+
Y3VyX3RiX2Rpc3AgPSBuZXh0X2Rpc3A7DQorCQkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdGJf
ZGV2LT50Yl9sb2NrLCBmbGFncyk7DQorCQl9DQorDQorCQlpZiAodGltZV90b19vZmYgPiAwKQ0K
KwkJCWFwcGxldGJfc2NoZWR1bGVfdGJfdXBkYXRlKHRiX2RldiwgdGltZV90b19vZmYpOw0KKwl9
DQorfQ0KKw0KK3N0YXRpYyB1MTYgYXBwbGV0Yl9mbl90b19zcGVjaWFsKHUxNiBjb2RlKQ0KK3sN
CisJaW50IGlkeDsNCisNCisJZm9yIChpZHggPSAwOyBpZHggPCBBUlJBWV9TSVpFKGFwcGxldGJf
Zm5fY29kZXMpOyBpZHgrKykgew0KKwkJaWYgKGFwcGxldGJfZm5fY29kZXNbaWR4XS5mcm9tID09
IGNvZGUpDQorCQkJcmV0dXJuIGFwcGxldGJfZm5fY29kZXNbaWR4XS50bzsNCisJfQ0KKw0KKwly
ZXR1cm4gMDsNCit9DQorDQorc3RhdGljIHVuc2lnbmVkIGNoYXIgYXBwbGV0Yl9nZXRfY3VyX3Ri
X21vZGUoc3RydWN0IGFwcGxldGJfZGV2aWNlICp0Yl9kZXYpDQorew0KKwlyZXR1cm4gdGJfZGV2
LT5wbmRfdGJfbW9kZSAhPSBBUFBMRVRCX0NNRF9NT0RFX05PTkUgPw0KKwkJCQl0Yl9kZXYtPnBu
ZF90Yl9tb2RlIDogdGJfZGV2LT5jdXJfdGJfbW9kZTsNCit9DQorDQorc3RhdGljIHVuc2lnbmVk
IGNoYXIgYXBwbGV0Yl9nZXRfY3VyX3RiX2Rpc3Aoc3RydWN0IGFwcGxldGJfZGV2aWNlICp0Yl9k
ZXYpDQorew0KKwlyZXR1cm4gdGJfZGV2LT5wbmRfdGJfZGlzcCAhPSBBUFBMRVRCX0NNRF9ESVNQ
X05PTkUgPw0KKwkJCQl0Yl9kZXYtPnBuZF90Yl9kaXNwIDogdGJfZGV2LT5jdXJfdGJfZGlzcDsN
Cit9DQorDQorc3RhdGljIHVuc2lnbmVkIGNoYXIgYXBwbGV0Yl9nZXRfZm5fdGJfbW9kZShzdHJ1
Y3QgYXBwbGV0Yl9kZXZpY2UgKnRiX2RldikNCit7DQorCXN3aXRjaCAodGJfZGV2LT5mbl9tb2Rl
KSB7DQorCWNhc2UgQVBQTEVUQl9GTl9NT0RFX0VTQzoNCisJCXJldHVybiBBUFBMRVRCX0NNRF9N
T0RFX0VTQzsNCisNCisJY2FzZSBBUFBMRVRCX0ZOX01PREVfRktFWVM6DQorCQlyZXR1cm4gQVBQ
TEVUQl9DTURfTU9ERV9GTjsNCisNCisJY2FzZSBBUFBMRVRCX0ZOX01PREVfU1BDTDoNCisJCXJl
dHVybiBBUFBMRVRCX0NNRF9NT0RFX1NQQ0w7DQorDQorCWNhc2UgQVBQTEVUQl9GTl9NT0RFX0lO
VjoNCisJCXJldHVybiAodGJfZGV2LT5sYXN0X2ZuX3ByZXNzZWQpID8gQVBQTEVUQl9DTURfTU9E
RV9TUENMIDoNCisJCQkJCQkgICBBUFBMRVRCX0NNRF9NT0RFX0ZOOw0KKw0KKwljYXNlIEFQUExF
VEJfRk5fTU9ERV9OT1JNOg0KKwlkZWZhdWx0Og0KKwkJcmV0dXJuICh0Yl9kZXYtPmxhc3RfZm5f
cHJlc3NlZCkgPyBBUFBMRVRCX0NNRF9NT0RFX0ZOIDoNCisJCQkJCQkgICBBUFBMRVRCX0NNRF9N
T0RFX1NQQ0w7DQorCX0NCit9DQorDQorLyoNCisgKiBTd2l0Y2ggdG91Y2ggYmFyIG1vZGUgYW5k
IGRpc3BsYXkgd2hlbiBtb2RlIG9yIGRpc3BsYXkgbm90IHRoZSBkZXNpcmVkIG9uZXMuDQorICov
DQorc3RhdGljIHZvaWQgYXBwbGV0Yl91cGRhdGVfdG91Y2hiYXJfbm9fbG9jayhzdHJ1Y3QgYXBw
bGV0Yl9kZXZpY2UgKnRiX2RldiwNCisJCQkJCSAgICBib29sIGZvcmNlKQ0KK3sNCisJdW5zaWdu
ZWQgY2hhciB3YW50X21vZGU7DQorCXVuc2lnbmVkIGNoYXIgd2FudF9kaXNwOw0KKwlib29sIG5l
ZWRfdXBkYXRlID0gZmFsc2U7DQorDQorCS8qDQorCSAqIENhbGN1bGF0ZSB0aGUgbmV3IG1vZGVz
Og0KKwkgKiAgIGlkbGVfdGltZW91dDoNCisJICogICAgIC0yICBtb2RlL2Rpc3Agb2ZmDQorCSAq
ICAgICAtMSAgbW9kZSBvbiwgZGlzcCBvbi9kaW0NCisJICogICAgICAwICBtb2RlIG9uLCBkaXNw
IG9mZg0KKwkgKiAgICAgPjAgIG1vZGUgb24sIGRpc3Agb2ZmIGFmdGVyIGlkbGVfdGltZW91dCBz
ZWNvbmRzDQorCSAqICAgZGltX3RpbWVvdXQgKG9ubHkgdmFsaWQgaWYgaWRsZV90aW1lb3V0ID4g
MCB8fCBpZGxlX3RpbWVvdXQgPT0gLTEpOg0KKwkgKiAgICAgLTEgIGRpc3AgbmV2ZXIgZGltbWVk
DQorCSAqICAgICAgMCAgZGlzcCBhbHdheXMgZGltbWVkDQorCSAqICAgICA+MCAgZGlzcCBkaW0g
YWZ0ZXIgZGltX3RpbWVvdXQgc2Vjb25kcw0KKwkgKi8NCisJaWYgKHRiX2Rldi0+aWRsZV90aW1l
b3V0ID09IC0yKSB7DQorCQl3YW50X21vZGUgPSBBUFBMRVRCX0NNRF9NT0RFX09GRjsNCisJCXdh
bnRfZGlzcCA9IEFQUExFVEJfQ01EX0RJU1BfT0ZGOw0KKwl9IGVsc2Ugew0KKwkJd2FudF9tb2Rl
ID0gYXBwbGV0Yl9nZXRfZm5fdGJfbW9kZSh0Yl9kZXYpOw0KKwkJd2FudF9kaXNwID0gdGJfZGV2
LT5pZGxlX3RpbWVvdXQgPT0gIDAgPyBBUFBMRVRCX0NNRF9ESVNQX09GRiA6DQorCQkJICAgIHRi
X2Rldi0+ZGltX3RpbWVvdXQgID09ICAwID8gQVBQTEVUQl9DTURfRElTUF9ESU0gOg0KKwkJCQkJ
CQkgQVBQTEVUQl9DTURfRElTUF9PTjsNCisJfQ0KKw0KKwkvKg0KKwkgKiBTZWUgaWYgd2UgbmVl
ZCB0byB1cGRhdGUgdGhlIHRvdWNoIGJhciwgdGFraW5nIGludG8gYWNjb3VudCB0aGF0IHdlDQor
CSAqIGdlbmVyYWxseSBkb24ndCB3YW50IHRvIHN3aXRjaCBtb2RlcyB3aGlsZSBhIHRvdWNoIGJh
ciBrZXkgaXMNCisJICogcHJlc3NlZC4NCisJICovDQorCWlmIChhcHBsZXRiX2dldF9jdXJfdGJf
bW9kZSh0Yl9kZXYpICE9IHdhbnRfbW9kZSAmJg0KKwkgICAgIWFwcGxldGJfYW55X3RiX2tleV9w
cmVzc2VkKHRiX2RldikpIHsNCisJCXRiX2Rldi0+cG5kX3RiX21vZGUgPSB3YW50X21vZGU7DQor
CQluZWVkX3VwZGF0ZSA9IHRydWU7DQorCX0NCisNCisJaWYgKGFwcGxldGJfZ2V0X2N1cl90Yl9k
aXNwKHRiX2RldikgIT0gd2FudF9kaXNwICYmDQorCSAgICAoIWFwcGxldGJfYW55X3RiX2tleV9w
cmVzc2VkKHRiX2RldikgfHwNCisJICAgICB3YW50X2Rpc3AgIT0gQVBQTEVUQl9DTURfRElTUF9P
RkYpKSB7DQorCQl0Yl9kZXYtPnBuZF90Yl9kaXNwID0gd2FudF9kaXNwOw0KKwkJbmVlZF91cGRh
dGUgPSB0cnVlOw0KKwl9DQorDQorCWlmIChmb3JjZSkNCisJCW5lZWRfdXBkYXRlID0gdHJ1ZTsN
CisNCisJLyogc2NoZWR1bGUgdGhlIHVwZGF0ZSBpZiBkZXNpcmVkICovDQorCWRldl9kYmdfcmF0
ZWxpbWl0ZWQodGJfZGV2LT5sb2dfZGV2LA0KKwkJCSAgICAidXBkYXRlOiBuZWVkX3VwZGF0ZT0l
ZCwgd2FudF9tb2RlPSVkLCBjdXItbW9kZT0lZCwgd2FudF9kaXNwPSVkLCBjdXItZGlzcD0lZFxu
IiwNCisJCQkgICAgbmVlZF91cGRhdGUsIHdhbnRfbW9kZSwgdGJfZGV2LT5jdXJfdGJfbW9kZSwN
CisJCQkgICAgd2FudF9kaXNwLCB0Yl9kZXYtPmN1cl90Yl9kaXNwKTsNCisNCisJaWYgKG5lZWRf
dXBkYXRlKSB7DQorCQljYW5jZWxfZGVsYXllZF93b3JrKCZ0Yl9kZXYtPnRiX3dvcmspOw0KKwkJ
YXBwbGV0Yl9zY2hlZHVsZV90Yl91cGRhdGUodGJfZGV2LCAwKTsNCisJfQ0KK30NCisNCitzdGF0
aWMgdm9pZCBhcHBsZXRiX3VwZGF0ZV90b3VjaGJhcihzdHJ1Y3QgYXBwbGV0Yl9kZXZpY2UgKnRi
X2RldiwgYm9vbCBmb3JjZSkNCit7DQorCXVuc2lnbmVkIGxvbmcgZmxhZ3M7DQorDQorCXNwaW5f
bG9ja19pcnFzYXZlKCZ0Yl9kZXYtPnRiX2xvY2ssIGZsYWdzKTsNCisNCisJaWYgKHRiX2Rldi0+
YWN0aXZlKQ0KKwkJYXBwbGV0Yl91cGRhdGVfdG91Y2hiYXJfbm9fbG9jayh0Yl9kZXYsIGZvcmNl
KTsNCisNCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdGJfZGV2LT50Yl9sb2NrLCBmbGFncyk7
DQorfQ0KKw0KK3N0YXRpYyB2b2lkIGFwcGxldGJfc2V0X2lkbGVfdGltZW91dChzdHJ1Y3QgYXBw
bGV0Yl9kZXZpY2UgKnRiX2RldiwgaW50IG5ldykNCit7DQorCXRiX2Rldi0+aWRsZV90aW1lb3V0
ID0gbmV3Ow0KKw0KKwlpZiAodGJfZGV2LT5kaW1fdG9faXNfY2FsYyAmJiB0Yl9kZXYtPmlkbGVf
dGltZW91dCA+IDApDQorCQl0Yl9kZXYtPmRpbV90aW1lb3V0ID0gbmV3IC0gbWluKEFQUExFVEJf
TUFYX0RJTV9USU1FLCBuZXcgLyAzKTsNCisJZWxzZSBpZiAodGJfZGV2LT5kaW1fdG9faXNfY2Fs
YykNCisJCXRiX2Rldi0+ZGltX3RpbWVvdXQgPSAtMTsNCit9DQorDQorc3RhdGljIHNzaXplX3Qg
aWRsZV90aW1lb3V0X3Nob3coc3RydWN0IGRldmljZSAqZGV2LA0KKwkJCQkgc3RydWN0IGRldmlj
ZV9hdHRyaWJ1dGUgKmF0dHIsIGNoYXIgKmJ1ZikNCit7DQorCXN0cnVjdCBhcHBsZXRiX2Rldmlj
ZSAqdGJfZGV2ID0gZGV2X2dldF9kcnZkYXRhKGRldik7DQorDQorCXJldHVybiBzbnByaW50Zihi
dWYsIFBBR0VfU0laRSwgIiVkXG4iLCB0Yl9kZXYtPmlkbGVfdGltZW91dCk7DQorfQ0KKw0KK3N0
YXRpYyBzc2l6ZV90IGlkbGVfdGltZW91dF9zdG9yZShzdHJ1Y3QgZGV2aWNlICpkZXYsDQorCQkJ
CSAgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsDQorCQkJCSAgY29uc3QgY2hhciAqYnVm
LCBzaXplX3Qgc2l6ZSkNCit7DQorCXN0cnVjdCBhcHBsZXRiX2RldmljZSAqdGJfZGV2ID0gZGV2
X2dldF9kcnZkYXRhKGRldik7DQorCWxvbmcgbmV3Ow0KKwlpbnQgcmM7DQorDQorCXJjID0ga3N0
cnRvbChidWYsIDAsICZuZXcpOw0KKwlpZiAocmMgfHwgbmV3ID4gSU5UX01BWCB8fCBuZXcgPCAt
MikNCisJCXJldHVybiAtRUlOVkFMOw0KKw0KKwlhcHBsZXRiX3NldF9pZGxlX3RpbWVvdXQodGJf
ZGV2LCBuZXcpOw0KKwlhcHBsZXRiX3VwZGF0ZV90b3VjaGJhcih0Yl9kZXYsIHRydWUpOw0KKw0K
KwlyZXR1cm4gc2l6ZTsNCit9DQorDQorc3RhdGljIHZvaWQgYXBwbGV0Yl9zZXRfZGltX3RpbWVv
dXQoc3RydWN0IGFwcGxldGJfZGV2aWNlICp0Yl9kZXYsIGludCBuZXcpDQorew0KKwlpZiAobmV3
ID09IC0yKSB7DQorCQl0Yl9kZXYtPmRpbV90b19pc19jYWxjID0gdHJ1ZTsNCisJCWFwcGxldGJf
c2V0X2lkbGVfdGltZW91dCh0Yl9kZXYsIHRiX2Rldi0+aWRsZV90aW1lb3V0KTsNCisJfSBlbHNl
IHsNCisJCXRiX2Rldi0+ZGltX3RvX2lzX2NhbGMgPSBmYWxzZTsNCisJCXRiX2Rldi0+ZGltX3Rp
bWVvdXQgPSBuZXc7DQorCX0NCit9DQorDQorc3RhdGljIHNzaXplX3QgZGltX3RpbWVvdXRfc2hv
dyhzdHJ1Y3QgZGV2aWNlICpkZXYsDQorCQkJCXN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRy
LCBjaGFyICpidWYpDQorew0KKwlzdHJ1Y3QgYXBwbGV0Yl9kZXZpY2UgKnRiX2RldiA9IGRldl9n
ZXRfZHJ2ZGF0YShkZXYpOw0KKw0KKwlyZXR1cm4gc25wcmludGYoYnVmLCBQQUdFX1NJWkUsICIl
ZFxuIiwNCisJCQl0Yl9kZXYtPmRpbV90b19pc19jYWxjID8gLTIgOiB0Yl9kZXYtPmRpbV90aW1l
b3V0KTsNCit9DQorDQorc3RhdGljIHNzaXplX3QgZGltX3RpbWVvdXRfc3RvcmUoc3RydWN0IGRl
dmljZSAqZGV2LA0KKwkJCQkgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsDQorCQkJCSBj
b25zdCBjaGFyICpidWYsIHNpemVfdCBzaXplKQ0KK3sNCisJc3RydWN0IGFwcGxldGJfZGV2aWNl
ICp0Yl9kZXYgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsNCisJbG9uZyBuZXc7DQorCWludCByYzsN
CisNCisJcmMgPSBrc3RydG9sKGJ1ZiwgMCwgJm5ldyk7DQorCWlmIChyYyB8fCBuZXcgPiBJTlRf
TUFYIHx8IG5ldyA8IC0yKQ0KKwkJcmV0dXJuIC1FSU5WQUw7DQorDQorCWFwcGxldGJfc2V0X2Rp
bV90aW1lb3V0KHRiX2RldiwgbmV3KTsNCisJYXBwbGV0Yl91cGRhdGVfdG91Y2hiYXIodGJfZGV2
LCB0cnVlKTsNCisNCisJcmV0dXJuIHNpemU7DQorfQ0KKw0KK3N0YXRpYyBzc2l6ZV90IGZubW9k
ZV9zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIs
DQorCQkJICAgY2hhciAqYnVmKQ0KK3sNCisJc3RydWN0IGFwcGxldGJfZGV2aWNlICp0Yl9kZXYg
PSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsNCisNCisJcmV0dXJuIHNucHJpbnRmKGJ1ZiwgUEFHRV9T
SVpFLCAiJWRcbiIsIHRiX2Rldi0+Zm5fbW9kZSk7DQorfQ0KKw0KK3N0YXRpYyBzc2l6ZV90IGZu
bW9kZV9zdG9yZShzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICph
dHRyLA0KKwkJCSAgICBjb25zdCBjaGFyICpidWYsIHNpemVfdCBzaXplKQ0KK3sNCisJc3RydWN0
IGFwcGxldGJfZGV2aWNlICp0Yl9kZXYgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsNCisJbG9uZyBu
ZXc7DQorCWludCByYzsNCisNCisJcmMgPSBrc3RydG9sKGJ1ZiwgMCwgJm5ldyk7DQorCWlmIChy
YyB8fCBuZXcgPiBBUFBMRVRCX0ZOX01PREVfTUFYIHx8IG5ldyA8IDApDQorCQlyZXR1cm4gLUVJ
TlZBTDsNCisNCisJdGJfZGV2LT5mbl9tb2RlID0gbmV3Ow0KKwlhcHBsZXRiX3VwZGF0ZV90b3Vj
aGJhcih0Yl9kZXYsIGZhbHNlKTsNCisNCisJcmV0dXJuIHNpemU7DQorfQ0KKw0KK3N0YXRpYyBp
bnQgYXBwbGV0Yl90Yl9rZXlfdG9fc2xvdCh1bnNpZ25lZCBpbnQgY29kZSkNCit7DQorCXN3aXRj
aCAoY29kZSkgew0KKwljYXNlIEtFWV9FU0M6DQorCQlyZXR1cm4gMDsNCisJY2FzZSBLRVlfRjE6
DQorCWNhc2UgS0VZX0YyOg0KKwljYXNlIEtFWV9GMzoNCisJY2FzZSBLRVlfRjQ6DQorCWNhc2Ug
S0VZX0Y1Og0KKwljYXNlIEtFWV9GNjoNCisJY2FzZSBLRVlfRjc6DQorCWNhc2UgS0VZX0Y4Og0K
KwljYXNlIEtFWV9GOToNCisJY2FzZSBLRVlfRjEwOg0KKwkJcmV0dXJuIGNvZGUgLSBLRVlfRjEg
KyAxOw0KKwljYXNlIEtFWV9GMTE6DQorCWNhc2UgS0VZX0YxMjoNCisJCXJldHVybiBjb2RlIC0g
S0VZX0YxMSArIDExOw0KKwlkZWZhdWx0Og0KKwkJcmV0dXJuIC0xOw0KKwl9DQorfQ0KKw0KK3N0
YXRpYyBpbnQgYXBwbGV0Yl9oaWRfZXZlbnQoc3RydWN0IGhpZF9kZXZpY2UgKmhkZXYsIHN0cnVj
dCBoaWRfZmllbGQgKmZpZWxkLA0KKwkJCSAgICAgc3RydWN0IGhpZF91c2FnZSAqdXNhZ2UsIF9f
czMyIHZhbHVlKQ0KK3sNCisJc3RydWN0IGFwcGxldGJfZGV2aWNlICp0Yl9kZXYgPSBoaWRfZ2V0
X2RydmRhdGEoaGRldik7DQorCXVuc2lnbmVkIGludCBuZXdfY29kZSA9IDA7DQorCXVuc2lnbmVk
IGxvbmcgZmxhZ3M7DQorCWJvb2wgc2VuZF9kdW1teSA9IGZhbHNlOw0KKwlib29sIHNlbmRfdHJu
c2wgPSBmYWxzZTsNCisJaW50IHNsb3Q7DQorCWludCByYyA9IDA7DQorDQorCWlmICgodXNhZ2Ut
PmhpZCAmIEhJRF9VU0FHRV9QQUdFKSAhPSBISURfVVBfS0VZQk9BUkQgfHwNCisJICAgIHVzYWdl
LT50eXBlICE9IEVWX0tFWSkNCisJCXJldHVybiAwOw0KKw0KKwkvKg0KKwkgKiBTa2lwIG5vbi10
b3VjaC1iYXIga2V5cy4NCisJICoNCisJICogRWl0aGVyIHRoZSB0b3VjaCBiYXIgaXRzZWxmIG9y
IHVzYmhpZCBnZW5lcmF0ZSBhIHNsZXcgb2Yga2V5LWRvd24NCisJICogZXZlbnRzIGZvciBhbGwg
dGhlIG1ldGEga2V5cy4gTm9uZSBvZiB3aGljaCB3ZSdyZSBhdCBhbGwgaW50ZXJlc3RlZA0KKwkg
KiBpbi4NCisJICovDQorCXNsb3QgPSBhcHBsZXRiX3RiX2tleV90b19zbG90KHVzYWdlLT5jb2Rl
KTsNCisJaWYgKHNsb3QgPCAwKQ0KKwkJcmV0dXJuIDA7DQorDQorCXNwaW5fbG9ja19pcnFzYXZl
KCZ0Yl9kZXYtPnRiX2xvY2ssIGZsYWdzKTsNCisNCisJaWYgKCF0Yl9kZXYtPmFjdGl2ZSkgew0K
KwkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdGJfZGV2LT50Yl9sb2NrLCBmbGFncyk7DQorCQly
ZXR1cm4gMDsNCisJfQ0KKw0KKwluZXdfY29kZSA9IGFwcGxldGJfZm5fdG9fc3BlY2lhbCh1c2Fn
ZS0+Y29kZSk7DQorDQorCWlmICh2YWx1ZSAhPSAyKQ0KKwkJdGJfZGV2LT5sYXN0X3RiX2tleXNf
cHJlc3NlZFtzbG90XSA9IHZhbHVlOw0KKw0KKwl0Yl9kZXYtPmxhc3RfZXZlbnRfdGltZSA9IGt0
aW1lX2dldCgpOw0KKw0KKwlhcHBsZXRiX3VwZGF0ZV90b3VjaGJhcl9ub19sb2NrKHRiX2Rldiwg
ZmFsc2UpOw0KKw0KKwkvKg0KKwkgKiBXZSB3YW50IHRvIHN1cHByZXNzIHRvdWNoIGJhciBrZXlz
IHdoaWxlIHRoZSB0b3VjaCBiYXIgaXMgb2ZmLCBidXQNCisJICogd2UgZG8gd2FudCB0byB3YWtl
IHVwIHRoZSBzY3JlZW4gaWYgaXQncyBhc2xlZXAsIHNvIGdlbmVyYXRlIGEgZHVtbXkNCisJICog
ZXZlbnQgaW4gdGhhdCBjYXNlLg0KKwkgKi8NCisJaWYgKHRiX2Rldi0+Y3VyX3RiX21vZGUgPT0g
QVBQTEVUQl9DTURfTU9ERV9PRkYgfHwNCisJICAgIHRiX2Rldi0+Y3VyX3RiX2Rpc3AgPT0gQVBQ
TEVUQl9DTURfRElTUF9PRkYpIHsNCisJCXNlbmRfZHVtbXkgPSB0cnVlOw0KKwkJcmMgPSAxOw0K
KwkvKiB0cmFuc2xhdGUgc3BlY2lhbCBrZXlzICovDQorCX0gZWxzZSBpZiAobmV3X2NvZGUgJiYN
CisJCSAgICgodmFsdWUgPiAwICYmDQorCQkgICAgIGFwcGxldGJfZ2V0X2N1cl90Yl9tb2RlKHRi
X2RldikgPT0gQVBQTEVUQl9DTURfTU9ERV9TUENMKQ0KKwkJICAgIHx8DQorCQkgICAgKHZhbHVl
ID09IDAgJiYgdGJfZGV2LT5sYXN0X3RiX2tleXNfdHJhbnNsYXRlZFtzbG90XSkpKSB7DQorCQl0
Yl9kZXYtPmxhc3RfdGJfa2V5c190cmFuc2xhdGVkW3Nsb3RdID0gdHJ1ZTsNCisJCXNlbmRfdHJu
c2wgPSB0cnVlOw0KKwkJcmMgPSAxOw0KKwkvKiBldmVyeXRoaW5nIGVsc2UgaGFuZGxlZCBub3Jt
YWxseSAqLw0KKwl9IGVsc2Ugew0KKwkJdGJfZGV2LT5sYXN0X3RiX2tleXNfdHJhbnNsYXRlZFtz
bG90XSA9IGZhbHNlOw0KKwl9DQorDQorCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnRiX2Rldi0+
dGJfbG9jaywgZmxhZ3MpOw0KKw0KKwkvKg0KKwkgKiBOZWVkIHRvIHNlbmQgdGhlc2UgaW5wdXQg
ZXZlbnRzIG91dHNpZGUgb2YgdGhlIGxvY2ssIGFzIG90aGVyd2lzZQ0KKwkgKiB3ZSBjYW4gcnVu
IGludG8gdGhlIGZvbGxvd2luZyBkZWFkbG9jazoNCisJICogICAgICAgICAgICBUYXNrIDEgICAg
ICAgICAgICAgICAgICAgICAgICAgVGFzayAyDQorCSAqICAgICBhcHBsZXRiX2hpZF9ldmVudCgp
ICAgICAgICAgICAgaW5wdXRfZXZlbnQoKQ0KKwkgKiAgICAgICBhY3F1aXJlIHRiX2xvY2sgICAg
ICAgICAgICAgICAgYWNxdWlyZSBkZXYtPmV2ZW50X2xvY2sNCisJICogICAgICAgaW5wdXRfZXZl
bnQoKSAgICAgICAgICAgICAgICAgIGFwcGxldGJfaW5wX2V2ZW50KCkNCisJICogICAgICAgICBh
Y3F1aXJlIGRldi0+ZXZlbnRfbG9jayAgICAgICAgYWNxdWlyZSB0Yl9sb2NrDQorCSAqLw0KKwlp
ZiAoc2VuZF9kdW1teSkgew0KKwkJaW5wdXRfZXZlbnQoZmllbGQtPmhpZGlucHV0LT5pbnB1dCwg
RVZfS0VZLCBLRVlfVU5LTk9XTiwgMSk7DQorCQlpbnB1dF9ldmVudChmaWVsZC0+aGlkaW5wdXQt
PmlucHV0LCBFVl9LRVksIEtFWV9VTktOT1dOLCAwKTsNCisJfSBlbHNlIGlmIChzZW5kX3RybnNs
KSB7DQorCQlpbnB1dF9ldmVudChmaWVsZC0+aGlkaW5wdXQtPmlucHV0LCB1c2FnZS0+dHlwZSwg
bmV3X2NvZGUsDQorCQkJICAgIHZhbHVlKTsNCisJfQ0KKw0KKwlyZXR1cm4gcmM7DQorfQ0KKw0K
K3N0YXRpYyB2b2lkIGFwcGxldGJfaW5wX2V2ZW50KHN0cnVjdCBpbnB1dF9oYW5kbGUgKmhhbmRs
ZSwgdW5zaWduZWQgaW50IHR5cGUsDQorCQkJICAgICAgdW5zaWduZWQgaW50IGNvZGUsIGludCB2
YWx1ZSkNCit7DQorCXN0cnVjdCBhcHBsZXRiX2RldmljZSAqdGJfZGV2ID0gaGFuZGxlLT5wcml2
YXRlOw0KKwl1bnNpZ25lZCBsb25nIGZsYWdzOw0KKw0KKwlzcGluX2xvY2tfaXJxc2F2ZSgmdGJf
ZGV2LT50Yl9sb2NrLCBmbGFncyk7DQorDQorCWlmICghdGJfZGV2LT5hY3RpdmUpIHsNCisJCXNw
aW5fdW5sb2NrX2lycXJlc3RvcmUoJnRiX2Rldi0+dGJfbG9jaywgZmxhZ3MpOw0KKwkJcmV0dXJu
Ow0KKwl9DQorDQorCWlmICh0eXBlID09IEVWX0tFWSAmJiBjb2RlID09IEtFWV9GTiAmJiB2YWx1
ZSAhPSAyKQ0KKwkJdGJfZGV2LT5sYXN0X2ZuX3ByZXNzZWQgPSB2YWx1ZTsNCisNCisJdGJfZGV2
LT5sYXN0X2V2ZW50X3RpbWUgPSBrdGltZV9nZXQoKTsNCisNCisJYXBwbGV0Yl91cGRhdGVfdG91
Y2hiYXJfbm9fbG9jayh0Yl9kZXYsIGZhbHNlKTsNCisNCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9y
ZSgmdGJfZGV2LT50Yl9sb2NrLCBmbGFncyk7DQorfQ0KKw0KKy8qIEZpbmQgYW5kIHNhdmUgdGhl
IHVzYi1kZXZpY2UgYXNzb2NpYXRlZCB3aXRoIHRoZSB0b3VjaCBiYXIgaW5wdXQgZGV2aWNlICov
DQorc3RhdGljIHN0cnVjdCB1c2JfaW50ZXJmYWNlICphcHBsZXRiX2dldF91c2JfaWZhY2Uoc3Ry
dWN0IGhpZF9kZXZpY2UgKmhkZXYpDQorew0KKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaGRldi0+
ZGV2Ow0KKw0KKwl3aGlsZSAoZGV2ICYmICEoZGV2LT50eXBlICYmIGRldi0+dHlwZS0+bmFtZSAm
Jg0KKwkJCSFzdHJjbXAoZGV2LT50eXBlLT5uYW1lLCAidXNiX2ludGVyZmFjZSIpKSkNCisJCWRl
diA9IGRldi0+cGFyZW50Ow0KKw0KKwlyZXR1cm4gZGV2ID8gdG9fdXNiX2ludGVyZmFjZShkZXYp
IDogTlVMTDsNCit9DQorDQorc3RhdGljIGludCBhcHBsZXRiX2lucF9jb25uZWN0KHN0cnVjdCBp
bnB1dF9oYW5kbGVyICpoYW5kbGVyLA0KKwkJCSAgICAgICBzdHJ1Y3QgaW5wdXRfZGV2ICpkZXYs
DQorCQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnB1dF9kZXZpY2VfaWQgKmlkKQ0KK3sNCisJc3Ry
dWN0IGFwcGxldGJfZGV2aWNlICp0Yl9kZXYgPSBoYW5kbGVyLT5wcml2YXRlOw0KKwlzdHJ1Y3Qg
aW5wdXRfaGFuZGxlICpoYW5kbGU7DQorCWludCByYzsNCisNCisJaWYgKGlkLT5kcml2ZXJfaW5m
byA9PSBBUFBMRVRCX0RFVklEX0tFWUJPQVJEKSB7DQorCQloYW5kbGUgPSAmdGJfZGV2LT5rYmRf
aGFuZGxlOw0KKwkJaGFuZGxlLT5uYW1lID0gInRia2JkIjsNCisJfSBlbHNlIGlmIChpZC0+ZHJp
dmVyX2luZm8gPT0gQVBQTEVUQl9ERVZJRF9UT1VDSFBBRCkgew0KKwkJaGFuZGxlID0gJnRiX2Rl
di0+dHBkX2hhbmRsZTsNCisJCWhhbmRsZS0+bmFtZSA9ICJ0YnRwYWQiOw0KKwl9IGVsc2Ugew0K
KwkJZGV2X2Vycih0Yl9kZXYtPmxvZ19kZXYsICJVbmtub3duIGRldmljZSBpZCAoJWx1KVxuIiwN
CisJCQlpZC0+ZHJpdmVyX2luZm8pOw0KKwkJcmV0dXJuIC1FTk9FTlQ7DQorCX0NCisNCisJaWYg
KGhhbmRsZS0+ZGV2KSB7DQorCQlkZXZfZXJyKHRiX2Rldi0+bG9nX2RldiwNCisJCQkiRHVwbGlj
YXRlIGNvbm5lY3QgdG8gJXMgaW5wdXQgZGV2aWNlXG4iLCBoYW5kbGUtPm5hbWUpOw0KKwkJcmV0
dXJuIC1FRVhJU1Q7DQorCX0NCisNCisJaGFuZGxlLT5vcGVuID0gMDsNCisJaGFuZGxlLT5kZXYg
PSBpbnB1dF9nZXRfZGV2aWNlKGRldik7DQorCWhhbmRsZS0+aGFuZGxlciA9IGhhbmRsZXI7DQor
CWhhbmRsZS0+cHJpdmF0ZSA9IHRiX2RldjsNCisNCisJcmMgPSBpbnB1dF9yZWdpc3Rlcl9oYW5k
bGUoaGFuZGxlKTsNCisJaWYgKHJjKQ0KKwkJZ290byBlcnJfZnJlZV9kZXY7DQorDQorCXJjID0g
aW5wdXRfb3Blbl9kZXZpY2UoaGFuZGxlKTsNCisJaWYgKHJjKQ0KKwkJZ290byBlcnJfdW5yZWdp
c3Rlcl9oYW5kbGU7DQorDQorCWRldl9kYmcodGJfZGV2LT5sb2dfZGV2LCAiQ29ubmVjdGVkIHRv
ICVzIGlucHV0IGRldmljZVxuIiwNCisJCWhhbmRsZSA9PSAmdGJfZGV2LT5rYmRfaGFuZGxlID8g
ImtleWJvYXJkIiA6ICJ0b3VjaHBhZCIpOw0KKw0KKwlyZXR1cm4gMDsNCisNCisgZXJyX3VucmVn
aXN0ZXJfaGFuZGxlOg0KKwlpbnB1dF91bnJlZ2lzdGVyX2hhbmRsZShoYW5kbGUpOw0KKyBlcnJf
ZnJlZV9kZXY6DQorCWlucHV0X3B1dF9kZXZpY2UoaGFuZGxlLT5kZXYpOw0KKwloYW5kbGUtPmRl
diA9IE5VTEw7DQorCXJldHVybiByYzsNCit9DQorDQorc3RhdGljIHZvaWQgYXBwbGV0Yl9pbnBf
ZGlzY29ubmVjdChzdHJ1Y3QgaW5wdXRfaGFuZGxlICpoYW5kbGUpDQorew0KKwlzdHJ1Y3QgYXBw
bGV0Yl9kZXZpY2UgKnRiX2RldiA9IGhhbmRsZS0+cHJpdmF0ZTsNCisNCisJaW5wdXRfY2xvc2Vf
ZGV2aWNlKGhhbmRsZSk7DQorCWlucHV0X3VucmVnaXN0ZXJfaGFuZGxlKGhhbmRsZSk7DQorDQor
CWRldl9kYmcodGJfZGV2LT5sb2dfZGV2LCAiRGlzY29ubmVjdGVkIGZyb20gJXMgaW5wdXQgZGV2
aWNlXG4iLA0KKwkJaGFuZGxlID09ICZ0Yl9kZXYtPmtiZF9oYW5kbGUgPyAia2V5Ym9hcmQiIDog
InRvdWNocGFkIik7DQorDQorCWlucHV0X3B1dF9kZXZpY2UoaGFuZGxlLT5kZXYpOw0KKwloYW5k
bGUtPmRldiA9IE5VTEw7DQorfQ0KKw0KK3N0YXRpYyBpbnQgYXBwbGV0Yl9pbnB1dF9jb25maWd1
cmVkKHN0cnVjdCBoaWRfZGV2aWNlICpoZGV2LA0KKwkJCQkgICAgc3RydWN0IGhpZF9pbnB1dCAq
aGlkaW5wdXQpDQorew0KKwlpbnQgaWR4Ow0KKwlzdHJ1Y3QgaW5wdXRfZGV2ICppbnB1dCA9IGhp
ZGlucHV0LT5pbnB1dDsNCisNCisJLyoNCisJICogQ2xlYXIgdmFyaW91cyBpbnB1dCBjYXBhYmls
aXRpZXMgdGhhdCBhcmUgYmxpbmRseSBzZXQgYnkgdGhlIGhpZA0KKwkgKiBkcml2ZXIgKHVzYmti
ZC5jKQ0KKwkgKi8NCisJbWVtc2V0KGlucHV0LT5ldmJpdCwgMCwgc2l6ZW9mKGlucHV0LT5ldmJp
dCkpOw0KKwltZW1zZXQoaW5wdXQtPmtleWJpdCwgMCwgc2l6ZW9mKGlucHV0LT5rZXliaXQpKTsN
CisJbWVtc2V0KGlucHV0LT5sZWRiaXQsIDAsIHNpemVvZihpbnB1dC0+bGVkYml0KSk7DQorDQor
CS8qIHNldCBvdXIgYWN0dWFsIGNhcGFiaWxpdGllcyAqLw0KKwlfX3NldF9iaXQoRVZfS0VZLCBp
bnB1dC0+ZXZiaXQpOw0KKwlfX3NldF9iaXQoRVZfUkVQLCBpbnB1dC0+ZXZiaXQpOw0KKwlfX3Nl
dF9iaXQoRVZfTVNDLCBpbnB1dC0+ZXZiaXQpOyAgLyogaGlkLWlucHV0IGdlbmVyYXRlcyBNU0Nf
U0NBTiAqLw0KKw0KKwlmb3IgKGlkeCA9IDA7IGlkeCA8IEFSUkFZX1NJWkUoYXBwbGV0Yl9mbl9j
b2Rlcyk7IGlkeCsrKSB7DQorCQlpbnB1dF9zZXRfY2FwYWJpbGl0eShpbnB1dCwgRVZfS0VZLCBh
cHBsZXRiX2ZuX2NvZGVzW2lkeF0uZnJvbSk7DQorCQlpbnB1dF9zZXRfY2FwYWJpbGl0eShpbnB1
dCwgRVZfS0VZLCBhcHBsZXRiX2ZuX2NvZGVzW2lkeF0udG8pOw0KKwl9DQorDQorCWlucHV0X3Nl
dF9jYXBhYmlsaXR5KGlucHV0LCBFVl9LRVksIEtFWV9FU0MpOw0KKwlpbnB1dF9zZXRfY2FwYWJp
bGl0eShpbnB1dCwgRVZfS0VZLCBLRVlfVU5LTk9XTik7DQorDQorCXJldHVybiAwOw0KK30NCisN
CitzdGF0aWMgc3RydWN0IGFwcGxldGJfaWZhY2VfaW5mbyAqDQorYXBwbGV0Yl9nZXRfaWZhY2Vf
aW5mbyhzdHJ1Y3QgYXBwbGV0Yl9kZXZpY2UgKnRiX2Rldiwgc3RydWN0IGhpZF9kZXZpY2UgKmhk
ZXYpDQorew0KKwlpZiAoaGRldiA9PSB0Yl9kZXYtPm1vZGVfaWZhY2UuaGRldikNCisJCXJldHVy
biAmdGJfZGV2LT5tb2RlX2lmYWNlOw0KKwlpZiAoaGRldiA9PSB0Yl9kZXYtPmRpc3BfaWZhY2Uu
aGRldikNCisJCXJldHVybiAmdGJfZGV2LT5kaXNwX2lmYWNlOw0KKwlyZXR1cm4gTlVMTDsNCit9
DQorDQorLyoqDQorICogYXBwbGV0Yl9maW5kX3JlcG9ydF9maWVsZCgpIC0gRmluZCB0aGUgZmll
bGQgaW4gdGhlIHJlcG9ydCB3aXRoIHRoZSBnaXZlbg0KKyAqIHVzYWdlLg0KKyAqIEByZXBvcnQ6
IHRoZSByZXBvcnQgdG8gc2VhcmNoDQorICogQGZpZWxkX3VzYWdlOiB0aGUgdXNhZ2Ugb2YgdGhl
IGZpZWxkIHRvIHNlYXJjaCBmb3INCisgKg0KKyAqIFJldHVybnM6IHRoZSBoaWQgZmllbGQgaWYg
Zm91bmQsIG9yIE5VTEwgaWYgbm9uZSBmb3VuZC4NCisgKi8NCitzdGF0aWMgc3RydWN0IGhpZF9m
aWVsZCAqYXBwbGV0Yl9maW5kX3JlcG9ydF9maWVsZChzdHJ1Y3QgaGlkX3JlcG9ydCAqcmVwb3J0
LA0KKwkJCQkJCSAgIHVuc2lnbmVkIGludCBmaWVsZF91c2FnZSkNCit7DQorCWludCBmLCB1Ow0K
Kw0KKwlmb3IgKGYgPSAwOyBmIDwgcmVwb3J0LT5tYXhmaWVsZDsgZisrKSB7DQorCQlzdHJ1Y3Qg
aGlkX2ZpZWxkICpmaWVsZCA9IHJlcG9ydC0+ZmllbGRbZl07DQorDQorCQlpZiAoZmllbGQtPmxv
Z2ljYWwgPT0gZmllbGRfdXNhZ2UpDQorCQkJcmV0dXJuIGZpZWxkOw0KKw0KKwkJZm9yICh1ID0g
MDsgdSA8IGZpZWxkLT5tYXh1c2FnZTsgdSsrKSB7DQorCQkJaWYgKGZpZWxkLT51c2FnZVt1XS5o
aWQgPT0gZmllbGRfdXNhZ2UpDQorCQkJCXJldHVybiBmaWVsZDsNCisJCX0NCisJfQ0KKw0KKwly
ZXR1cm4gTlVMTDsNCit9DQorDQorLyoqDQorICogYXBwbGV0Yl9maW5kX2hpZF9maWVsZCgpIC0g
U2VhcmNoIGFsbCB0aGUgcmVwb3J0cyBvZiB0aGUgZGV2aWNlIGZvciB0aGUNCisgKiBmaWVsZCB3
aXRoIHRoZSBnaXZlbiB1c2FnZS4NCisgKiBAaGRldjogdGhlIGRldmljZSB3aG9zZSByZXBvcnRz
IHRvIHNlYXJjaA0KKyAqIEBhcHBsaWNhdGlvbjogdGhlIHVzYWdlIG9mIGFwcGxpY2F0aW9uIGNv
bGxlY3Rpb24gdGhhdCB0aGUgZmllbGQgbXVzdA0KKyAqICAgICAgICAgICAgICAgYmVsb25nIHRv
DQorICogQGZpZWxkX3VzYWdlOiB0aGUgdXNhZ2Ugb2YgdGhlIGZpZWxkIHRvIHNlYXJjaCBmb3IN
CisgKg0KKyAqIFJldHVybnM6IHRoZSBoaWQgZmllbGQgaWYgZm91bmQsIG9yIE5VTEwgaWYgbm9u
ZSBmb3VuZC4NCisgKi8NCitzdGF0aWMgc3RydWN0IGhpZF9maWVsZCAqYXBwbGV0Yl9maW5kX2hp
ZF9maWVsZChzdHJ1Y3QgaGlkX2RldmljZSAqaGRldiwNCisJCQkJCQl1bnNpZ25lZCBpbnQgYXBw
bGljYXRpb24sDQorCQkJCQkJdW5zaWduZWQgaW50IGZpZWxkX3VzYWdlKQ0KK3sNCisJc3RhdGlj
IGNvbnN0IGludCByZXBvcnRfdHlwZXNbXSA9IHsgSElEX0lOUFVUX1JFUE9SVCwgSElEX09VVFBV
VF9SRVBPUlQsDQorCQkJCQkgICAgSElEX0ZFQVRVUkVfUkVQT1JUIH07DQorCXN0cnVjdCBoaWRf
cmVwb3J0ICpyZXBvcnQ7DQorCXN0cnVjdCBoaWRfZmllbGQgKmZpZWxkOw0KKwlpbnQgdDsNCisN
CisJZm9yICh0ID0gMDsgdCA8IEFSUkFZX1NJWkUocmVwb3J0X3R5cGVzKTsgdCsrKSB7DQorCQlz
dHJ1Y3QgbGlzdF9oZWFkICpyZXBvcnRfbGlzdCA9DQorCQkJICAgICZoZGV2LT5yZXBvcnRfZW51
bVtyZXBvcnRfdHlwZXNbdF1dLnJlcG9ydF9saXN0Ow0KKwkJbGlzdF9mb3JfZWFjaF9lbnRyeShy
ZXBvcnQsIHJlcG9ydF9saXN0LCBsaXN0KSB7DQorCQkJaWYgKHJlcG9ydC0+YXBwbGljYXRpb24g
IT0gYXBwbGljYXRpb24pDQorCQkJCWNvbnRpbnVlOw0KKw0KKwkJCWZpZWxkID0gYXBwbGV0Yl9m
aW5kX3JlcG9ydF9maWVsZChyZXBvcnQsIGZpZWxkX3VzYWdlKTsNCisJCQlpZiAoZmllbGQpDQor
CQkJCXJldHVybiBmaWVsZDsNCisJCX0NCisJfQ0KKw0KKwlyZXR1cm4gTlVMTDsNCit9DQorDQor
c3RhdGljIGludCBhcHBsZXRiX2V4dHJhY3RfcmVwb3J0X2FuZF9pZmFjZV9pbmZvKHN0cnVjdCBh
cHBsZXRiX2RldmljZSAqdGJfZGV2LA0KKwkJCQkJCSBzdHJ1Y3QgaGlkX2RldmljZSAqaGRldiwN
CisJCQkJCQkgY29uc3Qgc3RydWN0IGhpZF9kZXZpY2VfaWQgKmlkKQ0KK3sNCisJc3RydWN0IGFw
cGxldGJfaWZhY2VfaW5mbyAqaWZhY2VfaW5mbzsNCisJc3RydWN0IHVzYl9pbnRlcmZhY2UgKnVz
Yl9pZmFjZTsNCisJc3RydWN0IGhpZF9maWVsZCAqZmllbGQ7DQorDQorCWZpZWxkID0gYXBwbGV0
Yl9maW5kX2hpZF9maWVsZChoZGV2LCBISURfR0RfS0VZQk9BUkQsIEhJRF9VU0FHRV9NT0RFKTsN
CisJaWYgKGZpZWxkKSB7DQorCQlpZmFjZV9pbmZvID0gJnRiX2Rldi0+bW9kZV9pZmFjZTsNCisJ
CXRiX2Rldi0+bW9kZV9maWVsZCA9IGZpZWxkOw0KKwkJdGJfZGV2LT5pc190MSA9ICEhKGlkLT5k
cml2ZXJfZGF0YSAmIEFQUExFVEJfRkVBVFVSRV9JU19UMSk7DQorCX0gZWxzZSB7DQorCQlmaWVs
ZCA9IGFwcGxldGJfZmluZF9oaWRfZmllbGQoaGRldiwgSElEX1VTQUdFX0FQUExFX0FQUCwNCisJ
CQkJCSAgICAgICBISURfVVNBR0VfRElTUCk7DQorCQlpZiAoIWZpZWxkKQ0KKwkJCXJldHVybiAw
Ow0KKw0KKwkJaWZhY2VfaW5mbyA9ICZ0Yl9kZXYtPmRpc3BfaWZhY2U7DQorCQl0Yl9kZXYtPmRp
c3BfZmllbGQgPSBmaWVsZDsNCisJCXRiX2Rldi0+ZGlzcF9maWVsZF9hdXgxID0NCisJCQlhcHBs
ZXRiX2ZpbmRfaGlkX2ZpZWxkKGhkZXYsIEhJRF9VU0FHRV9BUFBMRV9BUFAsDQorCQkJCQkgICAg
ICAgSElEX1VTQUdFX0RJU1BfQVVYMSk7DQorDQorCQlpZiAoIXRiX2Rldi0+ZGlzcF9maWVsZF9h
dXgxIHx8DQorCQkgICAgdGJfZGV2LT5kaXNwX2ZpZWxkX2F1eDEtPnJlcG9ydCAhPQ0KKwkJCQkJ
CXRiX2Rldi0+ZGlzcF9maWVsZC0+cmVwb3J0KSB7DQorCQkJZGV2X2Vycih0Yl9kZXYtPmxvZ19k
ZXYsDQorCQkJCSJVbmV4cGVjdGVkIHJlcG9ydCBzdHJ1Y3R1cmUgZm9yIHJlcG9ydCAldSBpbiBk
ZXZpY2UgJXNcbiIsDQorCQkJCXRiX2Rldi0+ZGlzcF9maWVsZC0+cmVwb3J0LT5pZCwNCisJCQkJ
ZGV2X25hbWUoJmhkZXYtPmRldikpOw0KKwkJCXJldHVybiAtRU5PREVWOw0KKwkJfQ0KKwl9DQor
DQorCXVzYl9pZmFjZSA9IGFwcGxldGJfZ2V0X3VzYl9pZmFjZShoZGV2KTsNCisJaWYgKCF1c2Jf
aWZhY2UpIHsNCisJCWRldl9lcnIodGJfZGV2LT5sb2dfZGV2LA0KKwkJCSJGYWlsZWQgdG8gZmlu
ZCB1c2IgaW50ZXJmYWNlIGZvciBoaWQgZGV2aWNlICVzXG4iLA0KKwkJCWRldl9uYW1lKCZoZGV2
LT5kZXYpKTsNCisJCXJldHVybiAtRU5PREVWOw0KKwl9DQorDQorCWlmYWNlX2luZm8tPmhkZXYg
PSBoZGV2Ow0KKwlpZmFjZV9pbmZvLT51c2JfaWZhY2UgPSB1c2JfZ2V0X2ludGYodXNiX2lmYWNl
KTsNCisJaWZhY2VfaW5mby0+c3VzcGVuZGVkID0gZmFsc2U7DQorDQorCXJldHVybiAxOw0KK30N
CisNCitzdGF0aWMgdm9pZCBhcHBsZXRiX2NsZWFyX2lmYWNlX2luZm8oc3RydWN0IGFwcGxldGJf
ZGV2aWNlICp0Yl9kZXYsDQorCQkJCSAgICAgc3RydWN0IGhpZF9kZXZpY2UgKmhkZXYpDQorew0K
KwlzdHJ1Y3QgYXBwbGV0Yl9pZmFjZV9pbmZvICppZmFjZV9pbmZvOw0KKw0KKwlpZmFjZV9pbmZv
ID0gYXBwbGV0Yl9nZXRfaWZhY2VfaW5mbyh0Yl9kZXYsIGhkZXYpOw0KKwlpZiAoaWZhY2VfaW5m
bykgew0KKwkJdXNiX3B1dF9pbnRmKGlmYWNlX2luZm8tPnVzYl9pZmFjZSk7DQorCQlpZmFjZV9p
bmZvLT51c2JfaWZhY2UgPSBOVUxMOw0KKwkJaWZhY2VfaW5mby0+aGRldiA9IE5VTEw7DQorCX0N
Cit9DQorDQorc3RhdGljIGJvb2wgYXBwbGV0Yl90ZXN0X2FuZF9tYXJrX2FjdGl2ZShzdHJ1Y3Qg
YXBwbGV0Yl9kZXZpY2UgKnRiX2RldikNCit7DQorCXVuc2lnbmVkIGxvbmcgZmxhZ3M7DQorCWJv
b2wgYWN0aXZhdGVkID0gZmFsc2U7DQorDQorCXNwaW5fbG9ja19pcnFzYXZlKCZ0Yl9kZXYtPnRi
X2xvY2ssIGZsYWdzKTsNCisNCisJaWYgKHRiX2Rldi0+bW9kZV9pZmFjZS5oZGV2ICYmIHRiX2Rl
di0+ZGlzcF9pZmFjZS5oZGV2ICYmDQorCSAgICAhdGJfZGV2LT5hY3RpdmUpIHsNCisJCXRiX2Rl
di0+YWN0aXZlID0gdHJ1ZTsNCisJCWFjdGl2YXRlZCA9IHRydWU7DQorCX0NCisNCisJc3Bpbl91
bmxvY2tfaXJxcmVzdG9yZSgmdGJfZGV2LT50Yl9sb2NrLCBmbGFncyk7DQorDQorCXJldHVybiBh
Y3RpdmF0ZWQ7DQorfQ0KKw0KK3N0YXRpYyBib29sIGFwcGxldGJfdGVzdF9hbmRfbWFya19pbmFj
dGl2ZShzdHJ1Y3QgYXBwbGV0Yl9kZXZpY2UgKnRiX2RldiwNCisJCQkJCSAgIHN0cnVjdCBoaWRf
ZGV2aWNlICpoZGV2KQ0KK3sNCisJdW5zaWduZWQgbG9uZyBmbGFnczsNCisJYm9vbCBkZWFjdGl2
YXRlZCA9IGZhbHNlOw0KKw0KKwlzcGluX2xvY2tfaXJxc2F2ZSgmdGJfZGV2LT50Yl9sb2NrLCBm
bGFncyk7DQorDQorCWlmICh0Yl9kZXYtPm1vZGVfaWZhY2UuaGRldiAmJiB0Yl9kZXYtPmRpc3Bf
aWZhY2UuaGRldiAmJg0KKwkgICAgdGJfZGV2LT5hY3RpdmUgJiYNCisJICAgIChoZGV2ID09IHRi
X2Rldi0+bW9kZV9pZmFjZS5oZGV2IHx8DQorCSAgICAgaGRldiA9PSB0Yl9kZXYtPmRpc3BfaWZh
Y2UuaGRldikpIHsNCisJCXRiX2Rldi0+YWN0aXZlID0gZmFsc2U7DQorCQlkZWFjdGl2YXRlZCA9
IHRydWU7DQorCX0NCisNCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdGJfZGV2LT50Yl9sb2Nr
LCBmbGFncyk7DQorDQorCXJldHVybiBkZWFjdGl2YXRlZDsNCit9DQorDQorc3RhdGljIGNvbnN0
IHN0cnVjdCBpbnB1dF9kZXZpY2VfaWQgYXBwbGV0Yl9pbnB1dF9kZXZpY2VzW10gPSB7DQorCXsN
CisJCS5mbGFncyA9IElOUFVUX0RFVklDRV9JRF9NQVRDSF9CVVMgfA0KKwkJCUlOUFVUX0RFVklD
RV9JRF9NQVRDSF9LRVlCSVQsDQorCQkuYnVzdHlwZSA9IEJVU19TUEksDQorCQkua2V5Yml0ID0g
eyBbQklUX1dPUkQoS0VZX0ZOKV0gPSBCSVRfTUFTSyhLRVlfRk4pIH0sDQorCQkuZHJpdmVyX2lu
Zm8gPSBBUFBMRVRCX0RFVklEX0tFWUJPQVJELA0KKwl9LAkJCS8qIEJ1aWx0aW4gU1BJIGtleWJv
YXJkIGRldmljZSAqLw0KKwl7DQorCQkuZmxhZ3MgPSBJTlBVVF9ERVZJQ0VfSURfTUFUQ0hfQlVT
IHwNCisJCQlJTlBVVF9ERVZJQ0VfSURfTUFUQ0hfS0VZQklULA0KKwkJLmJ1c3R5cGUgPSBCVVNf
U1BJLA0KKwkJLmtleWJpdCA9IHsgW0JJVF9XT1JEKEJUTl9UT1VDSCldID0gQklUX01BU0soQlRO
X1RPVUNIKSB9LA0KKwkJLmRyaXZlcl9pbmZvID0gQVBQTEVUQl9ERVZJRF9UT1VDSFBBRCwNCisJ
fSwJCQkvKiBCdWlsdGluIFNQSSB0b3VjaHBhZCBkZXZpY2UgKi8NCisJew0KKwkJLmZsYWdzID0g
SU5QVVRfREVWSUNFX0lEX01BVENIX0JVUyB8DQorCQkJSU5QVVRfREVWSUNFX0lEX01BVENIX1ZF
TkRPUiB8DQorCQkJSU5QVVRfREVWSUNFX0lEX01BVENIX0tFWUJJVCwNCisJCS5idXN0eXBlID0g
QlVTX1VTQiwNCisJCS52ZW5kb3IgPSAweDA1YWMgLyogVVNCX1ZFTkRPUl9JRF9BUFBMRSAqLywN
CisJCS5rZXliaXQgPSB7IFtCSVRfV09SRChLRVlfRk4pXSA9IEJJVF9NQVNLKEtFWV9GTikgfSwN
CisJCS5kcml2ZXJfaW5mbyA9IEFQUExFVEJfREVWSURfS0VZQk9BUkQsDQorCX0sCQkJLyogQnVp
bHRpbiBVU0Iga2V5Ym9hcmQgZGV2aWNlICovDQorCXsNCisJCS5mbGFncyA9IElOUFVUX0RFVklD
RV9JRF9NQVRDSF9CVVMgfA0KKwkJCUlOUFVUX0RFVklDRV9JRF9NQVRDSF9WRU5ET1IgfA0KKwkJ
CUlOUFVUX0RFVklDRV9JRF9NQVRDSF9LRVlCSVQsDQorCQkuYnVzdHlwZSA9IEJVU19VU0IsDQor
CQkudmVuZG9yID0gMHgwNWFjIC8qIFVTQl9WRU5ET1JfSURfQVBQTEUgKi8sDQorCQkua2V5Yml0
ID0geyBbQklUX1dPUkQoQlROX1RPVUNIKV0gPSBCSVRfTUFTSyhCVE5fVE9VQ0gpIH0sDQorCQku
ZHJpdmVyX2luZm8gPSBBUFBMRVRCX0RFVklEX1RPVUNIUEFELA0KKwl9LAkJCS8qIEJ1aWx0aW4g
VVNCIHRvdWNocGFkIGRldmljZSAqLw0KKwl7IH0sCQkJLyogVGVybWluYXRpbmcgemVybyBlbnRy
eSAqLw0KK307DQorDQorc3RhdGljIGJvb2wgYXBwbGV0Yl9tYXRjaF9pbnRlcm5hbF9kZXZpY2Uo
c3RydWN0IGlucHV0X2hhbmRsZXIgKmhhbmRsZXIsDQorCQkJCQkgIHN0cnVjdCBpbnB1dF9kZXYg
KmlucF9kZXYpDQorew0KKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaW5wX2Rldi0+ZGV2Ow0KKw0K
KwlpZiAoaW5wX2Rldi0+aWQuYnVzdHlwZSA9PSBCVVNfU1BJKQ0KKwkJcmV0dXJuIHRydWU7DQor
DQorCS8qIGluIGtlcm5lbDogZGV2ICYmICFpc191c2JfZGV2aWNlKGRldikgKi8NCisJd2hpbGUg
KGRldiAmJiAhKGRldi0+dHlwZSAmJiBkZXYtPnR5cGUtPm5hbWUgJiYNCisJCQkhc3RyY21wKGRl
di0+dHlwZS0+bmFtZSwgInVzYl9kZXZpY2UiKSkpDQorCQlkZXYgPSBkZXYtPnBhcmVudDsNCisN
CisJLyoNCisJICogQXBwbGUgbGFiZWxzIGFsbCB0aGVpciBpbnRlcm5hbCBrZXlib2FyZHMgYW5k
IHRyYWNrcGFkcyBhcyBzdWNoLA0KKwkgKiBpbnN0ZWFkIG9mIG1haW50YWluaW5nIGFuIGV2ZXIg
ZXhwYW5kaW5nIGxpc3Qgb2YgcHJvZHVjdC1pZCdzIHdlDQorCSAqIGp1c3QgbG9vayBhdCB0aGUg
ZGV2aWNlJ3MgcHJvZHVjdCBuYW1lLg0KKwkgKi8NCisJaWYgKGRldikNCisJCXJldHVybiAhIXN0
cnN0cih0b191c2JfZGV2aWNlKGRldiktPnByb2R1Y3QsICJJbnRlcm5hbCBLZXlib2FyZCIpOw0K
Kw0KKwlyZXR1cm4gZmFsc2U7DQorfQ0KKw0KK3N0YXRpYyBpbnQgYXBwbGV0Yl9wcm9iZShzdHJ1
Y3QgaGlkX2RldmljZSAqaGRldiwNCisJCQkgY29uc3Qgc3RydWN0IGhpZF9kZXZpY2VfaWQgKmlk
KQ0KK3sNCisJc3RydWN0IGFwcGxldGJfZGV2aWNlICp0Yl9kZXYgPSBhcHBsZXRiX2RldjsNCisJ
dW5zaWduZWQgbG9uZyBmbGFnczsNCisJaW50IHJjOw0KKw0KKwkvKiBpbml0aWFsaXplIHRoZSBy
ZXBvcnQgaW5mbyAqLw0KKwlyYyA9IGhpZF9wYXJzZShoZGV2KTsNCisJaWYgKHJjKSB7DQorCQlk
ZXZfZXJyKHRiX2Rldi0+bG9nX2RldiwgImhpZCBwYXJzZSBmYWlsZWQgKCVkKVxuIiwgcmMpOw0K
KwkJZ290byBlcnJvcjsNCisJfQ0KKw0KKwkvKiBFbnN1cmUgdGhpcyB1c2IgZW5kcG9pbnQgaXMg
Zm9yIHRoZSB0b3VjaGJhciBiYWNrbGlnaHQsIG5vdCBrZXlib2FyZA0KKwkgKiBiYWNrbGlnaHQu
DQorCSAqLw0KKwlpZiAoKGhkZXYtPnByb2R1Y3QgPT0gVVNCX0RFVklDRV9JRF9BUFBMRV9UT1VD
SEJBUl9CQUNLTElHSFQpICYmDQorCQkJIShoZGV2LT5jb2xsZWN0aW9uICYmIGhkZXYtPmNvbGxl
Y3Rpb25bMF0udXNhZ2UgPT0NCisJCQkJSElEX1VTQUdFX0FQUExFX0FQUCkpIHsNCisJCXJldHVy
biAtRU5PREVWOw0KKwl9DQorDQorCXNwaW5fbG9ja19pcnFzYXZlKCZ0Yl9kZXYtPnRiX2xvY2ss
IGZsYWdzKTsNCisNCisJaWYgKCF0Yl9kZXYtPmxvZ19kZXYpDQorCQl0Yl9kZXYtPmxvZ19kZXYg
PSAmaGRldi0+ZGV2Ow0KKw0KKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZ0Yl9kZXYtPnRiX2xv
Y2ssIGZsYWdzKTsNCisNCisJaGlkX3NldF9kcnZkYXRhKGhkZXYsIHRiX2Rldik7DQorDQorCXJj
ID0gYXBwbGV0Yl9leHRyYWN0X3JlcG9ydF9hbmRfaWZhY2VfaW5mbyh0Yl9kZXYsIGhkZXYsIGlk
KTsNCisJaWYgKHJjIDwgMCkNCisJCWdvdG8gZXJyb3I7DQorDQorCXJjID0gaGlkX2h3X3N0YXJ0
KGhkZXYsIEhJRF9DT05ORUNUX0RSSVZFUiB8IEhJRF9DT05ORUNUX0hJRElOUFVUKTsNCisJaWYg
KHJjKSB7DQorCQlkZXZfZXJyKHRiX2Rldi0+bG9nX2RldiwgImh3IHN0YXJ0IGZhaWxlZCAoJWQp
XG4iLCByYyk7DQorCQlnb3RvIGNsZWFyX2lmYWNlX2luZm87DQorCX0NCisNCisJcmMgPSBoaWRf
aHdfb3BlbihoZGV2KTsNCisJaWYgKHJjKSB7DQorCQlkZXZfZXJyKHRiX2Rldi0+bG9nX2Rldiwg
Imh3IG9wZW4gZmFpbGVkICglZClcbiIsIHJjKTsNCisJCWdvdG8gc3RvcF9oaWQ7DQorCX0NCisN
CisJLyogZG8gc2V0dXAgaWYgd2UgaGF2ZSBib3RoIGludGVyZmFjZXMgKi8NCisJaWYgKGFwcGxl
dGJfdGVzdF9hbmRfbWFya19hY3RpdmUodGJfZGV2KSkgew0KKwkJLyogaW5pdGlhbGl6ZSB0aGUg
dG91Y2ggYmFyICovDQorCQlpZiAoYXBwbGV0Yl90Yl9kZWZfZm5fbW9kZSA+PSAwICYmDQorCQkg
ICAgYXBwbGV0Yl90Yl9kZWZfZm5fbW9kZSA8PSBBUFBMRVRCX0ZOX01PREVfTUFYKQ0KKwkJCXRi
X2Rldi0+Zm5fbW9kZSA9IGFwcGxldGJfdGJfZGVmX2ZuX21vZGU7DQorCQllbHNlDQorCQkJdGJf
ZGV2LT5mbl9tb2RlID0gQVBQTEVUQl9GTl9NT0RFX05PUk07DQorCQlhcHBsZXRiX3NldF9pZGxl
X3RpbWVvdXQodGJfZGV2LCBhcHBsZXRiX3RiX2RlZl9pZGxlX3RpbWVvdXQpOw0KKwkJYXBwbGV0
Yl9zZXRfZGltX3RpbWVvdXQodGJfZGV2LCBhcHBsZXRiX3RiX2RlZl9kaW1fdGltZW91dCk7DQor
CQl0Yl9kZXYtPmxhc3RfZXZlbnRfdGltZSA9IGt0aW1lX2dldCgpOw0KKw0KKwkJdGJfZGV2LT5w
bmRfdGJfbW9kZSA9IEFQUExFVEJfQ01EX01PREVfVVBEOw0KKwkJdGJfZGV2LT5wbmRfdGJfZGlz
cCA9IEFQUExFVEJfQ01EX0RJU1BfVVBEOw0KKw0KKwkJYXBwbGV0Yl91cGRhdGVfdG91Y2hiYXIo
dGJfZGV2LCBmYWxzZSk7DQorDQorCQkvKiBzZXQgdXAgdGhlIGlucHV0IGhhbmRsZXIgKi8NCisJ
CXRiX2Rldi0+aW5wX2hhbmRsZXIuZXZlbnQgPSBhcHBsZXRiX2lucF9ldmVudDsNCisJCXRiX2Rl
di0+aW5wX2hhbmRsZXIuY29ubmVjdCA9IGFwcGxldGJfaW5wX2Nvbm5lY3Q7DQorCQl0Yl9kZXYt
PmlucF9oYW5kbGVyLmRpc2Nvbm5lY3QgPSBhcHBsZXRiX2lucF9kaXNjb25uZWN0Ow0KKwkJdGJf
ZGV2LT5pbnBfaGFuZGxlci5uYW1lID0gImFwcGxldGIiOw0KKwkJdGJfZGV2LT5pbnBfaGFuZGxl
ci5pZF90YWJsZSA9IGFwcGxldGJfaW5wdXRfZGV2aWNlczsNCisJCXRiX2Rldi0+aW5wX2hhbmRs
ZXIubWF0Y2ggPSBhcHBsZXRiX21hdGNoX2ludGVybmFsX2RldmljZTsNCisJCXRiX2Rldi0+aW5w
X2hhbmRsZXIucHJpdmF0ZSA9IHRiX2RldjsNCisNCisJCXJjID0gaW5wdXRfcmVnaXN0ZXJfaGFu
ZGxlcigmdGJfZGV2LT5pbnBfaGFuZGxlcik7DQorCQlpZiAocmMpIHsNCisJCQlkZXZfZXJyKHRi
X2Rldi0+bG9nX2RldiwNCisJCQkJIlVuYWJsZSB0byByZWdpc3RlciBrZXlib2FyZCBoYW5kbGVy
ICglZClcbiIsDQorCQkJCXJjKTsNCisJCQlnb3RvIG1hcmtfaW5hY3RpdmU7DQorCQl9DQorDQor
CQkvKiBpbml0aWFsaXplIHN5c2ZzIGF0dHJpYnV0ZXMgKi8NCisJCXJjID0gc3lzZnNfY3JlYXRl
X2dyb3VwKCZ0Yl9kZXYtPm1vZGVfaWZhY2UuaGRldi0+ZGV2LmtvYmosDQorCQkJCQkmYXBwbGV0
Yl9hdHRyX2dyb3VwKTsNCisJCWlmIChyYykgew0KKwkJCWRldl9lcnIodGJfZGV2LT5sb2dfZGV2
LA0KKwkJCQkiRmFpbGVkIHRvIGNyZWF0ZSBzeXNmcyBhdHRyaWJ1dGVzICglZClcbiIsIHJjKTsN
CisJCQlnb3RvIHVucmVnX2hhbmRsZXI7DQorCQl9DQorDQorCQlkZXZfZGJnKHRiX2Rldi0+bG9n
X2RldiwgIlRvdWNoYmFyIGFjdGl2YXRlZFxuIik7DQorCX0NCisNCisJcmV0dXJuIDA7DQorDQor
dW5yZWdfaGFuZGxlcjoNCisJaW5wdXRfdW5yZWdpc3Rlcl9oYW5kbGVyKCZ0Yl9kZXYtPmlucF9o
YW5kbGVyKTsNCittYXJrX2luYWN0aXZlOg0KKwlhcHBsZXRiX3Rlc3RfYW5kX21hcmtfaW5hY3Rp
dmUodGJfZGV2LCBoZGV2KTsNCisJY2FuY2VsX2RlbGF5ZWRfd29ya19zeW5jKCZ0Yl9kZXYtPnRi
X3dvcmspOw0KKwloaWRfaHdfY2xvc2UoaGRldik7DQorc3RvcF9oaWQ6DQorCWhpZF9od19zdG9w
KGhkZXYpOw0KK2NsZWFyX2lmYWNlX2luZm86DQorCWFwcGxldGJfY2xlYXJfaWZhY2VfaW5mbyh0
Yl9kZXYsIGhkZXYpOw0KK2Vycm9yOg0KKwlyZXR1cm4gcmM7DQorfQ0KKw0KK3N0YXRpYyB2b2lk
IGFwcGxldGJfcmVtb3ZlKHN0cnVjdCBoaWRfZGV2aWNlICpoZGV2KQ0KK3sNCisJc3RydWN0IGFw
cGxldGJfZGV2aWNlICp0Yl9kZXYgPSBoaWRfZ2V0X2RydmRhdGEoaGRldik7DQorCXVuc2lnbmVk
IGxvbmcgZmxhZ3M7DQorDQorCWlmIChhcHBsZXRiX3Rlc3RfYW5kX21hcmtfaW5hY3RpdmUodGJf
ZGV2LCBoZGV2KSkgew0KKwkJc3lzZnNfcmVtb3ZlX2dyb3VwKCZ0Yl9kZXYtPm1vZGVfaWZhY2Uu
aGRldi0+ZGV2LmtvYmosDQorCQkJCSAgICZhcHBsZXRiX2F0dHJfZ3JvdXApOw0KKw0KKwkJaW5w
dXRfdW5yZWdpc3Rlcl9oYW5kbGVyKCZ0Yl9kZXYtPmlucF9oYW5kbGVyKTsNCisNCisJCWNhbmNl
bF9kZWxheWVkX3dvcmtfc3luYygmdGJfZGV2LT50Yl93b3JrKTsNCisJCWFwcGxldGJfc2V0X3Ri
X21vZGUodGJfZGV2LCBBUFBMRVRCX0NNRF9NT0RFX09GRik7DQorCQlhcHBsZXRiX3NldF90Yl9k
aXNwKHRiX2RldiwgQVBQTEVUQl9DTURfRElTUF9PTik7DQorDQorCQlpZiAodGJfZGV2LT50Yl9h
dXRvcG1fb2ZmKQ0KKwkJCWhpZF9od19wb3dlcih0Yl9kZXYtPmRpc3BfaWZhY2UuaGRldiwgUE1f
SElOVF9OT1JNQUwpOw0KKw0KKwkJZGV2X2luZm8odGJfZGV2LT5sb2dfZGV2LCAiVG91Y2hiYXIg
ZGVhY3RpdmF0ZWRcbiIpOw0KKwl9DQorDQorCWhpZF9od19jbG9zZShoZGV2KTsNCisJaGlkX2h3
X3N0b3AoaGRldik7DQorCWFwcGxldGJfY2xlYXJfaWZhY2VfaW5mbyh0Yl9kZXYsIGhkZXYpOw0K
Kw0KKwlzcGluX2xvY2tfaXJxc2F2ZSgmdGJfZGV2LT50Yl9sb2NrLCBmbGFncyk7DQorDQorCWlm
ICh0Yl9kZXYtPmxvZ19kZXYgPT0gJmhkZXYtPmRldikgew0KKwkJaWYgKHRiX2Rldi0+bW9kZV9p
ZmFjZS5oZGV2KQ0KKwkJCXRiX2Rldi0+bG9nX2RldiA9ICZ0Yl9kZXYtPm1vZGVfaWZhY2UuaGRl
di0+ZGV2Ow0KKwkJZWxzZSBpZiAodGJfZGV2LT5kaXNwX2lmYWNlLmhkZXYpDQorCQkJdGJfZGV2
LT5sb2dfZGV2ID0gJnRiX2Rldi0+ZGlzcF9pZmFjZS5oZGV2LT5kZXY7DQorCQllbHNlDQorCQkJ
dGJfZGV2LT5sb2dfZGV2ID0gTlVMTDsNCisJfQ0KKw0KKwlzcGluX3VubG9ja19pcnFyZXN0b3Jl
KCZ0Yl9kZXYtPnRiX2xvY2ssIGZsYWdzKTsNCit9DQorDQorI2lmZGVmIENPTkZJR19QTQ0KK3N0
YXRpYyBpbnQgYXBwbGV0Yl9zdXNwZW5kKHN0cnVjdCBoaWRfZGV2aWNlICpoZGV2LCBwbV9tZXNz
YWdlX3QgbWVzc2FnZSkNCit7DQorCXN0cnVjdCBhcHBsZXRiX2RldmljZSAqdGJfZGV2ID0gaGlk
X2dldF9kcnZkYXRhKGhkZXYpOw0KKwlzdHJ1Y3QgYXBwbGV0Yl9pZmFjZV9pbmZvICppZmFjZV9p
bmZvOw0KKwl1bnNpZ25lZCBsb25nIGZsYWdzOw0KKwlib29sIGFsbF9zdXNwZW5kZWQgPSBmYWxz
ZTsNCisNCisJaWYgKG1lc3NhZ2UuZXZlbnQgIT0gUE1fRVZFTlRfU1VTUEVORCAmJg0KKwkgICAg
bWVzc2FnZS5ldmVudCAhPSBQTV9FVkVOVF9GUkVFWkUpDQorCQlyZXR1cm4gMDsNCisNCisJaWYg
KHRiX2Rldi0+aXNfdDEpIHsNCisNCisJCS8qDQorCQkgKiBXYWl0IGZvciBib3RoIGludGVyZmFj
ZXMgdG8gYmUgc3VzcGVuZGVkIGFuZCBubyBtb3JlIGFzeW5jIHdvcmsNCisJCSAqIGluIHByb2dy
ZXNzLg0KKwkJICovDQorDQorCQlzcGluX2xvY2tfaXJxc2F2ZSgmdGJfZGV2LT50Yl9sb2NrLCBm
bGFncyk7DQorDQorCQlpZiAoIXRiX2Rldi0+bW9kZV9pZmFjZS5zdXNwZW5kZWQgJiYgIXRiX2Rl
di0+ZGlzcF9pZmFjZS5zdXNwZW5kZWQpIHsNCisJCQl0Yl9kZXYtPmFjdGl2ZSA9IGZhbHNlOw0K
KwkJCWNhbmNlbF9kZWxheWVkX3dvcmsoJnRiX2Rldi0+dGJfd29yayk7DQorCQl9DQorDQorCQlp
ZmFjZV9pbmZvID0gYXBwbGV0Yl9nZXRfaWZhY2VfaW5mbyh0Yl9kZXYsIGhkZXYpOw0KKwkJaWYg
KGlmYWNlX2luZm8pDQorCQkJaWZhY2VfaW5mby0+c3VzcGVuZGVkID0gdHJ1ZTsNCisNCisJCWlm
ICgoIXRiX2Rldi0+bW9kZV9pZmFjZS5oZGV2IHx8IHRiX2Rldi0+bW9kZV9pZmFjZS5zdXNwZW5k
ZWQpICYmDQorCQkgICAgKCF0Yl9kZXYtPmRpc3BfaWZhY2UuaGRldiB8fCB0Yl9kZXYtPmRpc3Bf
aWZhY2Uuc3VzcGVuZGVkKSkNCisJCQlhbGxfc3VzcGVuZGVkID0gdHJ1ZTsNCisNCisJCXNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJnRiX2Rldi0+dGJfbG9jaywgZmxhZ3MpOw0KKw0KKwkJZmx1c2hf
ZGVsYXllZF93b3JrKCZ0Yl9kZXYtPnRiX3dvcmspOw0KKw0KKwkJaWYgKCFhbGxfc3VzcGVuZGVk
KQ0KKwkJCXJldHVybiAwOw0KKw0KKwkJLyoNCisJCSAqIFRoZSB0b3VjaCBiYXIgZGV2aWNlIGl0
c2VsZiByZW1lbWJlcnMgdGhlIGxhc3Qgc3RhdGUgd2hlbiBzdXNwZW5kZWQNCisJCSAqIGluIHNv
bWUgY2FzZXMsIGJ1dCBpbiBvdGhlcnMgKGUuZy4gd2hlbiBtb2RlICE9IG9mZiBhbmQgZGlzcCA9
PSBvZmYpDQorCQkgKiBpdCByZXN1bWVzIHdpdGggYSBkaWZmZXJlbnQgc3RhdGU7IGZ1cnRoZXJt
b3JlIGl0IG1heSBiZSBvbmx5DQorCQkgKiBwYXJ0aWFsbHkgcmVzcG9uc2l2ZSBpbiB0aGF0IHN0
YXRlLiBCeSB0dXJuaW5nIGJvdGggbW9kZSBhbmQgZGlzcA0KKwkJICogb2ZmIHdlIGVuc3VyZSBp
dCBpcyBpbiBhIGdvb2Qgc3RhdGUgd2hlbiByZXN1bWluZyAoYW5kIHRoaXMgaGFwcGVucw0KKwkJ
ICogdG8gYmUgdGhlIHNhbWUgc3RhdGUgYWZ0ZXIgYm9vdGluZy9yZXN1bWluZy1mcm9tLWhpYmVy
bmF0ZSwgc28gbGVzcw0KKwkJICogc3BlY2lhbCBjYXNpbmcgYmV0d2VlbiB0aGUgdHdvKS4NCisJ
CSAqLw0KKwkJaWYgKG1lc3NhZ2UuZXZlbnQgPT0gUE1fRVZFTlRfU1VTUEVORCkgew0KKwkJCWFw
cGxldGJfc2V0X3RiX21vZGUodGJfZGV2LCBBUFBMRVRCX0NNRF9NT0RFX09GRik7DQorCQkJYXBw
bGV0Yl9zZXRfdGJfZGlzcCh0Yl9kZXYsIEFQUExFVEJfQ01EX0RJU1BfT0ZGKTsNCisJCX0NCisN
CisJCXNwaW5fbG9ja19pcnFzYXZlKCZ0Yl9kZXYtPnRiX2xvY2ssIGZsYWdzKTsNCisNCisJCXRi
X2Rldi0+Y3VyX3RiX21vZGUgPSBBUFBMRVRCX0NNRF9NT0RFX09GRjsNCisJCXRiX2Rldi0+Y3Vy
X3RiX2Rpc3AgPSBBUFBMRVRCX0NNRF9ESVNQX09GRjsNCisNCisJCXNwaW5fdW5sb2NrX2lycXJl
c3RvcmUoJnRiX2Rldi0+dGJfbG9jaywgZmxhZ3MpOw0KKw0KKwkJZGV2X2luZm8odGJfZGV2LT5s
b2dfZGV2LCAiVG91Y2hiYXIgc3VzcGVuZGVkLlxuIik7DQorCX0gZWxzZSB7DQorCQlkZXZfaW5m
byh0Yl9kZXYtPmxvZ19kZXYsICJUMiBNYWMgZGV0ZWN0ZWQsIG5vdCBoYW5kbGluZyBzdXNwZW5k
LlxuIik7DQorCX0NCisNCisJcmV0dXJuIDA7DQorfQ0KKw0KK3N0YXRpYyBpbnQgYXBwbGV0Yl9y
ZXNldF9yZXN1bWUoc3RydWN0IGhpZF9kZXZpY2UgKmhkZXYpDQorew0KKwlzdHJ1Y3QgYXBwbGV0
Yl9kZXZpY2UgKnRiX2RldiA9IGhpZF9nZXRfZHJ2ZGF0YShoZGV2KTsNCisJc3RydWN0IGFwcGxl
dGJfaWZhY2VfaW5mbyAqaWZhY2VfaW5mbzsNCisJdW5zaWduZWQgbG9uZyBmbGFnczsNCisNCisJ
c3Bpbl9sb2NrX2lycXNhdmUoJnRiX2Rldi0+dGJfbG9jaywgZmxhZ3MpOw0KKw0KKwlpZmFjZV9p
bmZvID0gYXBwbGV0Yl9nZXRfaWZhY2VfaW5mbyh0Yl9kZXYsIGhkZXYpOw0KKwlpZiAoaWZhY2Vf
aW5mbykNCisJCWlmYWNlX2luZm8tPnN1c3BlbmRlZCA9IGZhbHNlOw0KKw0KKwlpZiAoKHRiX2Rl
di0+bW9kZV9pZmFjZS5oZGV2ICYmICF0Yl9kZXYtPm1vZGVfaWZhY2Uuc3VzcGVuZGVkKSAmJg0K
KwkgICAgKHRiX2Rldi0+ZGlzcF9pZmFjZS5oZGV2ICYmICF0Yl9kZXYtPmRpc3BfaWZhY2Uuc3Vz
cGVuZGVkKSkgew0KKwkJLyoNCisJCSAqIFJlc3RvcmUgdG91Y2ggYmFyIHN0YXRlLiBOb3RlIHRo
YXQgYXV0b3BtIHN0YXRlIGlzIG5vdA0KKwkJICogcHJlc2VydmVkLCBzbyBuZWVkIGV4cGxpY2l0
bHkgcmVzdG9yZSB0aGF0IGhlcmUuDQorCQkgKi8NCisJCXRiX2Rldi0+YWN0aXZlID0gdHJ1ZTsN
CisJCXRiX2Rldi0+cmVzdG9yZV9hdXRvcG0gPSB0cnVlOw0KKwkJdGJfZGV2LT5sYXN0X2V2ZW50
X3RpbWUgPSBrdGltZV9nZXQoKTsNCisNCisJCWFwcGxldGJfdXBkYXRlX3RvdWNoYmFyX25vX2xv
Y2sodGJfZGV2LCB0cnVlKTsNCisNCisJCWRldl9pbmZvKHRiX2Rldi0+bG9nX2RldiwgIlRvdWNo
YmFyIHJlc3VtZWQuXG4iKTsNCisJfQ0KKw0KKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZ0Yl9k
ZXYtPnRiX2xvY2ssIGZsYWdzKTsNCisNCisJcmV0dXJuIDA7DQorfQ0KKyNlbmRpZg0KKw0KK3N0
YXRpYyBzdHJ1Y3QgYXBwbGV0Yl9kZXZpY2UgKmFwcGxldGJfYWxsb2NfZGV2aWNlKHZvaWQpDQor
ew0KKwlzdHJ1Y3QgYXBwbGV0Yl9kZXZpY2UgKnRiX2RldjsNCisNCisJdGJfZGV2ID0ga3phbGxv
YyhzaXplb2YoKnRiX2RldiksIEdGUF9LRVJORUwpOw0KKwlpZiAoIXRiX2RldikNCisJCXJldHVy
biBOVUxMOw0KKw0KKwlzcGluX2xvY2tfaW5pdCgmdGJfZGV2LT50Yl9sb2NrKTsNCisJSU5JVF9E
RUxBWUVEX1dPUksoJnRiX2Rldi0+dGJfd29yaywgYXBwbGV0Yl9zZXRfdGJfd29ya2VyKTsNCisN
CisJcmV0dXJuIHRiX2RldjsNCit9DQorDQorc3RhdGljIHZvaWQgYXBwbGV0Yl9mcmVlX2Rldmlj
ZShzdHJ1Y3QgYXBwbGV0Yl9kZXZpY2UgKnRiX2RldikNCit7DQorCWNhbmNlbF9kZWxheWVkX3dv
cmtfc3luYygmdGJfZGV2LT50Yl93b3JrKTsNCisJa2ZyZWUodGJfZGV2KTsNCit9DQorDQorc3Rh
dGljIGNvbnN0IHN0cnVjdCBoaWRfZGV2aWNlX2lkIGFwcGxldGJfaGlkX2lkc1tdID0gew0KKwkv
KiBNYWNCb29rIFBybydzIDIwMTYsIDIwMTcsIHdpdGggVDEgY2hpcCAqLw0KKwl7IEhJRF9VU0Jf
REVWSUNFKFVTQl9WRU5ET1JfSURfTElOVVhfRk9VTkRBVElPTiwNCisJCQkgVVNCX0RFVklDRV9J
RF9JQlJJREdFX1RCKSwNCisJICAuZHJpdmVyX2RhdGEgPSBBUFBMRVRCX0ZFQVRVUkVfSVNfVDEg
fSwNCisJLyogTWFjQm9vayBQcm8ncyAyMDE4LCAyMDE5LCB3aXRoIFQyIGNoaXA6IGlCcmlkZ2Ug
REZSIGJyaWdodG5lc3MgKi8NCisJeyBISURfVVNCX0RFVklDRShVU0JfVkVORE9SX0lEX0FQUExF
LA0KKwkJCVVTQl9ERVZJQ0VfSURfQVBQTEVfVE9VQ0hCQVJfQkFDS0xJR0hUKSB9LA0KKwkvKiBN
YWNCb29rIFBybydzIDIwMTgsIDIwMTksIHdpdGggVDIgY2hpcDogaUJyaWRnZSBEaXNwbGF5ICov
DQorCXsgSElEX1VTQl9ERVZJQ0UoVVNCX1ZFTkRPUl9JRF9BUFBMRSwNCisJCQlVU0JfREVWSUNF
X0lEX0FQUExFX1RPVUNIQkFSX0RJU1BMQVkpIH0sDQorCXsgfSwNCit9Ow0KKw0KK01PRFVMRV9E
RVZJQ0VfVEFCTEUoaGlkLCBhcHBsZXRiX2hpZF9pZHMpOw0KKw0KK3N0YXRpYyBzdHJ1Y3QgaGlk
X2RyaXZlciBhcHBsZXRiX2hpZF9kcml2ZXIgPSB7DQorCS5uYW1lID0gImFwcGxlLXRvdWNoYmFy
IiwNCisJLmlkX3RhYmxlID0gYXBwbGV0Yl9oaWRfaWRzLA0KKwkucHJvYmUgPSBhcHBsZXRiX3By
b2JlLA0KKwkucmVtb3ZlID0gYXBwbGV0Yl9yZW1vdmUsDQorCS5ldmVudCA9IGFwcGxldGJfaGlk
X2V2ZW50LA0KKwkuaW5wdXRfY29uZmlndXJlZCA9IGFwcGxldGJfaW5wdXRfY29uZmlndXJlZCwN
CisjaWZkZWYgQ09ORklHX1BNDQorCS5zdXNwZW5kID0gYXBwbGV0Yl9zdXNwZW5kLA0KKwkucmVz
ZXRfcmVzdW1lID0gYXBwbGV0Yl9yZXNldF9yZXN1bWUsDQorI2VuZGlmDQorfTsNCisNCitzdGF0
aWMgaW50IF9faW5pdCBhcHBsZXRiX2luaXQodm9pZCkNCit7DQorCXN0cnVjdCBhcHBsZXRiX2Rl
dmljZSAqdGJfZGV2Ow0KKwlpbnQgcmM7DQorDQorCXRiX2RldiA9IGFwcGxldGJfYWxsb2NfZGV2
aWNlKCk7DQorCWlmICghdGJfZGV2KQ0KKwkJcmV0dXJuIC1FTk9NRU07DQorDQorCWFwcGxldGJf
ZGV2ID0gdGJfZGV2Ow0KKw0KKwlyYyA9IGhpZF9yZWdpc3Rlcl9kcml2ZXIoJmFwcGxldGJfaGlk
X2RyaXZlcik7DQorCWlmIChyYykNCisJCWdvdG8gZXJyb3I7DQorDQorCXJldHVybiAwOw0KKw0K
K2Vycm9yOg0KKwlhcHBsZXRiX2ZyZWVfZGV2aWNlKHRiX2Rldik7DQorCXJldHVybiByYzsNCit9
DQorDQorc3RhdGljIHZvaWQgX19leGl0IGFwcGxldGJfZXhpdCh2b2lkKQ0KK3sNCisJaGlkX3Vu
cmVnaXN0ZXJfZHJpdmVyKCZhcHBsZXRiX2hpZF9kcml2ZXIpOw0KKwlhcHBsZXRiX2ZyZWVfZGV2
aWNlKGFwcGxldGJfZGV2KTsNCit9DQorDQorbW9kdWxlX2luaXQoYXBwbGV0Yl9pbml0KTsNCitt
b2R1bGVfZXhpdChhcHBsZXRiX2V4aXQpOw0KKw0KK01PRFVMRV9BVVRIT1IoIlJvbmFsZCBUc2No
YWzDpHIiKTsNCitNT0RVTEVfREVTQ1JJUFRJT04oIk1hY0Jvb2tQcm8gVG91Y2ggQmFyIGRyaXZl
ciIpOw0KK01PRFVMRV9MSUNFTlNFKCJHUEwiKTsNCmRpZmYgLS1naXQgYS9kcml2ZXJzL2hpZC9o
aWQtcXVpcmtzLmMgYi9kcml2ZXJzL2hpZC9oaWQtcXVpcmtzLmMNCmluZGV4IGMwMzUzNWM0Yi4u
ZTYyMDE5MGI1IDEwMDY0NA0KLS0tIGEvZHJpdmVycy9oaWQvaGlkLXF1aXJrcy5jDQorKysgYi9k
cml2ZXJzL2hpZC9oaWQtcXVpcmtzLmMNCkBAIC0zMTYsMTIgKzMxNiwxNCBAQCBzdGF0aWMgY29u
c3Qgc3RydWN0IGhpZF9kZXZpY2VfaWQgaGlkX2hhdmVfc3BlY2lhbF9kcml2ZXJbXSA9IHsNCiAJ
eyBISURfVVNCX0RFVklDRShVU0JfVkVORE9SX0lEX0FQUExFLCBVU0JfREVWSUNFX0lEX0FQUExF
X0dFWVNFUjFfVFBfT05MWSkgfSwNCiAJeyBISURfVVNCX0RFVklDRShVU0JfVkVORE9SX0lEX0FQ
UExFLCBVU0JfREVWSUNFX0lEX0FQUExFX01BR0lDX0tFWUJPQVJEXzIwMjEpIH0sDQogCXsgSElE
X1VTQl9ERVZJQ0UoVVNCX1ZFTkRPUl9JRF9BUFBMRSwgVVNCX0RFVklDRV9JRF9BUFBMRV9NQUdJ
Q19LRVlCT0FSRF9GSU5HRVJQUklOVF8yMDIxKSB9LA0KLQl7IEhJRF9VU0JfREVWSUNFKFVTQl9W
RU5ET1JfSURfQVBQTEUsIFVTQl9ERVZJQ0VfSURfQVBQTEVfVE9VQ0hCQVJfQkFDS0xJR0hUKSB9
LA0KLQl7IEhJRF9VU0JfREVWSUNFKFVTQl9WRU5ET1JfSURfQVBQTEUsIFVTQl9ERVZJQ0VfSURf
QVBQTEVfVE9VQ0hCQVJfRElTUExBWSkgfSwNCiAjZW5kaWYNCiAjaWYgSVNfRU5BQkxFRChDT05G
SUdfSElEX0FQUExFX0lCUklER0UpDQogCXsgSElEX1VTQl9ERVZJQ0UoVVNCX1ZFTkRPUl9JRF9B
UFBMRSwgVVNCX0RFVklDRV9JRF9BUFBMRV9JQlJJREdFKSB9LA0KICNlbmRpZg0KKyNpZiBJU19F
TkFCTEVEKENPTkZJR19ISURfQVBQTEVfVE9VQ0hCQVIpDQorCXsgSElEX1VTQl9ERVZJQ0UoVVNC
X1ZFTkRPUl9JRF9BUFBMRSwgVVNCX0RFVklDRV9JRF9BUFBMRV9UT1VDSEJBUl9CQUNLTElHSFQp
IH0sDQorCXsgSElEX1VTQl9ERVZJQ0UoVVNCX1ZFTkRPUl9JRF9BUFBMRSwgVVNCX0RFVklDRV9J
RF9BUFBMRV9UT1VDSEJBUl9ESVNQTEFZKSB9LA0KKyNlbmRpZg0KICNpZiBJU19FTkFCTEVEKENP
TkZJR19ISURfQVBQTEVJUikNCiAJeyBISURfVVNCX0RFVklDRShVU0JfVkVORE9SX0lEX0FQUExF
LCBVU0JfREVWSUNFX0lEX0FQUExFX0lSQ09OVFJPTCkgfSwNCiAJeyBISURfVVNCX0RFVklDRShV
U0JfVkVORE9SX0lEX0FQUExFLCBVU0JfREVWSUNFX0lEX0FQUExFX0lSQ09OVFJPTDIpIH0sDQot
LSANCjIuMzcuMg0KDQo=
