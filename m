Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id 379DC6A6EC2
	for <lists+linux-kernel@lfdr.de>; Wed,  1 Mar 2023 15:47:08 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S230227AbjCAOrF (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Wed, 1 Mar 2023 09:47:05 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:43050 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S230246AbjCAOrC (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Wed, 1 Mar 2023 09:47:02 -0500
Received: from dfw.source.kernel.org (dfw.source.kernel.org [IPv6:2604:1380:4641:c500::1])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 668A9311F2
        for <linux-kernel@vger.kernel.org>; Wed,  1 Mar 2023 06:46:50 -0800 (PST)
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by dfw.source.kernel.org (Postfix) with ESMTPS id B564D61337
        for <linux-kernel@vger.kernel.org>; Wed,  1 Mar 2023 14:46:49 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 14CE7C4339B;
        Wed,  1 Mar 2023 14:46:49 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
        s=k20201202; t=1677682009;
        bh=HxxKeR8oQqVNWP3MCJ55Zbytx6akUAPOIK8l8pR3wbI=;
        h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
        b=BtEiF3HCLvoefMIcsyg7cA8q20WlbhBCLnret6+37BAPgPsqospeOP7LLs+4BczF3
         P+bs/yy8wSvvhegr4uF/7vPRPxRqOp8ehs2Z1rN09ndgeqlf13eXadiSIXaWZFPNFo
         MqWwPRdT+aDJz6QmVmwCruuYEl/ou/93pM37rfeXVt3aUti9VtRKqqpTgATrB/6RkK
         vdOgkgMEeclBc8l68++nrL0x5n0iK7TKvYVR2is2ZcKlNgKurbqDSKc8UvWYeFx2ad
         BVdCm1T/5P4MugLklMLtpKsihrawcAQujnm1xB3vSQL8GkdY9BBfbLLwYFzNEdFvUw
         NubeKuZKXvj+Q==
Received: from [47.176.216.2] (helo=wait-a-minute.misterjones.org)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.95)
        (envelope-from <maz@kernel.org>)
        id 1pXNjC-00E9Sx-Bb;
        Wed, 01 Mar 2023 14:46:46 +0000
Date:   Wed, 01 Mar 2023 14:46:43 +0000
Message-ID: <87o7pch6lo.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     Bingbu Cao <bingbu.cao@linux.intel.com>
Cc:     linux-kernel@vger.kernel.org, johan+linaro@kernel.org,
        hsinyi@chromium.org
Subject: Re: System boot failure related to commit 'irqdomain: Switch to per-domain locking'
In-Reply-To: <32175259-ee22-9288-475c-db0da1ccee41@linux.intel.com>
References: <d2290916-f78c-4b0a-d706-0955ae0aa4ff@linux.intel.com>
        <d595de9168d45bb5e863942ab7a78e3d@kernel.org>
        <32175259-ee22-9288-475c-db0da1ccee41@linux.intel.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/27.1
 (x86_64-pc-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 47.176.216.2
X-SA-Exim-Rcpt-To: bingbu.cao@linux.intel.com, linux-kernel@vger.kernel.org, johan+linaro@kernel.org, hsinyi@chromium.org
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
X-Spam-Status: No, score=-4.4 required=5.0 tests=BAYES_00,DKIMWL_WL_HIGH,
        DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_MED,
        SPF_HELO_NONE,SPF_PASS autolearn=ham autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Wed, 01 Mar 2023 11:17:21 +0000,
Bingbu Cao <bingbu.cao@linux.intel.com> wrote:
> 
> 
> On 2/28/23 8:45 AM, Marc Zyngier wrote:
> > On 2023-02-27 10:46, Bingbu Cao wrote:
> >> Hi, Johan and Zyngier,
> >>
> >> I am using a Dell XPS laptop(Intel Processor) just update my
> >> Linux kernel to latest tag 6.2.0, and then I see that the kernel
> >> cannot boot successfully, it reported:
> >> --------------------------------------------
> >> Gave up waiting for root file system device. Common problems:
> >>  - Boot args (cat /proc/cmdline)
> >>    - Check rootdelay= (did the system wait long enough?)
> >>  - Missing modules (cat /proc/modules; ls /dev)
> >>
> >> ALERT! UUID=xxxxxxx does not exist. Dropping to shell!
> >> --------------------------------------------
> >>
> >> And then it drop into initramfs shell, I try to use 'blkid' to
> >> get block devices information, but it showed nothing.
> >>
> >> I also tried add 'rootdelay' and 'rootwait' in bootargs, but it did
> >> not work.
> >>
> >> I am sure that my previous kernel 6.2.0-rc4 work normally, so I
> >> did some bisect and found the commit below cause the failure on
> >> my system:
> >>
> >> 9dbb8e3452ab irqdomain: Switch to per-domain locking
> >>
> >> I really have no idea why it cause my problem, but I see just
> >> reverting this commit really help me.
> >>
> >> Do you have any idea?
> > 
> > Please provide us with a kernel boot log. It is very hard
> > to figure out what is going on without it. It would also
> > help if you indicated what sort of device is your root
> > filesystem on (NVMe, SATA, USB...), as it would narrow the
> > search for the culprit.
> 
> Unfortunately, I have not find a way to capture the console log, no
> serial for me.

You don't need serial access. Since you're able to interact with the
machine, you can save the dmesg log on some other mass storage. Just
make sure that USB, for example is in your initramfs, and dump the log
there.

> I am using a NVMe for my rootfs. By checking the screen log, I see
> that 1 kernel message is missing:
> 
> [    4.193375] EXT4-fs (nvme0n1p3): mounted filesystem a9e1243b-332f-46ce-a5e7-cea86b44f797 with ordered data mode. Quota mode: none.

OK, at least we know that NVMe is in the loop, but we don't know *why*
yet. Please try and get the dmesg for us. I'm sure someone at Intel
can help you with this.

Thanks,

	M.

-- 
Without deviation from the norm, progress is not possible.
