Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id DA15E62E63A
	for <lists+linux-kernel@lfdr.de>; Thu, 17 Nov 2022 22:00:18 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S234794AbiKQVAQ (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Thu, 17 Nov 2022 16:00:16 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:47430 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S231919AbiKQVAN (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 17 Nov 2022 16:00:13 -0500
Received: from ams.source.kernel.org (ams.source.kernel.org [IPv6:2604:1380:4601:e00::1])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 9E7551004D
        for <linux-kernel@vger.kernel.org>; Thu, 17 Nov 2022 13:00:12 -0800 (PST)
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by ams.source.kernel.org (Postfix) with ESMTPS id 4DDB1B82202
        for <linux-kernel@vger.kernel.org>; Thu, 17 Nov 2022 21:00:11 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id EE473C433D6;
        Thu, 17 Nov 2022 21:00:09 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
        s=k20201202; t=1668718810;
        bh=Z5At3dUHWt/gy6PCG/iiXcTkMRaZ1CDhg318SYC4H2E=;
        h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
        b=IkYgQ2PEASJMJFCB719vfQhLV0vej5+VvsmIESrupdHkH28PRtoM5FFrfMwFpTi1l
         hIiVZhohOGoyLKAkYQwYwA8WswWiY3ahYXb31gv67PXxT354X5KYUSZkxaldCwWtGf
         jiNigJsIJ3tsB4lNJsSGSt91VRF986Ju5zVd+lMaEEovPdFoCIqDk0bC/I5uNWap+W
         xGAWPIijC6ErpKacxTPR2tW/lgJCTl0ESvpR1NXzrZyWv/Gf3sZ81LGQtJWuebKHqM
         gzXNJlUa7p0FearIFQQo9TBFjX3uqct5vba0gsmc81n1v1N/4TqIz0V+lzX13U9ym6
         3musTQPo88Iow==
Received: from sofa.misterjones.org ([185.219.108.64] helo=goblin-girl.misterjones.org)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.95)
        (envelope-from <maz@kernel.org>)
        id 1ovlzT-006pZP-Ms;
        Thu, 17 Nov 2022 21:00:07 +0000
Date:   Thu, 17 Nov 2022 21:00:07 +0000
Message-ID: <86tu2xnvoo.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     Nicolas Frayer <nfrayer@baylibre.com>
Cc:     tglx@linutronix.de, linux-kernel@vger.kernel.org,
        khilman@baylibre.com, glaroque@baylibre.com
Subject: Re: [PATCH 0/2] irqchip: Kconfig: Add module support for TI inta/intr
In-Reply-To: <CANyCTtTfhhORL32EweGN2Gtx9=kpA+PAxTUKE84C5sGmjTfPyw@mail.gmail.com>
References: <20221116185500.40431-1-nfrayer@baylibre.com>
        <864juypoax.wl-maz@kernel.org>
        <CANyCTtTfhhORL32EweGN2Gtx9=kpA+PAxTUKE84C5sGmjTfPyw@mail.gmail.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/27.1
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: nfrayer@baylibre.com, tglx@linutronix.de, linux-kernel@vger.kernel.org, khilman@baylibre.com, glaroque@baylibre.com
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
X-Spam-Status: No, score=-7.1 required=5.0 tests=BAYES_00,DKIMWL_WL_HIGH,
        DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_HI,
        SPF_HELO_NONE,SPF_PASS autolearn=ham autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Thu, 17 Nov 2022 20:49:58 +0000,
Nicolas Frayer <nfrayer@baylibre.com> wrote:
>=20
> Le mer. 16 nov. 2022 =C3=A0 22:44, Marc Zyngier <maz@kernel.org> a =C3=A9=
crit :
> >
> > On Wed, 16 Nov 2022 18:54:58 +0000,
> > Nicolas Frayer <nfrayer@baylibre.com> wrote:
> > >
> > > Added module support for TI interrupt aggregator and interrupt router
> > >
> > > Nicolas Frayer (2):
> > >   irqchip: Kconfig: module build support for the TI interrupt router
> > >     driver
> > >   irqchip: Kconfig: Added module build support for the TI interrupt
> > >     aggregator
> > >
> > >  arch/arm64/Kconfig.platforms |  2 --
> > >  drivers/irqchip/Kconfig      | 12 +++++++-----
> > >  2 files changed, 7 insertions(+), 7 deletions(-)
> >
> > How did you test that it doesn't introduce any regression due to
> > implicit ordering requirements that are now voided?
> Hi Marc,
> I tested on a TI AM62x SK board.
> By default the drivers are set to ARCH_K3 (built-in).

That wasn't exactly my question: even if they are by sefault set as
built-in, you still run the risk of exposing some breakage for
endpoint drivers that expect the irqchip to be present before they get
initialised. Every time an interrupt controller gets modularised, we
end-up with a ton of failures.

A good way to test this is to run a distro kernel with all the drivers
build as modules.

> >
> > Please Cc the TI folks so that they can at least check this.
> I'll resend the series with more description and CC Ti engineers.

Please also see the kernel robot result: this stuff now gets compiled
on unsuspecting architectures, and fails.

	M.

--=20
Without deviation from the norm, progress is not possible.
