Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id 88631602838
	for <lists+linux-kernel@lfdr.de>; Tue, 18 Oct 2022 11:24:12 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S229622AbiJRJX7 (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Tue, 18 Oct 2022 05:23:59 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:54796 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S229722AbiJRJXq (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Tue, 18 Oct 2022 05:23:46 -0400
Received: from us-smtp-delivery-124.mimecast.com (us-smtp-delivery-124.mimecast.com [170.10.133.124])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 93010A99CB
        for <linux-kernel@vger.kernel.org>; Tue, 18 Oct 2022 02:23:31 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
        s=mimecast20190719; t=1666085010;
        h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
         to:to:cc:cc:mime-version:mime-version:content-type:content-type:
         in-reply-to:in-reply-to:references:references;
        bh=yBOtDHeeIVLfwUhAyBSCeK/RWi8e6lg4gpPb3l/BEu4=;
        b=H3KfKVWfLobBiNh5an9JoxUvic9t0cnyJ7Dj8jDP+0VRu+Upq2gIqAFyENtXncWehIcL0n
        yXtbHCuFt3cthYUKthWhAczyPIcZfkbOTKSrJ1Tt4HjcTCTudxrvskV0+2KzyjvVwqV87F
        Y782hW5TWdczAVUoKzfUQ/5qRr4YuM8=
Received: from mail-pg1-f200.google.com (mail-pg1-f200.google.com
 [209.85.215.200]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.3, cipher=TLS_AES_128_GCM_SHA256) id
 us-mta-220-rqbdr_D4PcieJMW8vUY5sw-1; Tue, 18 Oct 2022 05:23:29 -0400
X-MC-Unique: rqbdr_D4PcieJMW8vUY5sw-1
Received: by mail-pg1-f200.google.com with SMTP id p24-20020a63f458000000b0043cd718c49dso7869249pgk.15
        for <linux-kernel@vger.kernel.org>; Tue, 18 Oct 2022 02:23:29 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20210112;
        h=cc:to:subject:message-id:date:from:in-reply-to:references
         :mime-version:x-gm-message-state:from:to:cc:subject:date:message-id
         :reply-to;
        bh=yBOtDHeeIVLfwUhAyBSCeK/RWi8e6lg4gpPb3l/BEu4=;
        b=DScUM8bUJxdEQnQI8A+IiR7Gl4o5+K6UJeeFCIaam1WbB3sMd/ZTFykmecAoMLiJbX
         951LHN71JTyBi2ZMGtx0B7SrTT98BdyQlkGq7B4Xw6UHGCZ8Jw5Gwux6lhIPTtLp17ei
         cMa0uewNb9VLBtgRyW4l+1EQhtEligOYttA2/oKdOpFAoWedUFMgsGtKDrPlyzEvpL32
         ZQ3KFFQYhGRnFrrxF5LG18O9az+4HNABfY1VzL94I6N08dRG2BY53YbgEIEzb5B/EYNU
         +aCgNQkSA7KPI8tNE3/Ae/eoQ4FZytYKB+Epzbq3GSjEGeIQYPuAxAe/4m5PRDYDZk5V
         gDtw==
X-Gm-Message-State: ACrzQf1DOJvs3FzTuR58m9EFijhzKr43LFCjsc2p2CHFhgyr8ite2h07
        G5mwc5aUXu9qhTCoQXRO7cioDacCyGt/+LT8UjRxbRxazsZpL9VHX8TP69IJ0SxqEechvbE+FZv
        UhxBr8kYO5u2SEVgcK1O3PbyVi4MF98AQYUrQBDYX
X-Received: by 2002:a17:90b:3c02:b0:20d:2af9:821c with SMTP id pb2-20020a17090b3c0200b0020d2af9821cmr2468185pjb.181.1666085008521;
        Tue, 18 Oct 2022 02:23:28 -0700 (PDT)
X-Google-Smtp-Source: AMsMyM615JTQle3yis0nUwgTnU0Y+6ybhxCOWo9agHlFI/aWwi9iDi090LTMOfQEJ0hiSlGk4/W49sNtceJ0tEX6RHk=
X-Received: by 2002:a17:90b:3c02:b0:20d:2af9:821c with SMTP id
 pb2-20020a17090b3c0200b0020d2af9821cmr2468172pjb.181.1666085008314; Tue, 18
 Oct 2022 02:23:28 -0700 (PDT)
MIME-Version: 1.0
References: <Y00b31dX1mIfgnBP@xpf.sh.intel.com>
In-Reply-To: <Y00b31dX1mIfgnBP@xpf.sh.intel.com>
From:   Miklos Szeredi <mszeredi@redhat.com>
Date:   Tue, 18 Oct 2022 11:23:17 +0200
Message-ID: <CAOssrKfakpGguAV=102jpW4m+YfpRx=+cBBO1O43bt3iwJHiSA@mail.gmail.com>
Subject: Re: [Syzkaller] INFO: task hung in fuse_lookup with v6.0 kernel in guest
To:     Pengfei Xu <pengfei.xu@intel.com>
Cc:     linux-kernel@vger.kernel.org, heng.su@intel.com
Content-Type: text/plain; charset="UTF-8"
X-Spam-Status: No, score=-2.4 required=5.0 tests=BAYES_00,DKIMWL_WL_HIGH,
        DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_NONE,
        RCVD_IN_MSPIKE_H2,SPF_HELO_NONE,SPF_NONE autolearn=ham
        autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Mon, Oct 17, 2022 at 11:17 AM Pengfei Xu <pengfei.xu@intel.com> wrote:
>
> Hi Miklos,
>
> Greeting!
>
> Platform: Tiger lake CPU platform.
>
> We found 1 "task hung in fuse_lookup" issue by syzkaller with v6.0 mainline
> kernel in guest.
>
> Bisected and found the bad commit:
> "
> commit:  62dd1fc8cc6b22e3e568be46ebdb817e66f5d6a5
> fuse: move fget() to fuse_get_tree()
> "
>
> Reproduced code generated by syzkaller, binary, bisect log and all the dmesg
> info are in attached package.

Thanks for the report.

I tried out the reproducer, and the deadlock can be triggered.
Unfortunately killing the deadlocked processes is not enough, but it
still should be possible to recover with "echo 1 >
/sys/fs/fuse/connections/$FUSE_DEV/abort".    In my tests this works,
so I'm not sure there's anything to fix here.

Is there a real life situation where this occurs, or is this just
triggered with fuzzing?

I'm wondering why syzbot didn't try aborting using the "abort" file in
sysfs, AFAICS it does know this trick.

Thanks,
Miklos

